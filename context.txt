Directory structure:
└── yet300-homepasss/
    ├── README.md
    ├── build.gradle.kts
    ├── gradle.properties
    ├── gradlew
    ├── gradlew.bat
    ├── settings.gradle.kts
    ├── build-logic/
    │   ├── gradle.properties
    │   ├── settings.gradle.kts
    │   └── convention/
    │       ├── build.gradle.kts
    │       └── src/
    │           └── main/
    │               └── kotlin/
    │                   └── com/
    │                       └── yet/
    │                           ├── convention/
    │                           │   ├── configureKotlinAndroid.kt
    │                           │   ├── configureKotlinMultiplatform.kt
    │                           │   └── Libs.kt
    │                           └── plugins/
    │                               ├── ComposeMultiplatformPlugin.kt
    │                               ├── KoinAnnotationPlugin.kt
    │                               ├── KotlinMultiplatformPlugin.kt
    │                               └── SqlDelightConventionPlugin.kt
    ├── composeApp/
    │   ├── build.gradle.kts
    │   └── src/
    │       ├── androidMain/
    │       │   ├── AndroidManifest.xml
    │       │   ├── kotlin/
    │       │   │   └── com/
    │       │   │       └── yet/
    │       │   │           └── home/
    │       │   │               ├── HomePasssApp.kt
    │       │   │               ├── MainActivity.kt
    │       │   │               └── Platform.android.kt
    │       │   └── res/
    │       │       ├── drawable/
    │       │       │   └── ic_launcher_background.xml
    │       │       ├── drawable-v24/
    │       │       │   └── ic_launcher_foreground.xml
    │       │       ├── mipmap-anydpi-v26/
    │       │       │   ├── ic_launcher.xml
    │       │       │   └── ic_launcher_round.xml
    │       │       ├── values/
    │       │       │   └── strings.xml
    │       │       └── xml/
    │       │           └── network_security_config.xml
    │       ├── commonMain/
    │       │   ├── composeResources/
    │       │   │   ├── drawable/
    │       │   │   │   └── compose-multiplatform.xml
    │       │   │   ├── values-en/
    │       │   │   │   └── strings.xml
    │       │   │   └── values-ru/
    │       │   │       └── strings.xml
    │       │   └── kotlin/
    │       │       └── com/
    │       │           └── yet/
    │       │               └── home/
    │       │                   ├── App.kt
    │       │                   ├── Greeting.kt
    │       │                   ├── Platform.kt
    │       │                   ├── di/
    │       │                   │   ├── AppModule.kt
    │       │                   │   └── InitKoin.kt
    │       │                   ├── ui/
    │       │                   │   ├── component/
    │       │                   │   │   └── theme/
    │       │                   │   │       ├── ColorScheme.kt
    │       │                   │   │       ├── dashboardBackground.kt
    │       │                   │   │       └── Theme.kt
    │       │                   │   ├── components/
    │       │                   │   │   └── ProgressIndicator.kt
    │       │                   │   ├── navigation/
    │       │                   │   │   ├── AppNavigation.kt
    │       │                   │   │   ├── BottomNavigationBar.kt
    │       │                   │   │   ├── MainNavigation.kt
    │       │                   │   │   └── NavDestination.kt
    │       │                   │   └── screens/
    │       │                   │       ├── AuthScreen.kt
    │       │                   │       ├── CompanyInvestmentFlowScreen.kt
    │       │                   │       ├── ConstructionCompanyDetailsScreen.kt
    │       │                   │       ├── HomeScreen.kt
    │       │                   │       ├── InvestmentsScreen.kt
    │       │                   │       ├── InvestmentSuccessScreen.kt
    │       │                   │       ├── ProfileScreen.kt
    │       │                   │       ├── PropertyDetailsBottomSheet.kt
    │       │                   │       ├── PropertyDetailsScreen.kt
    │       │                   │       └── SearchScreen.kt
    │       │                   ├── utils/
    │       │                   │   └── formatTwoDecimalCommon.kt
    │       │                   └── viewmodel/
    │       │                       ├── AuthViewModel.kt
    │       │                       ├── ConstructionCompanyDetailsViewModel.kt
    │       │                       ├── HomeViewModel.kt
    │       │                       ├── InvestmentsViewModel.kt
    │       │                       ├── MainViewModel.kt
    │       │                       ├── PortfolioViewModel.kt
    │       │                       ├── ProfileViewModel.kt
    │       │                       ├── PropertyDetailsViewModel.kt
    │       │                       ├── SearchViewModel.kt
    │       │                       └── SolanaNetworkViewModel.kt
    │       └── iosMain/
    │           └── kotlin/
    │               └── com/
    │                   └── yet/
    │                       └── home/
    │                           ├── MainViewController.kt
    │                           └── Platform.ios.kt
    ├── core/
    │   ├── data/
    │   │   ├── build.gradle.kts
    │   │   └── src/
    │   │       └── commonMain/
    │   │           └── kotlin/
    │   │               └── com/
    │   │                   └── yet/
    │   │                       └── data/
    │   │                           ├── api/
    │   │                           │   └── HouseApi.kt
    │   │                           ├── di/
    │   │                           │   ├── ApiModule.kt
    │   │                           │   └── DataModule.kt
    │   │                           ├── mapper/
    │   │                           │   ├── HouseMapper.kt
    │   │                           │   └── UserMapper.kt
    │   │                           ├── model/
    │   │                           │   ├── HouseDTO.kt
    │   │                           │   └── UserResponse.kt
    │   │                           ├── repository/
    │   │                           │   ├── AuthRepositoryImpl.kt
    │   │                           │   ├── HomeRepositoryImpl.kt
    │   │                           │   ├── HouseRepositoryImpl.kt
    │   │                           │   └── SolanaChainRepositoryImpl.kt
    │   │                           └── utils/
    │   │                               └── provideSolanaClusterConfig.kt
    │   └── domain/
    │       ├── build.gradle.kts
    │       └── src/
    │           └── commonMain/
    │               └── kotlin/
    │                   └── com/
    │                       └── yet/
    │                           └── domain/
    │                               ├── model/
    │                               │   ├── Address.kt
    │                               │   ├── ConstructionCompany.kt
    │                               │   ├── Enums.kt
    │                               │   ├── House.kt
    │                               │   ├── Investment.kt
    │                               │   ├── Offer.kt
    │                               │   ├── PropertyShare.kt
    │                               │   ├── SolanaAccountBalance.kt
    │                               │   ├── SolanaClusterConfig.kt
    │                               │   ├── SolanaNetworkStatus.kt
    │                               │   └── User.kt
    │                               └── repository/
    │                                   ├── AuthRepository.kt
    │                                   ├── ConstructionCompanyRepository.kt
    │                                   ├── HomeRepository.kt
    │                                   ├── HouseRepository.kt
    │                                   └── SolanaChainRepository.kt
    ├── gradle/
    │   ├── libs.versions.toml
    │   └── wrapper/
    │       └── gradle-wrapper.properties
    └── iosApp/
        ├── Configuration/
        │   └── Config.xcconfig
        └── iosApp/
            ├── ContentView.swift
            ├── Info.plist
            ├── iOSApp.swift
            ├── Assets.xcassets/
            │   ├── Contents.json
            │   ├── AccentColor.colorset/
            │   │   └── Contents.json
            │   └── AppIcon.appiconset/
            │       └── Contents.json
            └── Preview Content/
                └── Preview Assets.xcassets/
                    └── Contents.json

================================================
FILE: README.md
================================================
This is a Kotlin Multiplatform project targeting Android, iOS.

* [/composeApp](./composeApp/src) is for code that will be shared across your Compose Multiplatform applications.
  It contains several subfolders:
  - [commonMain](./composeApp/src/commonMain/kotlin) is for code that’s common for all targets.
  - Other folders are for Kotlin code that will be compiled for only the platform indicated in the folder name.
    For example, if you want to use Apple’s CoreCrypto for the iOS part of your Kotlin app,
    the [iosMain](./composeApp/src/iosMain/kotlin) folder would be the right place for such calls.
    Similarly, if you want to edit the Desktop (JVM) specific part, the [jvmMain](./composeApp/src/jvmMain/kotlin)
    folder is the appropriate location.

* [/iosApp](./iosApp/iosApp) contains iOS applications. Even if you’re sharing your UI with Compose Multiplatform,
  you need this entry point for your iOS app. This is also where you should add SwiftUI code for your project.

* [/shared](./shared/src) is for the code that will be shared between all targets in the project.
  The most important subfolder is [commonMain](./shared/src/commonMain/kotlin). If preferred, you
  can add code to the platform-specific folders here too.

### Build and Run Android Application

To build and run the development version of the Android app, use the run configuration from the run widget
in your IDE’s toolbar or build it directly from the terminal:
- on macOS/Linux
  ```shell
  ./gradlew :composeApp:assembleDebug
  ```
- on Windows
  ```shell
  .\gradlew.bat :composeApp:assembleDebug
  ```

### Build and Run iOS Application

To build and run the development version of the iOS app, use the run configuration from the run widget
in your IDE’s toolbar or open the [/iosApp](./iosApp) directory in Xcode and run it from there.

---

Learn more about [Kotlin Multiplatform](https://www.jetbrains.com/help/kotlin-multiplatform-dev/get-started.html)…


================================================
FILE: build.gradle.kts
================================================
plugins {
    // this is necessary to avoid the plugins to be loaded multiple times
    // in each subproject's classloader
    alias(libs.plugins.androidApplication) apply false
    alias(libs.plugins.androidLibrary) apply false
    alias(libs.plugins.composeMultiplatform) apply false
    alias(libs.plugins.composeCompiler) apply false
    alias(libs.plugins.kotlinMultiplatform) apply false
    alias(libs.plugins.kotlin.serialization) apply false
    alias(libs.plugins.ksp) apply false
    alias(libs.plugins.sqlDelight) apply false
    alias(libs.plugins.ktor.fit) apply false
}


================================================
FILE: gradle.properties
================================================
#Kotlin
kotlin.code.style=official
kotlin.daemon.jvmargs=-Xmx3072M

#Gradle
org.gradle.jvmargs=-Xmx4096M -Dfile.encoding=UTF-8
org.gradle.configuration-cache=true
org.gradle.caching=true

#Android
android.nonTransitiveRClass=true
android.useAndroidX=true



================================================
FILE: gradlew
================================================
#!/bin/sh

#
# Copyright © 2015-2021 the original authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# SPDX-License-Identifier: Apache-2.0
#

##############################################################################
#
#   Gradle start up script for POSIX generated by Gradle.
#
#   Important for running:
#
#   (1) You need a POSIX-compliant shell to run this script. If your /bin/sh is
#       noncompliant, but you have some other compliant shell such as ksh or
#       bash, then to run this script, type that shell name before the whole
#       command line, like:
#
#           ksh Gradle
#
#       Busybox and similar reduced shells will NOT work, because this script
#       requires all of these POSIX shell features:
#         * functions;
#         * expansions «$var», «${var}», «${var:-default}», «${var+SET}»,
#           «${var#prefix}», «${var%suffix}», and «$( cmd )»;
#         * compound commands having a testable exit status, especially «case»;
#         * various built-in commands including «command», «set», and «ulimit».
#
#   Important for patching:
#
#   (2) This script targets any POSIX shell, so it avoids extensions provided
#       by Bash, Ksh, etc; in particular arrays are avoided.
#
#       The "traditional" practice of packing multiple parameters into a
#       space-separated string is a well documented source of bugs and security
#       problems, so this is (mostly) avoided, by progressively accumulating
#       options in "$@", and eventually passing that to Java.
#
#       Where the inherited environment variables (DEFAULT_JVM_OPTS, JAVA_OPTS,
#       and GRADLE_OPTS) rely on word-splitting, this is performed explicitly;
#       see the in-line comments for details.
#
#       There are tweaks for specific operating systems such as AIX, CygWin,
#       Darwin, MinGW, and NonStop.
#
#   (3) This script is generated from the Groovy template
#       https://github.com/gradle/gradle/blob/HEAD/platforms/jvm/plugins-application/src/main/resources/org/gradle/api/internal/plugins/unixStartScript.txt
#       within the Gradle project.
#
#       You can find Gradle at https://github.com/gradle/gradle/.
#
##############################################################################

# Attempt to set APP_HOME

# Resolve links: $0 may be a link
app_path=$0

# Need this for daisy-chained symlinks.
while
    APP_HOME=${app_path%"${app_path##*/}"}  # leaves a trailing /; empty if no leading path
    [ -h "$app_path" ]
do
    ls=$( ls -ld "$app_path" )
    link=${ls#*' -> '}
    case $link in             #(
      /*)   app_path=$link ;; #(
      *)    app_path=$APP_HOME$link ;;
    esac
done

# This is normally unused
# shellcheck disable=SC2034
APP_BASE_NAME=${0##*/}
# Discard cd standard output in case $CDPATH is set (https://github.com/gradle/gradle/issues/25036)
APP_HOME=$( cd -P "${APP_HOME:-./}" > /dev/null && printf '%s\n' "$PWD" ) || exit

# Use the maximum available, or set MAX_FD != -1 to use that value.
MAX_FD=maximum

warn () {
    echo "$*"
} >&2

die () {
    echo
    echo "$*"
    echo
    exit 1
} >&2

# OS specific support (must be 'true' or 'false').
cygwin=false
msys=false
darwin=false
nonstop=false
case "$( uname )" in                #(
  CYGWIN* )         cygwin=true  ;; #(
  Darwin* )         darwin=true  ;; #(
  MSYS* | MINGW* )  msys=true    ;; #(
  NONSTOP* )        nonstop=true ;;
esac

CLASSPATH="\\\"\\\""


# Determine the Java command to use to start the JVM.
if [ -n "$JAVA_HOME" ] ; then
    if [ -x "$JAVA_HOME/jre/sh/java" ] ; then
        # IBM's JDK on AIX uses strange locations for the executables
        JAVACMD=$JAVA_HOME/jre/sh/java
    else
        JAVACMD=$JAVA_HOME/bin/java
    fi
    if [ ! -x "$JAVACMD" ] ; then
        die "ERROR: JAVA_HOME is set to an invalid directory: $JAVA_HOME

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
else
    JAVACMD=java
    if ! command -v java >/dev/null 2>&1
    then
        die "ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
fi

# Increase the maximum file descriptors if we can.
if ! "$cygwin" && ! "$darwin" && ! "$nonstop" ; then
    case $MAX_FD in #(
      max*)
        # In POSIX sh, ulimit -H is undefined. That's why the result is checked to see if it worked.
        # shellcheck disable=SC2039,SC3045
        MAX_FD=$( ulimit -H -n ) ||
            warn "Could not query maximum file descriptor limit"
    esac
    case $MAX_FD in  #(
      '' | soft) :;; #(
      *)
        # In POSIX sh, ulimit -n is undefined. That's why the result is checked to see if it worked.
        # shellcheck disable=SC2039,SC3045
        ulimit -n "$MAX_FD" ||
            warn "Could not set maximum file descriptor limit to $MAX_FD"
    esac
fi

# Collect all arguments for the java command, stacking in reverse order:
#   * args from the command line
#   * the main class name
#   * -classpath
#   * -D...appname settings
#   * --module-path (only if needed)
#   * DEFAULT_JVM_OPTS, JAVA_OPTS, and GRADLE_OPTS environment variables.

# For Cygwin or MSYS, switch paths to Windows format before running java
if "$cygwin" || "$msys" ; then
    APP_HOME=$( cygpath --path --mixed "$APP_HOME" )
    CLASSPATH=$( cygpath --path --mixed "$CLASSPATH" )

    JAVACMD=$( cygpath --unix "$JAVACMD" )

    # Now convert the arguments - kludge to limit ourselves to /bin/sh
    for arg do
        if
            case $arg in                                #(
              -*)   false ;;                            # don't mess with options #(
              /?*)  t=${arg#/} t=/${t%%/*}              # looks like a POSIX filepath
                    [ -e "$t" ] ;;                      #(
              *)    false ;;
            esac
        then
            arg=$( cygpath --path --ignore --mixed "$arg" )
        fi
        # Roll the args list around exactly as many times as the number of
        # args, so each arg winds up back in the position where it started, but
        # possibly modified.
        #
        # NB: a `for` loop captures its iteration list before it begins, so
        # changing the positional parameters here affects neither the number of
        # iterations, nor the values presented in `arg`.
        shift                   # remove old arg
        set -- "$@" "$arg"      # push replacement arg
    done
fi


# Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
DEFAULT_JVM_OPTS='"-Xmx64m" "-Xms64m"'

# Collect all arguments for the java command:
#   * DEFAULT_JVM_OPTS, JAVA_OPTS, and optsEnvironmentVar are not allowed to contain shell fragments,
#     and any embedded shellness will be escaped.
#   * For example: A user cannot expect ${Hostname} to be expanded, as it is an environment variable and will be
#     treated as '${Hostname}' itself on the command line.

set -- \
        "-Dorg.gradle.appname=$APP_BASE_NAME" \
        -classpath "$CLASSPATH" \
        -jar "$APP_HOME/gradle/wrapper/gradle-wrapper.jar" \
        "$@"

# Stop when "xargs" is not available.
if ! command -v xargs >/dev/null 2>&1
then
    die "xargs is not available"
fi

# Use "xargs" to parse quoted args.
#
# With -n1 it outputs one arg per line, with the quotes and backslashes removed.
#
# In Bash we could simply go:
#
#   readarray ARGS < <( xargs -n1 <<<"$var" ) &&
#   set -- "${ARGS[@]}" "$@"
#
# but POSIX shell has neither arrays nor command substitution, so instead we
# post-process each arg (as a line of input to sed) to backslash-escape any
# character that might be a shell metacharacter, then use eval to reverse
# that process (while maintaining the separation between arguments), and wrap
# the whole thing up as a single "set" statement.
#
# This will of course break if any of these variables contains a newline or
# an unmatched quote.
#

eval "set -- $(
        printf '%s\n' "$DEFAULT_JVM_OPTS $JAVA_OPTS $GRADLE_OPTS" |
        xargs -n1 |
        sed ' s~[^-[:alnum:]+,./:=@_]~\\&~g; ' |
        tr '\n' ' '
    )" '"$@"'

exec "$JAVACMD" "$@"



================================================
FILE: gradlew.bat
================================================
@rem
@rem Copyright 2015 the original author or authors.
@rem
@rem Licensed under the Apache License, Version 2.0 (the "License");
@rem you may not use this file except in compliance with the License.
@rem You may obtain a copy of the License at
@rem
@rem      https://www.apache.org/licenses/LICENSE-2.0
@rem
@rem Unless required by applicable law or agreed to in writing, software
@rem distributed under the License is distributed on an "AS IS" BASIS,
@rem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
@rem See the License for the specific language governing permissions and
@rem limitations under the License.
@rem
@rem SPDX-License-Identifier: Apache-2.0
@rem

@if "%DEBUG%"=="" @echo off
@rem ##########################################################################
@rem
@rem  Gradle startup script for Windows
@rem
@rem ##########################################################################

@rem Set local scope for the variables with windows NT shell
if "%OS%"=="Windows_NT" setlocal

set DIRNAME=%~dp0
if "%DIRNAME%"=="" set DIRNAME=.
@rem This is normally unused
set APP_BASE_NAME=%~n0
set APP_HOME=%DIRNAME%

@rem Resolve any "." and ".." in APP_HOME to make it shorter.
for %%i in ("%APP_HOME%") do set APP_HOME=%%~fi

@rem Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
set DEFAULT_JVM_OPTS="-Xmx64m" "-Xms64m"

@rem Find java.exe
if defined JAVA_HOME goto findJavaFromJavaHome

set JAVA_EXE=java.exe
%JAVA_EXE% -version >NUL 2>&1
if %ERRORLEVEL% equ 0 goto execute

echo. 1>&2
echo ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH. 1>&2
echo. 1>&2
echo Please set the JAVA_HOME variable in your environment to match the 1>&2
echo location of your Java installation. 1>&2

goto fail

:findJavaFromJavaHome
set JAVA_HOME=%JAVA_HOME:"=%
set JAVA_EXE=%JAVA_HOME%/bin/java.exe

if exist "%JAVA_EXE%" goto execute

echo. 1>&2
echo ERROR: JAVA_HOME is set to an invalid directory: %JAVA_HOME% 1>&2
echo. 1>&2
echo Please set the JAVA_HOME variable in your environment to match the 1>&2
echo location of your Java installation. 1>&2

goto fail

:execute
@rem Setup the command line

set CLASSPATH=


@rem Execute Gradle
"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %GRADLE_OPTS% "-Dorg.gradle.appname=%APP_BASE_NAME%" -classpath "%CLASSPATH%" -jar "%APP_HOME%\gradle\wrapper\gradle-wrapper.jar" %*

:end
@rem End local scope for the variables with windows NT shell
if %ERRORLEVEL% equ 0 goto mainEnd

:fail
rem Set variable GRADLE_EXIT_CONSOLE if you need the _script_ return code instead of
rem the _cmd.exe /c_ return code!
set EXIT_CODE=%ERRORLEVEL%
if %EXIT_CODE% equ 0 set EXIT_CODE=1
if not ""=="%GRADLE_EXIT_CONSOLE%" exit %EXIT_CODE%
exit /b %EXIT_CODE%

:mainEnd
if "%OS%"=="Windows_NT" endlocal

:omega



================================================
FILE: settings.gradle.kts
================================================
rootProject.name = "HomePasss"
enableFeaturePreview("TYPESAFE_PROJECT_ACCESSORS")

pluginManagement {
    includeBuild("build-logic")
    repositories {
        google {
            mavenContent {
                includeGroupAndSubgroups("androidx")
                includeGroupAndSubgroups("com.android")
                includeGroupAndSubgroups("com.google")
            }
        }
        mavenCentral()
        gradlePluginPortal()
    }
}

dependencyResolutionManagement {
    repositories {
        google {
            mavenContent {
                includeGroupAndSubgroups("androidx")
                includeGroupAndSubgroups("com.android")
                includeGroupAndSubgroups("com.google")
            }
        }
        mavenCentral()
    }
}

include(":composeApp")

include(":core")
include(":core:domain")
include(":core:data")



================================================
FILE: build-logic/gradle.properties
================================================
org.gradle.parallel=true
org.gradle.caching=true
org.gradle.configureondemand=true


================================================
FILE: build-logic/settings.gradle.kts
================================================
dependencyResolutionManagement {
    repositories {
        google()
        mavenCentral()
    }
    versionCatalogs {
        create( "libs" ) {
            from(files( "../gradle/libs.versions.toml" ))
        }
    }
}

rootProject.name = "build-logic"
include( ":convention" )


================================================
FILE: build-logic/convention/build.gradle.kts
================================================
plugins {
    `kotlin-dsl`
}

gradlePlugin {
    plugins {
        register("kotlinMultiplatform") {
            id = "com.plugins.kotlinMultiplatformPlugin"
            implementationClass = "com.yet.plugins.KotlinMultiplatformPlugin"
        }
        register("composeMultiplatform") {
            id = "com.plugins.composeMultiplatform"
            implementationClass = "com.yet.plugins.ComposeMultiplatformPlugin"
        }

        register("koinAnnotation") {
            id = "com.plugins.koin-annotation"
            displayName = "KMP Koin Annotation"
            tags = listOf("kmp", "koin-core", "koin-annotation")
            implementationClass = "com.yet.plugins.KoinAnnotationPlugin"
        }

        register("sqlDelight") {
            id = "com.plugins.sqldelight"
            displayName = "SqlDelight"
            tags = listOf("sqldelight", "kmp")
            implementationClass = "com.yet.plugins.SqlDelightConventionPlugin"
        }
    }
}

group = "com.yet.buildlogic"

dependencies {
    compileOnly(libs.android.gradlePlugin)
    compileOnly(libs.kotlin.gradlePlugin)
    compileOnly(libs.compose.gradlePlugin)
    compileOnly(libs.ksp.gradlePlugin)
}




================================================
FILE: build-logic/convention/src/main/kotlin/com/yet/convention/configureKotlinAndroid.kt
================================================
import com.android.build.api.dsl.LibraryExtension
import org.gradle.api.Project

internal fun Project.configureKotlinAndroid(
    extension: LibraryExtension,
) = extension.apply {

    val moduleName = path.split(":").drop(2).joinToString(".")
    namespace = if (moduleName.isNotEmpty()) "com.yet.$moduleName" else "com.yet.tetris"

    compileSdk = libs.findVersion("android-compileSdk").get().requiredVersion.toInt()
    defaultConfig {
        minSdk = libs.findVersion("android-minSdk").get().requiredVersion.toInt()
    }
    compileOptions {
        sourceCompatibility = JAVA_VERSION
        targetCompatibility = JAVA_VERSION
    }
    packaging {
        resources {
            excludes += "/META-INF/{AL2.0,LGPL2.1}"
        }
    }
}


================================================
FILE: build-logic/convention/src/main/kotlin/com/yet/convention/configureKotlinMultiplatform.kt
================================================
import org.gradle.api.JavaVersion
import org.gradle.api.Project
import org.jetbrains.kotlin.gradle.dsl.JvmTarget
import org.jetbrains.kotlin.gradle.dsl.KotlinMultiplatformExtension

private const val JDK_VERSION = 17
private val JVM_TARGET = JvmTarget.JVM_17
val JAVA_VERSION = JavaVersion.VERSION_17


internal fun Project.configureKotlinMultiplatform(
    extension: KotlinMultiplatformExtension,
) = extension.apply {
    jvmToolchain(JDK_VERSION)

    androidTarget {
        compilerOptions {
            jvmTarget.set(JVM_TARGET)
        }
    }

    jvm("desktop")

    iosArm64()
    iosX64()
    iosSimulatorArm64()

    macosX64()
    macosArm64()

    applyDefaultHierarchyTemplate()

    //common dependencies
    sourceSets.apply {
        commonMain {
            dependencies {
                api(libs.findLibrary("kotlinx-coroutines-core").get())
                api(libs.findLibrary("kotlinx-datetime").get())
                api(libs.findLibrary("kotlinx-serialization-json").get())
            }
        }
        commonTest.dependencies {
            implementation(libs.findBundle("testing").get())
        }
    }
}


================================================
FILE: build-logic/convention/src/main/kotlin/com/yet/convention/Libs.kt
================================================
import org.gradle.api.Project
import org.gradle.api.artifacts.VersionCatalog
import org.gradle.api.artifacts.VersionCatalogsExtension
import org.gradle.kotlin.dsl.getByType

internal val Project.libs
    get(): VersionCatalog = extensions
        .getByType<VersionCatalogsExtension>().named("libs")


================================================
FILE: build-logic/convention/src/main/kotlin/com/yet/plugins/ComposeMultiplatformPlugin.kt
================================================
package com.yet.plugins

import libs
import org.gradle.api.Plugin
import org.gradle.api.Project
import org.gradle.kotlin.dsl.configure
import org.gradle.kotlin.dsl.getByType
import org.jetbrains.compose.ComposeExtension
import org.jetbrains.kotlin.gradle.dsl.KotlinMultiplatformExtension

class ComposeMultiplatformPlugin : Plugin<Project> {
    override fun apply(target: Project) = with(target) {
        with(pluginManager) {
            apply(libs.findPlugin("composeMultiplatform").get().get().pluginId)
            apply(libs.findPlugin("composeCompiler").get().get().pluginId)
        }

        val composeDeps = extensions.getByType<ComposeExtension>().dependencies

        extensions.configure<KotlinMultiplatformExtension> {
            sourceSets.apply {
                commonMain {
                    dependencies {
                        implementation(composeDeps.runtime)
                        implementation(composeDeps.foundation)
                        implementation(composeDeps.material3)
                        implementation(composeDeps.materialIconsExtended)
                    }
                }
            }
        }
    }
}


================================================
FILE: build-logic/convention/src/main/kotlin/com/yet/plugins/KoinAnnotationPlugin.kt
================================================
package com.yet.plugins

import com.google.devtools.ksp.gradle.KspExtension
import libs
import org.gradle.api.Plugin
import org.gradle.api.Project
import org.gradle.kotlin.dsl.dependencies
import org.gradle.kotlin.dsl.getByType
import org.jetbrains.kotlin.gradle.dsl.KotlinMultiplatformExtension

class KoinAnnotationPlugin : Plugin<Project> {

    override fun apply(target: Project): Unit = with(target) {
        with(pluginManager) {
            apply(libs.findPlugin("ksp").get().get().pluginId)
        }

        extensions.getByType<KotlinMultiplatformExtension>().apply {
            sourceSets.getByName("commonMain").dependencies {
                implementation(libs.findLibrary("koin-core").get())
                implementation(libs.findLibrary("koin-annotation").get())
                implementation(libs.findLibrary("koin-jsr330").get())
            }
            sourceSets.named("commonMain").configure {
                kotlin.srcDir("build/generated/ksp/metadata/commonMain/kotlin")
            }
        }

        dependencies {
            add("kspCommonMainMetadata", libs.findLibrary("koin-annotation-compiler").get())
            add("kspAndroid", libs.findLibrary("koin-annotation-compiler").get())
            add("kspIosX64", libs.findLibrary("koin-annotation-compiler").get())
            add("kspIosArm64", libs.findLibrary("koin-annotation-compiler").get())
            add("kspIosSimulatorArm64", libs.findLibrary("koin-annotation-compiler").get())

        }

        extensions.getByType<KspExtension>().apply {
            arg("KOIN_CONFIG_CHECK", "true")
        }

        tasks.matching { it.name.startsWith("ksp") && it.name != "kspCommonMainKotlinMetadata" }.configureEach {
            dependsOn("kspCommonMainKotlinMetadata")
        }
    }
}


================================================
FILE: build-logic/convention/src/main/kotlin/com/yet/plugins/KotlinMultiplatformPlugin.kt
================================================
package com.yet.plugins

import com.android.build.api.dsl.LibraryExtension
import configureKotlinAndroid
import configureKotlinMultiplatform
import libs
import org.gradle.api.Plugin
import org.gradle.api.Project
import org.gradle.kotlin.dsl.configure
import org.jetbrains.kotlin.gradle.dsl.KotlinMultiplatformExtension

class KotlinMultiplatformPlugin : Plugin<Project> {

    override fun apply(target: Project): Unit = with(target) {
        with(pluginManager) {
            apply(libs.findPlugin("kotlinMultiplatform").get().get().pluginId)
            apply(libs.findPlugin("androidLibrary").get().get().pluginId)
            apply(libs.findPlugin("kotlin-serialization").get().get().pluginId)
        }

        extensions.configure<KotlinMultiplatformExtension>(::configureKotlinMultiplatform)
        extensions.configure<LibraryExtension>(::configureKotlinAndroid)
    }
}


================================================
FILE: build-logic/convention/src/main/kotlin/com/yet/plugins/SqlDelightConventionPlugin.kt
================================================
package com.yet.plugins

import libs
import org.gradle.api.Plugin
import org.gradle.api.Project
import org.gradle.kotlin.dsl.configure
import org.jetbrains.kotlin.gradle.dsl.KotlinMultiplatformExtension

class SqlDelightConventionPlugin : Plugin<Project> {

    override fun apply(target: Project): Unit = with(target) {
        with(pluginManager) {
            apply(libs.findPlugin("ksp").get().get().pluginId)
            apply(libs.findPlugin("sqlDelight").get().get().pluginId)
        }

        extensions.configure<KotlinMultiplatformExtension> {
            sourceSets.apply {
                commonMain.dependencies {
                    implementation(libs.findLibrary("sqldelight-coroutines-extensions").get())
                }

                commonTest.dependencies {
                    implementation(libs.findBundle("testing").get())
                }

                androidMain.dependencies {
                    implementation(libs.findLibrary("sqldelight-driver").get())
                    implementation(libs.findLibrary("sqldelight-android").get())
                }

                androidUnitTest.dependencies {
                    implementation(libs.findLibrary("sqldelight-driver").get())
                }

                nativeMain.dependencies {
                    implementation(libs.findLibrary("sqldelight-native").get())
                }

                nativeTest.dependencies {
                    implementation(libs.findLibrary("sqldelight-native").get())
                }

                findByName("desktopMain")?.dependencies {
                    implementation(libs.findLibrary("sqldelight-driver").get())
                }

                findByName("desktopTest")?.dependencies {
                    implementation(libs.findLibrary("sqldelight-driver").get())
                }

                jsMain.dependencies {
                    implementation(libs.findLibrary("sqldelight-js").get())

                    implementation(npm("@cashapp/sqldelight-sqljs-worker", "2.1.0"))
                    implementation(npm("@sqlite.org/sqlite-wasm", "3.43.2-build1"))
                    implementation(npm("sql.js", "1.6.2"))
                    implementation(devNpm("copy-webpack-plugin", "9.1.0"))
                    implementation(npm("@js-joda/timezone", "2.3.0"))
                }

                jsTest.dependencies {
                    implementation(libs.findLibrary("sqldelight-js").get())

                    implementation(npm("@cashapp/sqldelight-sqljs-worker", "2.1.0"))
                    implementation(npm("sql.js", "1.6.2"))
                    implementation(devNpm("copy-webpack-plugin", "9.1.0"))
                    implementation(npm("@js-joda/timezone", "2.3.0"))
                }
            }
        }
    }
}


================================================
FILE: composeApp/build.gradle.kts
================================================
import org.jetbrains.kotlin.gradle.dsl.JvmTarget

plugins {
    alias(libs.plugins.kotlinMultiplatform)
    alias(libs.plugins.androidApplication)
    alias(libs.plugins.composeMultiplatform)
    alias(libs.plugins.composeCompiler)
    alias(libs.plugins.kotlin.serialization)
    alias(libs.plugins.ksp)
}

kotlin {
    androidTarget {
        compilerOptions {
            jvmTarget.set(JvmTarget.JVM_11)
        }
    }
    
    listOf(
        iosArm64(),
        iosSimulatorArm64()
    ).forEach { iosTarget ->
        iosTarget.binaries.framework {
            baseName = "ComposeApp"
            isStatic = true
        }
    }
    
    sourceSets {
        androidMain.dependencies {
            implementation(compose.preview)
            implementation(libs.androidx.activity.compose)
            implementation(libs.koin.android)
        }
        commonMain.dependencies {
            implementation(compose.runtime)
            implementation(compose.foundation)
            implementation(compose.material3)
            implementation(compose.material3AdaptiveNavigationSuite)
            implementation(compose.materialIconsExtended)
            implementation(compose.ui)
            implementation(compose.components.resources)
            implementation(compose.components.uiToolingPreview)
            implementation(libs.androidx.lifecycle.viewmodelCompose)
            implementation(libs.androidx.lifecycle.runtimeCompose)
            implementation(libs.androidx.navigation.compose)
            implementation(libs.bundles.coil3)

            implementation(libs.koin.core)
            implementation(libs.koin.annotation)
            implementation(libs.koin.jsr330)
            implementation(libs.koin.compose)
            implementation(libs.koin.compose.viewmodel)
            implementation(libs.koin.compose.viewmodel.navigation)

            implementation(libs.kotlinx.serialization.json)

            implementation(projects.core.domain)
            implementation(projects.core.data)
        }
        commonTest.dependencies {
            implementation(libs.kotlin.test)
        }
        sourceSets.named("commonMain").configure {
            kotlin.srcDir("build/generated/ksp/metadata/commonMain/kotlin")
        }
    }
}

android {
    namespace = "com.yet.home"
    compileSdk = libs.versions.android.compileSdk.get().toInt()

    defaultConfig {
        applicationId = "com.yet.home"
        minSdk = libs.versions.android.minSdk.get().toInt()
        targetSdk = libs.versions.android.targetSdk.get().toInt()
        versionCode = 1
        versionName = "1.0"
    }
    packaging {
        resources {
            excludes += "/META-INF/{AL2.0,LGPL2.1}"
        }
    }
    buildTypes {
        getByName("release") {
            isMinifyEnabled = false
        }
    }
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
}

dependencies {
    debugImplementation(compose.uiTooling)

    add("kspCommonMainMetadata", libs.koin.annotation.compiler)
    add("kspAndroid", libs.koin.annotation.compiler)
    add("kspIosArm64", libs.koin.annotation.compiler)
    add("kspIosSimulatorArm64", libs.koin.annotation.compiler)

}

ksp {
    arg("KOIN_CONFIG_CHECK","true")
}

tasks.matching { it.name.startsWith("ksp") && it.name != "kspCommonMainKotlinMetadata" }.configureEach {
    dependsOn("kspCommonMainKotlinMetadata")
}




================================================
FILE: composeApp/src/androidMain/AndroidManifest.xml
================================================
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
    <uses-permission android:name="android.permission.INTERNET" />

    <application
        android:name=".HomePasssApp"
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:networkSecurityConfig="@xml/network_security_config"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:theme="@android:style/Theme.Material.Light.NoActionBar">
        <activity
            android:exported="true"
            android:name=".MainActivity">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />

                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
    </application>

</manifest>


================================================
FILE: composeApp/src/androidMain/kotlin/com/yet/home/HomePasssApp.kt
================================================
package com.yet.home

import android.app.Application
import com.yet.home.di.initKoin
import org.koin.android.ext.koin.androidContext
import org.koin.android.ext.koin.androidLogger

class HomePasssApp : Application() {
    override fun onCreate() {
        super.onCreate()
        initKoin {
            androidLogger()
            androidContext(this@HomePasssApp)
        }
    }
}


================================================
FILE: composeApp/src/androidMain/kotlin/com/yet/home/MainActivity.kt
================================================
package com.yet.home

import android.os.Bundle
import androidx.activity.ComponentActivity
import androidx.activity.compose.setContent
import androidx.activity.enableEdgeToEdge
import androidx.compose.runtime.Composable
import androidx.compose.ui.tooling.preview.Preview

class MainActivity : ComponentActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        enableEdgeToEdge()
        super.onCreate(savedInstanceState)

        setContent {
            App()
        }
    }
}

@Preview
@Composable
fun AppAndroidPreview() {
    App()
}


================================================
FILE: composeApp/src/androidMain/kotlin/com/yet/home/Platform.android.kt
================================================
package com.yet.home

import android.os.Build

class AndroidPlatform : Platform {
    override val name: String = "Android ${Build.VERSION.SDK_INT}"
}

actual fun getPlatform(): Platform = AndroidPlatform()


================================================
FILE: composeApp/src/androidMain/res/drawable/ic_launcher_background.xml
================================================
<?xml version="1.0" encoding="utf-8"?>
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="108dp"
    android:height="108dp"
    android:viewportWidth="108"
    android:viewportHeight="108">
    <path
        android:fillColor="#3DDC84"
        android:pathData="M0,0h108v108h-108z" />
    <path
        android:fillColor="#00000000"
        android:pathData="M9,0L9,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,0L19,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M29,0L29,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M39,0L39,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M49,0L49,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M59,0L59,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M69,0L69,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M79,0L79,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M89,0L89,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M99,0L99,108"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,9L108,9"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,19L108,19"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,29L108,29"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,39L108,39"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,49L108,49"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,59L108,59"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,69L108,69"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,79L108,79"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,89L108,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M0,99L108,99"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,29L89,29"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,39L89,39"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,49L89,49"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,59L89,59"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,69L89,69"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M19,79L89,79"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M29,19L29,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M39,19L39,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M49,19L49,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M59,19L59,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M69,19L69,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
    <path
        android:fillColor="#00000000"
        android:pathData="M79,19L79,89"
        android:strokeWidth="0.8"
        android:strokeColor="#33FFFFFF" />
</vector>


================================================
FILE: composeApp/src/androidMain/res/drawable-v24/ic_launcher_foreground.xml
================================================
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:aapt="http://schemas.android.com/aapt"
    android:width="108dp"
    android:height="108dp"
    android:viewportWidth="108"
    android:viewportHeight="108">
    <path android:pathData="M31,63.928c0,0 6.4,-11 12.1,-13.1c7.2,-2.6 26,-1.4 26,-1.4l38.1,38.1L107,108.928l-32,-1L31,63.928z">
        <aapt:attr name="android:fillColor">
            <gradient
                android:endX="85.84757"
                android:endY="92.4963"
                android:startX="42.9492"
                android:startY="49.59793"
                android:type="linear">
                <item
                    android:color="#44000000"
                    android:offset="0.0" />
                <item
                    android:color="#00000000"
                    android:offset="1.0" />
            </gradient>
        </aapt:attr>
    </path>
    <path
        android:fillColor="#FFFFFF"
        android:fillType="nonZero"
        android:pathData="M65.3,45.828l3.8,-6.6c0.2,-0.4 0.1,-0.9 -0.3,-1.1c-0.4,-0.2 -0.9,-0.1 -1.1,0.3l-3.9,6.7c-6.3,-2.8 -13.4,-2.8 -19.7,0l-3.9,-6.7c-0.2,-0.4 -0.7,-0.5 -1.1,-0.3C38.8,38.328 38.7,38.828 38.9,39.228l3.8,6.6C36.2,49.428 31.7,56.028 31,63.928h46C76.3,56.028 71.8,49.428 65.3,45.828zM43.4,57.328c-0.8,0 -1.5,-0.5 -1.8,-1.2c-0.3,-0.7 -0.1,-1.5 0.4,-2.1c0.5,-0.5 1.4,-0.7 2.1,-0.4c0.7,0.3 1.2,1 1.2,1.8C45.3,56.528 44.5,57.328 43.4,57.328L43.4,57.328zM64.6,57.328c-0.8,0 -1.5,-0.5 -1.8,-1.2s-0.1,-1.5 0.4,-2.1c0.5,-0.5 1.4,-0.7 2.1,-0.4c0.7,0.3 1.2,1 1.2,1.8C66.5,56.528 65.6,57.328 64.6,57.328L64.6,57.328z"
        android:strokeWidth="1"
        android:strokeColor="#00000000" />
</vector>


================================================
FILE: composeApp/src/androidMain/res/mipmap-anydpi-v26/ic_launcher.xml
================================================
<?xml version="1.0" encoding="utf-8"?>
<adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">
    <background android:drawable="@drawable/ic_launcher_background" />
    <foreground android:drawable="@drawable/ic_launcher_foreground" />
</adaptive-icon>


================================================
FILE: composeApp/src/androidMain/res/mipmap-anydpi-v26/ic_launcher_round.xml
================================================
<?xml version="1.0" encoding="utf-8"?>
<adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">
    <background android:drawable="@drawable/ic_launcher_background" />
    <foreground android:drawable="@drawable/ic_launcher_foreground" />
</adaptive-icon>


================================================
FILE: composeApp/src/androidMain/res/values/strings.xml
================================================
<resources>
    <string name="app_name">HomePasss</string>
</resources>


================================================
FILE: composeApp/src/androidMain/res/xml/network_security_config.xml
================================================
<?xml version="1.0" encoding="utf-8"?>
<network-security-config>
    <domain-config cleartextTrafficPermitted="true">
        <domain includeSubdomains="false">jumbo.galagen.net</domain>
    </domain-config>
</network-security-config>




================================================
FILE: composeApp/src/commonMain/composeResources/drawable/compose-multiplatform.xml
================================================
<vector
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:aapt="http://schemas.android.com/aapt"
    android:width="450dp"
    android:height="450dp"
    android:viewportWidth="64"
    android:viewportHeight="64">
  <path
      android:pathData="M56.25,18V46L32,60 7.75,46V18L32,4Z"
      android:fillColor="#6075f2"/>
  <path
      android:pathData="m41.5,26.5v11L32,43V60L56.25,46V18Z"
      android:fillColor="#6b57ff"/>
  <path
      android:pathData="m32,43 l-9.5,-5.5v-11L7.75,18V46L32,60Z">
    <aapt:attr name="android:fillColor">
      <gradient
          android:centerX="23.131"
          android:centerY="18.441"
          android:gradientRadius="42.132"
          android:type="radial">
        <item android:offset="0" android:color="#FF5383EC"/>
        <item android:offset="0.867" android:color="#FF7F52FF"/>
      </gradient>
    </aapt:attr>
  </path>
  <path
      android:pathData="M22.5,26.5 L32,21 41.5,26.5 56.25,18 32,4 7.75,18Z">
    <aapt:attr name="android:fillColor">
      <gradient
          android:startX="44.172"
          android:startY="4.377"
          android:endX="17.973"
          android:endY="34.035"
          android:type="linear">
        <item android:offset="0" android:color="#FF33C3FF"/>
        <item android:offset="0.878" android:color="#FF5383EC"/>
      </gradient>
    </aapt:attr>
  </path>
  <path
      android:pathData="m32,21 l9.526,5.5v11L32,43 22.474,37.5v-11z"
      android:fillColor="#000000"/>
</vector>


================================================
FILE: composeApp/src/commonMain/composeResources/values-en/strings.xml
================================================
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <!-- App -->
    <string name="app_name">HomePass</string>

    <!-- Navigation -->
    <string name="nav_home">Home</string>
    <string name="nav_search">Search</string>
    <string name="nav_investments">Investments</string>
    <string name="nav_portfolio">Portfolio</string>
    <string name="nav_profile">Profile</string>

    <!-- Auth Screen -->
    <string name="auth_login">Log In</string>
    <string name="auth_register">Register</string>
    <string name="auth_name">Name</string>
    <string name="auth_email">Email</string>
    <string name="auth_password">Password</string>
    <string name="auth_login_button">Log In</string>
    <string name="auth_register_button">Sign Up</string>
    <string name="auth_invalid_credentials">Invalid credentials</string>
    <string name="auth_registration_success">Registration successful</string>

    <!-- Home Screen -->
    <string name="home_welcome">Welcome,</string>
    <string name="home_total_portfolio">Total Portfolio</string>
    <string name="home_portfolio_change">+$%1$s (%2$s%%)</string>
    <string name="home_favorites">Favorites</string>
    <string name="home_all">All</string>
    <string name="home_from">From</string>
    <string name="home_available_percent">%1$d%% Available</string>
    <string name="home_featured_listings">Featured Properties</string>
    <string name="home_featured_coming_soon">Featured properties coming soon</string>

    <!-- Search Screen -->
    <string name="search_hint">City, district, property...</string>
    <string name="search_searching">Searching...</string>
    <string name="search_no_results">No results found</string>
    <string name="search_try_again">Try changing your query</string>
    <string name="search_start_searching">Start searching</string>
    <string name="search_enter_location">Enter an address, city, or property type</string>
    <string name="search_results">Search Results (%d)</string>
    <string name="search_found_objects">Found %1$d properties</string>
    <string name="search_sort_by_popularity">By popularity</string>
    <string name="search_sort_by_price_low">By price: low to high</string>
    <string name="search_sort_by_price_high">By price: high to low</string>
    <string name="search_sort_by_newest">Newest first</string>
    <string name="search_filter_type">Type</string>
    <string name="search_filter_price">Price</string>
    <string name="search_filter_all">All</string>
    <string name="search_filter_whole">Whole Ownership</string>
    <string name="search_filter_fractional">Fractional Ownership</string>

    <!-- Portfolio Screen -->
    <string name="portfolio_title">Portfolio</string>
    <string name="portfolio_total_value">Total Portfolio Value</string>
    <string name="portfolio_investments">Investments (%1$d)</string>
    <string name="portfolio_property_shares">Property Shares (%1$d)</string>
    <string name="portfolio_empty">Your portfolio is empty</string>
    <string name="portfolio_start_investing">Start investing in real estate</string>
    <string name="portfolio_invested">Invested: $%s</string>
    <string name="portfolio_date">Date: %s</string>
    <string name="portfolio_share_percentage">Share: %s%%</string>
    <string name="portfolio_current_value">Value: $%s</string>

    <!-- Profile Screen -->
    <string name="profile_title">Profile</string>
    <string name="profile_personal_info">Personal Information</string>
    <string name="profile_name">Name</string>
    <string name="profile_email">Email</string>
    <string name="profile_role">Role</string>
    <string name="profile_logout">Log Out</string>
    <string name="profile_user_not_found">User not found</string>
    <string name="profile_refresh">Refresh</string>
    <string name="profile_auth_required">You need to be logged in to view your profile</string>
    <string name="profile_login_button">Log In</string>
    <string name="profile_total_value_title">Total value</string>
    <string name="profile_portfolio_dynamics">Portfolio dynamics</string>
    <string name="profile_asset_distribution">Asset distribution</string>
    <string name="profile_my_objects">My objects</string>
    <string name="profile_asset_residential">Residential real estate</string>
    <string name="profile_asset_commercial">Commercial real estate</string>
    <string name="profile_asset_land">Land plots</string>
    <string name="profile_asset_parking">Parking lots</string>
    <string name="profile_chart_placeholder">Dynamics chart</string>
    <string name="profile_share">Share</string>
    <string name="profile_monthly_income">Income/month</string>
    <string name="profile_details">Details</string>
    <string name="profile_total_income">Total income</string>
    <string name="profile_per_month">per month</string>
    <string name="profile_objects">Objects</string>
    <string name="profile_in_portfolio">in portfolio</string>
    <string name="profile_asset_legend">%1$s - %2$d%%</string>

    <!-- Property Details Screen -->
    <string name="details_title">Property Details</string>
    <string name="details_bedrooms">Bedrooms</string>
    <string name="details_area">Area</string>
    <string name="details_yield">Yield</string>
    <string name="details_investment_info">Investment Information</string>
    <string name="details_min_share">Minimum Share</string>
    <string name="details_from">From</string>
    <string name="details_current_investors">Current investors</string>
    <string name="details_available">Available</string>
    <string name="details_projected_income">Projected income/year</string>
    <string name="details_description">Description</string>
    <string name="details_full_purchase">Full purchase</string>
    <string name="details_invest">Invest</string>

    <!-- Invest Screen -->
    <string name="invest_title">Investment</string>
    <string name="invest_amount">Investment Amount</string>
    <string name="invest_min_amount">Minimum amount: %1$s</string>
    <string name="invest_confirm">Confirm Investment</string>
    <string name="invest_estimated_share">Estimated Share</string>
    <string name="invest_estimated_income">Estimated Income/Year</string>

    <!-- Investment Flow Screen -->
    <string name="invest_flow_choose_share">Choose Share</string>
    <string name="invest_flow_choose_share_subtitle">Determine the size of your investment in the property</string>
    <string name="invest_flow_continue">Continue</string>
    <string name="invest_flow_review_title">Document Review</string>
    <string name="invest_flow_review_subtitle">Make sure all information is correct</string>
    <string name="invest_flow_payment_title">Payment</string>
    <string name="invest_flow_payment_subtitle">Choose payment method</string>
    <string name="invest_flow_confirm_payment">Confirm Payment</string>
    <string name="invest_flow_share_ownership">Share of Ownership</string>
    <string name="invest_flow_investment_details">Investment Details</string>
    <string name="invest_flow_documents">Documents</string>
    <string name="invest_flow_security_message">All payments are protected and processed through a secure connection</string>
    <string name="invest_flow_card_data">Card Data</string>
    <string name="invest_flow_card_number">Card Number</string>
    <string name="invest_flow_card_number_placeholder">1234 5678 9012 3456</string>
    <string name="invest_flow_card_number_error">Only Visa and MasterCard are supported</string>
    <string name="invest_flow_card_expiry">Expiry Date</string>
    <string name="invest_flow_card_expiry_placeholder">MM/YY</string>
    <string name="invest_flow_card_expiry_error">Format: MM/YY</string>
    <string name="invest_flow_card_cvv">CVV</string>
    <string name="invest_flow_card_cvv_placeholder">123</string>
    <string name="invest_flow_card_cvv_error">3 digits</string>
    <string name="invest_flow_card_holder_name">Card Holder Name</string>
    <string name="invest_flow_card_holder_name_placeholder">IVAN IVANOV</string>
    <string name="invest_flow_close">Close</string>
    <string name="invest_flow_total_cost">Total Cost</string>
    <string name="invest_flow_object">Property</string>
    <string name="invest_flow_share">Share</string>
    <string name="invest_flow_amount">Amount</string>
    <string name="invest_flow_platform_commission">Platform Commission</string>
    <string name="invest_flow_total_to_pay">Total to Pay</string>
    <string name="invest_flow_investment_amount">Investment Amount</string>
    <string name="invest_flow_income_per_year">Income per Year</string>
    <string name="invest_flow_income_per_month">Income per Month</string>
    <string name="invest_flow_payment_apple_pay">Apple Pay</string>
    <string name="invest_flow_payment_recommended">Recommended</string>
    <string name="invest_flow_payment_bank_card">Bank Card</string>
    <string name="invest_flow_payment_bank_transfer">Bank Transfer</string>
    <string name="invest_flow_document_ownership">Shared Ownership Agreement</string>
    <string name="invest_flow_document_egrn">EGRN Extract</string>
    <string name="invest_flow_document_technical">Technical Documentation</string>
    <string name="invest_flow_card_type_visa">Visa</string>
    <string name="invest_flow_card_type_mastercard">MasterCard</string>
    <string name="common_square_meters">m²</string>

    <!-- Investment Success Screen -->
    <string name="invest_success_title">Investment Completed!</string>
    <string name="invest_success_message">Congratulations! You have successfully become a co-owner of real estate. Documents have been sent to your email.</string>
    <string name="invest_success_go_to_portfolio">Go to Portfolio</string>
    <string name="invest_success_share">Share</string>
    <string name="invest_success_your_share">Your Share</string>

    <!-- Investments Screen -->
    <string name="investments_search_hint">Search companies...</string>
    <string name="investments_companies_found">Companies found: %1$d</string>
    <string name="investments_no_results">No companies found</string>
    <string name="investments_try_again">Try changing your query</string>
    <string name="investments_expected_return">Return: %1$s%%</string>
    <string name="investments_investors">%1$s investors</string>
    <string name="investments_min_investment">Min. Investment</string>
    <string name="investments_projects_completed">Projects: %1$d/%2$d</string>
    <string name="investments_loading">Loading...</string>
    <string name="investments_error">Error</string>
    <string name="investments_search">Search</string>
    <string name="investments_clear">Clear</string>

    <!-- Construction Company Details Screen -->
    <string name="company_details_about">About</string>
    <string name="company_details_invest">Invest</string>
    <string name="company_details_investment_progress">Investment Progress</string>
    <string name="company_details_investors">Investors</string>
    <string name="company_details_location">Location</string>
    <string name="company_details_min_investment">Minimum Investment</string>
    <string name="company_details_projects">Projects</string>
    <string name="company_details_rating">Rating</string>
    <string name="company_details_statistics">Statistics</string>
    <string name="company_details_expected_return">Expected Return</string>

    <!-- Common -->
    <string name="common_price">$%s</string>
    <string name="common_currency_rubles">$%s</string>
    <string name="guest">Guest</string>
</resources>



================================================
FILE: composeApp/src/commonMain/composeResources/values-ru/strings.xml
================================================
[Binary file]


================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/App.kt
================================================
package com.yet.home

import androidx.compose.runtime.Composable
import com.yet.home.ui.component.theme.HomeTheme
import com.yet.home.ui.navigation.AppNavigation
import org.jetbrains.compose.ui.tooling.preview.Preview

@Composable
@Preview
fun App() {
    HomeTheme {
        AppNavigation()
    }
}


================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/Greeting.kt
================================================
package com.yet.home

class Greeting {
    private val platform = getPlatform()

    fun greet(): String {
        return "Hello, ${platform.name}!"
    }
}


================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/Platform.kt
================================================
package com.yet.home

interface Platform {
    val name: String
}

expect fun getPlatform(): Platform


================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/di/AppModule.kt
================================================
package com.yet.home.di

import org.koin.core.annotation.ComponentScan
import org.koin.core.annotation.Module


@Module()
@ComponentScan("com.yet.home")
class AppModule()


================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/di/InitKoin.kt
================================================
package com.yet.home.di


import com.yet.data.di.DataModule
import org.koin.core.context.startKoin
import org.koin.dsl.KoinAppDeclaration
import org.koin.ksp.generated.module
import kotlin.js.ExperimentalJsExport
import kotlin.js.JsExport

@OptIn(ExperimentalJsExport::class)
@JsExport
fun initKoin(config: KoinAppDeclaration? = null) {
    startKoin {
        modules(
            DataModule().module,
            AppModule().module,
        )
        config?.invoke(this)
    }
}


================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/ui/component/theme/ColorScheme.kt
================================================
[Binary file]


================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/ui/component/theme/dashboardBackground.kt
================================================
package com.yet.home.ui.component.theme

import androidx.compose.ui.graphics.Brush
import androidx.compose.ui.graphics.Color

val dashboardBackground = Brush.verticalGradient(
    colors = listOf(
        Color(0xFF0F172A), // slate-900
        Color(0xFF064E3B), // emerald-950
        Color(0xFF0F172A)  // slate-900
    )
)


================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/ui/component/theme/Theme.kt
================================================
package com.yet.home.ui.component.theme

import androidx.compose.foundation.isSystemInDarkTheme
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.Shapes
import androidx.compose.material3.Typography
import androidx.compose.runtime.Composable
import androidx.compose.runtime.CompositionLocalProvider
import androidx.compose.runtime.staticCompositionLocalOf


@Composable
fun HomeTheme(
    darkTheme: Boolean = isSystemInDarkTheme(),
    content: @Composable () -> Unit
) {
//    val colorScheme = if (darkTheme) DarkColorScheme else LightColorScheme
    val colorScheme = DarkColorScheme


    MaterialTheme(
        colorScheme = colorScheme,
        content = content
    )
}



================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/ui/components/ProgressIndicator.kt
================================================
package com.yet.home.ui.components

import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.Check
import androidx.compose.material3.Icon
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.Surface
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.unit.dp

@Composable
fun InvestmentProgressIndicator(
    currentStep: Int,
    totalSteps: Int = 3,
    modifier: Modifier = Modifier
) {
    Row(
        modifier = modifier
            .fillMaxWidth()
            .padding(horizontal = 16.dp, vertical = 16.dp),
        horizontalArrangement = Arrangement.SpaceBetween,
        verticalAlignment = Alignment.CenterVertically
    ) {
        repeat(totalSteps) { step ->
            val stepNumber = step + 1
            val isCompleted = stepNumber < currentStep
            val isCurrent = stepNumber == currentStep
            
            // Step circle
            Box(
                modifier = Modifier.size(32.dp),
                contentAlignment = Alignment.Center
            ) {
                Surface(
                    modifier = Modifier.size(32.dp),
                    shape = CircleShape,
                    color = when {
                        isCompleted || isCurrent -> MaterialTheme.colorScheme.primary
                        else -> Color.White.copy(alpha = 0.2f)
                    }
                ) {
                    Box(
                        modifier = Modifier.fillMaxWidth(),
                        contentAlignment = Alignment.Center
                    ) {
                        if (isCompleted) {
                            Icon(
                                imageVector = Icons.Default.Check,
                                contentDescription = null,
                                tint = Color.White,
                                modifier = Modifier.size(20.dp)
                            )
                        } else {
                            Text(
                                text = stepNumber.toString(),
                                style = MaterialTheme.typography.labelLarge,
                                color = Color.White
                            )
                        }
                    }
                }
            }
            
            // Connector line (except for last step)
            if (stepNumber < totalSteps) {
                Surface(
                    modifier = Modifier
                        .weight(1f)
                        .height(2.dp)
                        .padding(horizontal = 8.dp),
                    color = if (stepNumber < currentStep) {
                        MaterialTheme.colorScheme.primary
                    } else {
                        Color.White.copy(alpha = 0.2f)
                    }
                ) {}
            }
        }
    }
}




================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/ui/navigation/AppNavigation.kt
================================================
package com.yet.home.ui.navigation

import androidx.compose.runtime.Composable

@Composable
fun AppNavigation() {
    // Always show main navigation, authentication check will be handled in profile screen
    MainNavigation()
}



================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/ui/navigation/BottomNavigationBar.kt
================================================
package com.yet.home.ui.navigation

import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.Home
import homepasss.composeapp.generated.resources.Res
import homepasss.composeapp.generated.resources.nav_home
import homepasss.composeapp.generated.resources.nav_investments
import homepasss.composeapp.generated.resources.nav_profile
import homepasss.composeapp.generated.resources.nav_search
import org.jetbrains.compose.resources.stringResource
import androidx.compose.material.icons.filled.Person
import androidx.compose.material.icons.filled.Search
import androidx.compose.material.icons.filled.TrendingUp
import androidx.compose.material3.Icon
import androidx.compose.material3.Text
import androidx.compose.material3.adaptive.navigationsuite.NavigationSuiteScope
import androidx.compose.runtime.Composable
import androidx.compose.ui.graphics.vector.ImageVector
import com.yet.home.viewmodel.BottomNavTab

fun NavigationSuiteScope.bottomNavigationBarItem(
    selectedTab: BottomNavTab,
    onTabSelected: (BottomNavTab) -> Unit
){
    BottomNavTab.entries.forEach { tab ->
        item(
            icon = {
                Icon(
                    imageVector = tab.icon,
                    contentDescription = tab.title
                )
            },
            label = { Text(tab.title) },
            selected = selectedTab == tab,
            onClick = { onTabSelected(tab) }
        )
    }
}
private val BottomNavTab.icon: ImageVector
    get() = when (this) {
        BottomNavTab.HOME -> Icons.Default.Home
        BottomNavTab.SEARCH -> Icons.Default.Search
        BottomNavTab.INVESTMENTS -> Icons.Default.TrendingUp
        BottomNavTab.PROFILE -> Icons.Default.Person
    }

private val BottomNavTab.title: String
    @Composable
    get() = when (this) {
        BottomNavTab.HOME -> stringResource(Res.string.nav_home)
        BottomNavTab.SEARCH -> stringResource(Res.string.nav_search)
        BottomNavTab.INVESTMENTS -> stringResource(Res.string.nav_investments)
        BottomNavTab.PROFILE -> stringResource(Res.string.nav_profile)
    }



================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/ui/navigation/MainNavigation.kt
================================================
package com.yet.home.ui.navigation

import androidx.compose.material3.adaptive.navigationsuite.NavigationSuiteScaffold
import androidx.compose.runtime.Composable
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.setValue
import androidx.navigation.NavBackStackEntry
import androidx.navigation.compose.NavHost
import androidx.navigation.compose.composable
import androidx.navigation.compose.rememberNavController
import androidx.navigation.toRoute
import com.yet.home.ui.screens.AuthScreen
import com.yet.home.ui.screens.CompanyInvestmentFlowScreen
import com.yet.home.ui.screens.ConstructionCompanyDetailsBottomSheet
import com.yet.home.ui.screens.HomeScreen
import com.yet.home.ui.screens.InvestmentFlowScreen
import com.yet.home.ui.screens.InvestmentSuccessScreen
import com.yet.home.ui.screens.InvestmentsScreen
import com.yet.home.ui.screens.ProfileScreen
import com.yet.home.ui.screens.PropertyDetailsBottomSheet
import com.yet.home.ui.screens.SearchScreen
import com.yet.home.viewmodel.BottomNavTab
import com.yet.home.viewmodel.MainViewModel
import org.koin.compose.viewmodel.koinViewModel

@Composable
fun MainNavigation() {
    val viewModel = koinViewModel<MainViewModel>()
    val selectedTab by viewModel.selectedTab.collectAsState()
    var showAuthScreen by remember { mutableStateOf(false) }
    val navController = rememberNavController()

    if (showAuthScreen) {
        AuthScreen(
            onAuthSuccess = {
                showAuthScreen = false
            }
        )
    } else {
        NavigationSuiteScaffold(
            navigationSuiteItems = {
                bottomNavigationBarItem(
                    selectedTab = selectedTab,
                    onTabSelected = { viewModel.selectTab(it) }
                )
            },
            content = {
                NavHost(
                    navController = navController,
                    startDestination = when (selectedTab) {
                        BottomNavTab.HOME -> NavDestination.Home
                        BottomNavTab.SEARCH -> NavDestination.Search
                        BottomNavTab.INVESTMENTS -> NavDestination.Investments
                        BottomNavTab.PROFILE -> NavDestination.Profile
                    },
                ) {
                    composable<NavDestination.Home> {
                        HomeScreen(navController = navController)
                    }
                    
                    composable<NavDestination.Search> {
                        SearchScreen(navController = navController)
                    }
                    
                    composable<NavDestination.Investments> {
                        InvestmentsScreen(navController = navController)
                    }
                    
                    composable<NavDestination.Profile> {
                        ProfileScreen(
                            onLogout = {
                                // Handle logout if needed
                            },
                            onNavigateToAuth = {
                                showAuthScreen = true
                            }
                        )
                    }
                    
                    // Property Details as bottom sheet
                    composable<NavDestination.PropertyDetails> { backStackEntry: NavBackStackEntry ->
                        val property = backStackEntry.toRoute<NavDestination.PropertyDetails>()

                        PropertyDetailsBottomSheet(
                            listingId = property.listingId,
                            navController = navController,
                            onClose = {
                                navController.popBackStack()
                            }
                        )
                    }
                    
                    // Investment Flow Screen (with 3 pages) as Bottom Sheet
                    composable<NavDestination.Invest> { backStackEntry: NavBackStackEntry ->
                        val invest = backStackEntry.toRoute<NavDestination.Invest>()
                        
                        InvestmentFlowScreen(
                            listingId = invest.listingId,
                            navController = navController,
                            onClose = {
                                navController.popBackStack()
                            }
                        )
                    }
                    
                    // Investment Success Screen
                    composable<NavDestination.InvestmentSuccess> { backStackEntry: NavBackStackEntry ->
                        val success = backStackEntry.toRoute<NavDestination.InvestmentSuccess>()
                        
                        InvestmentSuccessScreen(
                            listingId = success.listingId,
                            sharePercentage = success.sharePercentage,
                            investmentAmount = success.investmentAmount,
                            propertyTitle = success.propertyTitle,
                            navController = navController
                        )
                    }
                    
                    // Construction Company Details as bottom sheet
                    composable<NavDestination.ConstructionCompanyDetails> { backStackEntry: NavBackStackEntry ->
                        val company = backStackEntry.toRoute<NavDestination.ConstructionCompanyDetails>()
                        ConstructionCompanyDetailsBottomSheet(
                            companyId = company.companyId,
                            navController = navController,
                            onClose = {
                                navController.popBackStack()
                            }
                        )
                    }
                    
                    // Company Investment Flow Screen (with 3 pages) as Bottom Sheet
                    composable<NavDestination.InvestInCompany> { backStackEntry: NavBackStackEntry ->
                        val invest = backStackEntry.toRoute<NavDestination.InvestInCompany>()
                        
                        CompanyInvestmentFlowScreen(
                            companyId = invest.companyId,
                            navController = navController,
                            onClose = {
                                navController.popBackStack()
                            }
                        )
                    }
                }
            }
        )
    }
}



================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/ui/navigation/NavDestination.kt
================================================
package com.yet.home.ui.navigation

import kotlinx.serialization.Serializable

/**
 * Типобезопасные маршруты навигации с использованием Kotlin Serialization
 */
@Serializable
sealed class NavDestination {
    @Serializable
    data object Home : NavDestination()
    
    @Serializable
    data object Search : NavDestination()
    
    @Serializable
    data object Investments : NavDestination()
    
    @Serializable
    data object Profile : NavDestination()
    @Serializable
    data class PropertyDetails(
        val listingId: String
    ) : NavDestination()
    
    @Serializable
    data class Invest(
        val listingId: String
    ) : NavDestination()
    @Serializable
    data class InvestmentSuccess(
        val listingId: String,
        val sharePercentage: Float,
        val investmentAmount: Double,
        val propertyTitle: String
    ) : NavDestination()
    
    @Serializable
    data class ConstructionCompanyDetails(
        val companyId: String
    ) : NavDestination()
    
    @Serializable
    data class InvestInCompany(
        val companyId: String
    ) : NavDestination()
}




================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/ui/screens/AuthScreen.kt
================================================
package com.yet.home.ui.screens

import androidx.compose.animation.AnimatedVisibility
import androidx.compose.foundation.background
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.foundation.text.KeyboardOptions
import androidx.compose.material3.Button
import androidx.compose.material3.Card
import androidx.compose.material3.CardDefaults
import androidx.compose.material3.CircularProgressIndicator
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.OutlinedTextField
import androidx.compose.material3.OutlinedTextFieldDefaults
import androidx.compose.material3.Scaffold
import androidx.compose.material3.SnackbarHost
import androidx.compose.material3.SnackbarHostState
import androidx.compose.material3.Tab
import androidx.compose.material3.TabRow
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.runtime.LaunchedEffect
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.setValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.text.input.ImeAction
import androidx.compose.ui.text.input.KeyboardType
import androidx.compose.ui.text.input.PasswordVisualTransformation
import androidx.compose.ui.unit.dp
import com.yet.home.ui.component.theme.dashboardBackground
import com.yet.home.viewmodel.AuthState
import com.yet.home.viewmodel.AuthViewModel
import homepasss.composeapp.generated.resources.Res
import homepasss.composeapp.generated.resources.app_name
import homepasss.composeapp.generated.resources.auth_email
import homepasss.composeapp.generated.resources.auth_login
import homepasss.composeapp.generated.resources.auth_login_button
import homepasss.composeapp.generated.resources.auth_name
import homepasss.composeapp.generated.resources.auth_password
import homepasss.composeapp.generated.resources.auth_register
import homepasss.composeapp.generated.resources.auth_register_button
import org.jetbrains.compose.resources.stringResource
import org.koin.compose.viewmodel.koinViewModel

@Composable
fun AuthScreen(
    onAuthSuccess: () -> Unit,
    viewModel: AuthViewModel = koinViewModel()
) {
    val authState by viewModel.authState.collectAsState()
    val currentUser by viewModel.currentUser.collectAsState()

    val snackbarHostState = remember { SnackbarHostState() }

    var selectedTabIndex by remember { mutableStateOf(0) }
    var email by remember { mutableStateOf("") }
    var password by remember { mutableStateOf("") }
    var name by remember { mutableStateOf("") }

            val tabs = listOf(stringResource(Res.string.auth_login), stringResource(Res.string.auth_register))

    LaunchedEffect(authState) {
        when (authState) {
            is AuthState.Success -> {
                onAuthSuccess()
            }
            is AuthState.Error -> {
                snackbarHostState.showSnackbar((authState as AuthState.Error).message)
                viewModel.resetState()
            }
            else -> {}
        }
    }

    LaunchedEffect(currentUser) {
        if (currentUser != null) {
            onAuthSuccess()
        }
    }

    Scaffold(
        modifier = Modifier.fillMaxSize(),
        containerColor = Color.Transparent,
        snackbarHost = { SnackbarHost(snackbarHostState) }
    ) { paddingValues ->
        Box(
            modifier = Modifier
                .fillMaxSize()
                .background(dashboardBackground)
        ) {
            Column(
                modifier = Modifier
                    .fillMaxSize()
                    .padding(paddingValues)
                    .padding(16.dp),
                horizontalAlignment = Alignment.CenterHorizontally,
                verticalArrangement = Arrangement.Center
            ) {
                // App Name
                Text(
                    text = stringResource(Res.string.app_name),
                    style = MaterialTheme.typography.headlineLarge,
                    fontWeight = FontWeight.Bold,
                    color = MaterialTheme.colorScheme.onSurface
                )

                Spacer(modifier = Modifier.height(32.dp))

                // Auth Card with glassmorphism effect
                Card(
                    modifier = Modifier.fillMaxWidth(),
                    shape = RoundedCornerShape(24.dp),
                    colors = CardDefaults.cardColors(
                        containerColor = Color.White.copy(alpha = 0.12f)
                    ),
                    elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
                ) {
                    Column(
                        modifier = Modifier.padding(24.dp)
                    ) {
                        // Tab Row
                        TabRow(
                            selectedTabIndex = selectedTabIndex,
                            modifier = Modifier.fillMaxWidth(),
                            containerColor = Color.Transparent,
                            contentColor = MaterialTheme.colorScheme.primary
                        ) {
                            tabs.forEachIndexed { index, title ->
                                Tab(
                                    selected = selectedTabIndex == index,
                                    onClick = {
                                        selectedTabIndex = index
                                        name = ""
                                        email = ""
                                        password = ""
                                    },
                                    text = { 
                                        Text(
                                            title,
                                            fontWeight = if (selectedTabIndex == index) FontWeight.Bold else FontWeight.Normal
                                        ) 
                                    }
                                )
                            }
                        }

                        Spacer(modifier = Modifier.height(24.dp))

                        // Name field (only for registration)
                        AnimatedVisibility(visible = selectedTabIndex == 1) {
                            Column {
                                OutlinedTextField(
                                    value = name,
                                    onValueChange = { name = it },
                                    label = { Text(stringResource(Res.string.auth_name)) },
                                    modifier = Modifier.fillMaxWidth(),
                                    keyboardOptions = KeyboardOptions(
                                        keyboardType = KeyboardType.Text,
                                        imeAction = ImeAction.Next
                                    ),
                                    singleLine = true,
                                    colors = OutlinedTextFieldDefaults.colors(
                                        focusedBorderColor = MaterialTheme.colorScheme.primary,
                                        unfocusedBorderColor = MaterialTheme.colorScheme.outline.copy(alpha = 0.5f),
                                        focusedLabelColor = MaterialTheme.colorScheme.primary,
                                        unfocusedLabelColor = MaterialTheme.colorScheme.onSurfaceVariant,
                                        focusedTextColor = MaterialTheme.colorScheme.onSurface,
                                        unfocusedTextColor = MaterialTheme.colorScheme.onSurface
                                    ),
                                    shape = RoundedCornerShape(12.dp)
                                )
                                Spacer(modifier = Modifier.height(16.dp))
                            }
                        }

                        // Email field
                        OutlinedTextField(
                            value = email,
                            onValueChange = { email = it },
                            label = { Text(stringResource(Res.string.auth_email)) },
                            modifier = Modifier.fillMaxWidth(),
                            keyboardOptions = KeyboardOptions(
                                keyboardType = KeyboardType.Email,
                                imeAction = ImeAction.Next
                            ),
                            singleLine = true,
                            colors = OutlinedTextFieldDefaults.colors(
                                focusedBorderColor = MaterialTheme.colorScheme.primary,
                                unfocusedBorderColor = MaterialTheme.colorScheme.outline.copy(alpha = 0.5f),
                                focusedLabelColor = MaterialTheme.colorScheme.primary,
                                unfocusedLabelColor = MaterialTheme.colorScheme.onSurfaceVariant,
                                focusedTextColor = MaterialTheme.colorScheme.onSurface,
                                unfocusedTextColor = MaterialTheme.colorScheme.onSurface
                            ),
                            shape = RoundedCornerShape(12.dp)
                        )

                        Spacer(modifier = Modifier.height(16.dp))

                        // Password field
                        OutlinedTextField(
                            value = password,
                            onValueChange = { password = it },
                            label = { Text(stringResource(Res.string.auth_password)) },
                            modifier = Modifier.fillMaxWidth(),
                            visualTransformation = PasswordVisualTransformation(),
                            keyboardOptions = KeyboardOptions(
                                keyboardType = KeyboardType.Password,
                                imeAction = ImeAction.Done
                            ),
                            singleLine = true,
                            colors = OutlinedTextFieldDefaults.colors(
                                focusedBorderColor = MaterialTheme.colorScheme.primary,
                                unfocusedBorderColor = MaterialTheme.colorScheme.outline.copy(alpha = 0.5f),
                                focusedLabelColor = MaterialTheme.colorScheme.primary,
                                unfocusedLabelColor = MaterialTheme.colorScheme.onSurfaceVariant,
                                focusedTextColor = MaterialTheme.colorScheme.onSurface,
                                unfocusedTextColor = MaterialTheme.colorScheme.onSurface
                            ),
                            shape = RoundedCornerShape(12.dp)
                        )

                        Spacer(modifier = Modifier.height(24.dp))

                        // Action Button
                        Button(
                            onClick = {
                                when (selectedTabIndex) {
                                    0 -> viewModel.login(email, password)
                                    1 -> viewModel.register(name, email, password)
                                }
                            },
                            modifier = Modifier.fillMaxWidth(),
                            enabled = email.isNotBlank() && password.isNotBlank() &&
                                     (selectedTabIndex == 0 || name.isNotBlank()) &&
                                     authState !is AuthState.Loading,
                            shape = RoundedCornerShape(12.dp)
                        ) {
                            if (authState is AuthState.Loading) {
                                CircularProgressIndicator(
                                    modifier = Modifier
                                        .padding(end = 8.dp)
                                        .height(16.dp)
                                        .fillMaxWidth(0.1f),
                                    color = MaterialTheme.colorScheme.onPrimary,
                                    strokeWidth = 2.dp
                                )
                            }
                            Text(
                                text = when (selectedTabIndex) {
                                    0 -> stringResource(Res.string.auth_login_button)
                                    1 -> stringResource(Res.string.auth_register_button)
                                    else -> ""
                                },
                                fontWeight = FontWeight.Bold
                            )
                        }
                    }
                }
            }
        }
    }
}



================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/ui/screens/CompanyInvestmentFlowScreen.kt
================================================
package com.yet.home.ui.screens

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.pager.HorizontalPager
import androidx.compose.foundation.pager.rememberPagerState
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.foundation.text.KeyboardOptions
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.Check
import androidx.compose.material.icons.filled.Close
import androidx.compose.material.icons.filled.CreditCard
import androidx.compose.material.icons.filled.Store
import androidx.compose.material3.Button
import androidx.compose.material3.ButtonDefaults
import androidx.compose.material3.Card
import androidx.compose.material3.CardDefaults
import androidx.compose.material3.CircularProgressIndicator
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Icon
import androidx.compose.material3.IconButton
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.ModalBottomSheet
import androidx.compose.material3.OutlinedTextField
import androidx.compose.material3.OutlinedTextFieldDefaults
import androidx.compose.material3.RadioButton
import androidx.compose.material3.RadioButtonDefaults
import androidx.compose.material3.SheetValue
import androidx.compose.material3.Slider
import androidx.compose.material3.SliderDefaults
import androidx.compose.material3.Surface
import androidx.compose.material3.Text
import androidx.compose.material3.rememberModalBottomSheetState
import androidx.compose.runtime.Composable
import androidx.compose.runtime.LaunchedEffect
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.rememberCoroutineScope
import androidx.compose.runtime.setValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.text.input.ImeAction
import androidx.compose.ui.text.input.KeyboardType
import androidx.compose.ui.unit.dp
import androidx.navigation.NavController
import com.yet.home.ui.component.theme.dashboardBackground
import com.yet.home.ui.components.InvestmentProgressIndicator
import com.yet.home.ui.navigation.NavDestination
import com.yet.home.utils.formatCurrencyRubles
import com.yet.home.viewmodel.ConstructionCompanyDetailsViewModel
import homepasss.composeapp.generated.resources.Res
import homepasss.composeapp.generated.resources.invest_flow_amount
import homepasss.composeapp.generated.resources.invest_flow_card_cvv
import homepasss.composeapp.generated.resources.invest_flow_card_cvv_error
import homepasss.composeapp.generated.resources.invest_flow_card_cvv_placeholder
import homepasss.composeapp.generated.resources.invest_flow_card_data
import homepasss.composeapp.generated.resources.invest_flow_card_expiry
import homepasss.composeapp.generated.resources.invest_flow_card_expiry_error
import homepasss.composeapp.generated.resources.invest_flow_card_expiry_placeholder
import homepasss.composeapp.generated.resources.invest_flow_card_holder_name
import homepasss.composeapp.generated.resources.invest_flow_card_holder_name_placeholder
import homepasss.composeapp.generated.resources.invest_flow_card_number
import homepasss.composeapp.generated.resources.invest_flow_card_number_error
import homepasss.composeapp.generated.resources.invest_flow_card_number_placeholder
import homepasss.composeapp.generated.resources.invest_flow_card_type_mastercard
import homepasss.composeapp.generated.resources.invest_flow_card_type_visa
import homepasss.composeapp.generated.resources.invest_flow_choose_share
import homepasss.composeapp.generated.resources.invest_flow_choose_share_subtitle
import homepasss.composeapp.generated.resources.invest_flow_close
import homepasss.composeapp.generated.resources.invest_flow_confirm_payment
import homepasss.composeapp.generated.resources.invest_flow_continue
import homepasss.composeapp.generated.resources.invest_flow_document_egrn
import homepasss.composeapp.generated.resources.invest_flow_document_ownership
import homepasss.composeapp.generated.resources.invest_flow_document_technical
import homepasss.composeapp.generated.resources.invest_flow_documents
import homepasss.composeapp.generated.resources.invest_flow_income_per_month
import homepasss.composeapp.generated.resources.invest_flow_income_per_year
import homepasss.composeapp.generated.resources.invest_flow_investment_amount
import homepasss.composeapp.generated.resources.invest_flow_investment_details
import homepasss.composeapp.generated.resources.invest_flow_object
import homepasss.composeapp.generated.resources.invest_flow_payment_apple_pay
import homepasss.composeapp.generated.resources.invest_flow_payment_bank_card
import homepasss.composeapp.generated.resources.invest_flow_payment_bank_transfer
import homepasss.composeapp.generated.resources.invest_flow_payment_recommended
import homepasss.composeapp.generated.resources.invest_flow_payment_subtitle
import homepasss.composeapp.generated.resources.invest_flow_payment_title
import homepasss.composeapp.generated.resources.invest_flow_review_subtitle
import homepasss.composeapp.generated.resources.invest_flow_review_title
import homepasss.composeapp.generated.resources.invest_flow_security_message
import homepasss.composeapp.generated.resources.invest_flow_total_to_pay
import kotlinx.coroutines.launch
import kotlin.time.Clock
import kotlinx.datetime.TimeZone
import kotlinx.datetime.number
import kotlinx.datetime.todayIn
import org.jetbrains.compose.resources.stringResource
import org.koin.compose.viewmodel.koinViewModel
import kotlin.time.ExperimentalTime

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun CompanyInvestmentFlowScreen(
    companyId: String,
    navController: NavController,
    onClose: () -> Unit,
    modifier: Modifier = Modifier,
    viewModel: ConstructionCompanyDetailsViewModel = koinViewModel()
) {
    val sheetState = rememberModalBottomSheetState(
        skipPartiallyExpanded = true,
    )
    val coroutineScope = rememberCoroutineScope()

    var previousValue by remember { mutableStateOf<SheetValue?>(null) }

    LaunchedEffect(sheetState.currentValue) {
        if (previousValue == SheetValue.Expanded && sheetState.currentValue == SheetValue.Hidden) {
            onClose()
        }
        previousValue = sheetState.currentValue
    }
    
    val company by viewModel.company.collectAsState()
    val isLoading by viewModel.isLoading.collectAsState()

    // Load company details on first composition
    LaunchedEffect(companyId) {
        viewModel.loadCompanyDetails(companyId)
    }

    // Calculate derived values
    val minInvestment = company?.minInvestmentAmount ?: 0.0
    val maxInvestment = company?.let { 
        (it.totalInvestmentAmount - it.currentInvestmentAmount).coerceAtLeast(minInvestment)
    } ?: minInvestment
    val expectedReturn = company?.expectedReturn ?: 0.0

    // Investment amount state (slider value)
    var investmentAmount by remember { mutableStateOf<Double?>(null) }
    
    // Update investmentAmount when min/max values are available
    LaunchedEffect(minInvestment, maxInvestment, isLoading) {
        if (!isLoading && investmentAmount == null && minInvestment > 0) {
            investmentAmount = minInvestment
        } else if (!isLoading && investmentAmount != null) {
            val currentValue = investmentAmount!!
            if (currentValue < minInvestment || currentValue > maxInvestment) {
                investmentAmount = currentValue.coerceIn(minInvestment, maxInvestment)
            }
        }
    }
    
    val currentInvestmentAmount = investmentAmount ?: minInvestment
    val isValidAmount = currentInvestmentAmount >= minInvestment && currentInvestmentAmount <= maxInvestment

    // Calculate income
    val estimatedIncomePerYear = (currentInvestmentAmount * expectedReturn) / 100
    val estimatedIncomePerMonth = estimatedIncomePerYear / 12

    val companyName = company?.name ?: ""

    // Pager state
    val pagerState = rememberPagerState(pageCount = { 3 }, initialPage = 0)

    ModalBottomSheet(
        onDismissRequest = {
            coroutineScope.launch {
                sheetState.hide()
            }
        },
        sheetState = sheetState,
        containerColor = Color.Transparent,
        dragHandle = {
            Box(
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(vertical = 12.dp),
                contentAlignment = Alignment.Center
            ) {
                Surface(
                    modifier = Modifier
                        .width(40.dp)
                        .height(4.dp),
                    shape = RoundedCornerShape(2.dp),
                    color = Color.White.copy(alpha = 0.3f)
                ) {}
                Row(
                    modifier = Modifier
                        .fillMaxWidth()
                        .padding(horizontal = 16.dp),
                    horizontalArrangement = Arrangement.End
                ) {
                    IconButton(
                        onClick = {
                            coroutineScope.launch {
                                sheetState.hide()
                            }
                        }
                    ) {
                        Icon(
                            imageVector = Icons.Default.Close,
                            contentDescription = stringResource(Res.string.invest_flow_close),
                            tint = MaterialTheme.colorScheme.onSurface
                        )
                    }
                }
            }
        }
    ) {
        Box(
            modifier = Modifier
                .fillMaxSize()
                .background(dashboardBackground)
        ) {
            if (isLoading) {
                Column(
                    modifier = Modifier.fillMaxSize(),
                    horizontalAlignment = Alignment.CenterHorizontally,
                    verticalArrangement = Arrangement.Center
                ) {
                    CircularProgressIndicator()
                }
            } else {
                Column(
                    modifier = Modifier
                        .fillMaxSize()
                        .padding(horizontal = 16.dp)
                ) {
                    // Progress Indicator
                    InvestmentProgressIndicator(
                        currentStep = pagerState.currentPage + 1,
                        modifier = Modifier.padding(horizontal = 0.dp, vertical = 16.dp)
                    )

                    // Horizontal Pager with 3 pages
                    HorizontalPager(
                        state = pagerState,
                        modifier = Modifier
                            .fillMaxSize()
                            .weight(1f),
                        userScrollEnabled = true
                    ) { page ->
                        when (page) {
                            0 -> {
                                // Page 1: Investment Amount Selection
                                CompanyInvestmentAmountPage(
                                    investmentAmount = currentInvestmentAmount,
                                    onInvestmentAmountChange = { newAmount ->
                                        investmentAmount = newAmount.coerceIn(minInvestment, maxInvestment)
                                    },
                                    minInvestment = minInvestment,
                                    maxInvestment = maxInvestment,
                                    incomePerYear = estimatedIncomePerYear,
                                    incomePerMonth = estimatedIncomePerMonth,
                                    company = company,
                                    isValidAmount = isValidAmount,
                                    onNext = {
                                        coroutineScope.launch {
                                            pagerState.animateScrollToPage(1)
                                        }
                                    }
                                )
                            }

                            1 -> {
                                // Page 2: Investment Review
                                CompanyInvestmentReviewPage(
                                    investmentAmount = currentInvestmentAmount,
                                    companyName = companyName,
                                    onNext = {
                                        coroutineScope.launch {
                                            pagerState.animateScrollToPage(2)
                                        }
                                    }
                                )
                            }

                            2 -> {
                                // Page 3: Payment
                                CompanyPaymentPage(
                                    investmentAmount = currentInvestmentAmount,
                                    companyName = companyName,
                                    onConfirm = {
                                        // Navigate to success screen
                                        navController.navigate(
                                            NavDestination.InvestmentSuccess(
                                                listingId = companyId,
                                                sharePercentage = ((currentInvestmentAmount / (company?.totalInvestmentAmount ?: 1.0)) * 100).toFloat(),
                                                investmentAmount = currentInvestmentAmount,
                                                propertyTitle = companyName
                                            )
                                        ) {
                                            popUpTo(NavDestination.Investments) {
                                                inclusive = false
                                            }
                                        }
                                    }
                                )
                            }
                        }
                    }
                }
            }
        }
    }
}

// Page 1: Investment Amount Selection
@Composable
private fun CompanyInvestmentAmountPage(
    investmentAmount: Double,
    onInvestmentAmountChange: (Double) -> Unit,
    minInvestment: Double,
    maxInvestment: Double,
    incomePerYear: Double,
    incomePerMonth: Double,
    company: com.yet.domain.model.ConstructionCompany?,
    isValidAmount: Boolean,
    onNext: () -> Unit
) {
    LazyColumn(
        modifier = Modifier.fillMaxSize(),
        verticalArrangement = Arrangement.spacedBy(16.dp)
    ) {
        item {
            Spacer(modifier = Modifier.height(8.dp))
        }

        // Title and Subtitle
        item {
            Column {
                Text(
                    text = stringResource(Res.string.invest_flow_choose_share),
                    style = MaterialTheme.typography.headlineLarge,
                    fontWeight = FontWeight.Bold,
                    color = MaterialTheme.colorScheme.onSurface
                )
                Spacer(modifier = Modifier.height(8.dp))
                Text(
                    text = stringResource(Res.string.invest_flow_choose_share_subtitle),
                    style = MaterialTheme.typography.bodyLarge,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
            }
        }

        // Company Info Card
        item {
            if (company != null) {
                CompanyInfoCard(company = company)
            }
        }

        // Investment Amount Slider Card
        item {
            CompanyInvestmentAmountCard(
                investmentAmount = investmentAmount,
                onInvestmentAmountChange = onInvestmentAmountChange,
                minInvestment = minInvestment,
                maxInvestment = maxInvestment,
                incomePerYear = incomePerYear,
                incomePerMonth = incomePerMonth
            )
        }

        // Continue Button
        item {
            Button(
                onClick = onNext,
                modifier = Modifier.fillMaxWidth(),
                enabled = isValidAmount,
                colors = ButtonDefaults.buttonColors(
                    containerColor = MaterialTheme.colorScheme.primary
                )
            ) {
                Text(
                    text = stringResource(Res.string.invest_flow_continue),
                    style = MaterialTheme.typography.titleMedium,
                    fontWeight = FontWeight.Bold
                )
            }
        }

        item {
            Spacer(modifier = Modifier.height(80.dp))
        }
    }
}

@Composable
private fun CompanyInfoCard(company: com.yet.domain.model.ConstructionCompany) {
    Card(
        modifier = Modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Text(
                text = stringResource(Res.string.invest_flow_object),
                style = MaterialTheme.typography.titleMedium,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.onSurface
            )
            Spacer(modifier = Modifier.height(8.dp))
            Text(
                text = company.name,
                style = MaterialTheme.typography.bodyLarge,
                color = MaterialTheme.colorScheme.onSurfaceVariant
            )
        }
    }
}

@Composable
private fun CompanyInvestmentAmountCard(
    investmentAmount: Double,
    onInvestmentAmountChange: (Double) -> Unit,
    minInvestment: Double,
    maxInvestment: Double,
    incomePerYear: Double,
    incomePerMonth: Double
) {
    Card(
        modifier = Modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp),
            verticalArrangement = Arrangement.spacedBy(16.dp)
        ) {
            // Investment Amount Display
            Column {
                Text(
                    text = stringResource(Res.string.invest_flow_investment_amount),
                    style = MaterialTheme.typography.bodyMedium,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
                Spacer(modifier = Modifier.height(8.dp))
                Text(
                    text = formatCurrencyRubles(investmentAmount),
                    style = MaterialTheme.typography.headlineMedium,
                    fontWeight = FontWeight.Bold,
                    color = MaterialTheme.colorScheme.primary
                )
            }

            // Slider
            val sliderValue = ((investmentAmount - minInvestment) / (maxInvestment - minInvestment).coerceAtLeast(1.0)).toFloat().coerceIn(0f, 1f)
            Slider(
                value = sliderValue,
                onValueChange = { newValue ->
                    val newAmount = minInvestment + (newValue * (maxInvestment - minInvestment))
                    onInvestmentAmountChange(newAmount)
                },
                modifier = Modifier.fillMaxWidth(),
                colors = SliderDefaults.colors(
                    thumbColor = MaterialTheme.colorScheme.primary,
                    activeTrackColor = MaterialTheme.colorScheme.primary
                )
            )

            // Min/Max labels
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween
            ) {
                Text(
                    text = formatCurrencyRubles(minInvestment),
                    style = MaterialTheme.typography.bodySmall,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
                Text(
                    text = formatCurrencyRubles(maxInvestment),
                    style = MaterialTheme.typography.bodySmall,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
            }

            Spacer(modifier = Modifier.height(8.dp))

            // Income Info
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween
            ) {
                Column {
                    Text(
                        text = stringResource(Res.string.invest_flow_income_per_year),
                        style = MaterialTheme.typography.bodySmall,
                        color = MaterialTheme.colorScheme.onSurfaceVariant
                    )
                    Text(
                        text = formatCurrencyRubles(incomePerYear),
                        style = MaterialTheme.typography.titleMedium,
                        fontWeight = FontWeight.Bold,
                        color = MaterialTheme.colorScheme.tertiary
                    )
                }
                Column {
                    Text(
                        text = stringResource(Res.string.invest_flow_income_per_month),
                        style = MaterialTheme.typography.bodySmall,
                        color = MaterialTheme.colorScheme.onSurfaceVariant
                    )
                    Text(
                        text = formatCurrencyRubles(incomePerMonth),
                        style = MaterialTheme.typography.titleMedium,
                        fontWeight = FontWeight.Bold,
                        color = MaterialTheme.colorScheme.tertiary
                    )
                }
            }
        }
    }
}

// Page 2: Investment Review
@Composable
private fun CompanyInvestmentReviewPage(
    investmentAmount: Double,
    companyName: String,
    onNext: () -> Unit
) {
    LazyColumn(
        modifier = Modifier.fillMaxSize(),
        verticalArrangement = Arrangement.spacedBy(16.dp)
    ) {
        item {
            Spacer(modifier = Modifier.height(8.dp))
        }

        // Title and Subtitle
        item {
            Column {
                Text(
                    text = stringResource(Res.string.invest_flow_review_title),
                    style = MaterialTheme.typography.headlineLarge,
                    fontWeight = FontWeight.Bold,
                    color = MaterialTheme.colorScheme.onSurface
                )
                Spacer(modifier = Modifier.height(8.dp))
                Text(
                    text = stringResource(Res.string.invest_flow_review_subtitle),
                    style = MaterialTheme.typography.bodyLarge,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
            }
        }

        // Investment Details Card
        item {
            CompanyInvestmentDetailsCard(
                investmentAmount = investmentAmount,
                companyName = companyName
            )
        }

        // Documents Card
        item {
            DocumentsCard()
        }

        // Continue Button
        item {
            Button(
                onClick = onNext,
                modifier = Modifier.fillMaxWidth(),
                colors = ButtonDefaults.buttonColors(
                    containerColor = MaterialTheme.colorScheme.primary
                )
            ) {
                Text(
                    text = stringResource(Res.string.invest_flow_continue),
                    style = MaterialTheme.typography.titleMedium,
                    fontWeight = FontWeight.Bold
                )
            }
        }

        item {
            Spacer(modifier = Modifier.height(80.dp))
        }
    }
}

@Composable
private fun CompanyInvestmentDetailsCard(
    investmentAmount: Double,
    companyName: String
) {
    Card(
        modifier = Modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp),
            verticalArrangement = Arrangement.spacedBy(12.dp)
        ) {
            Text(
                text = stringResource(Res.string.invest_flow_investment_details),
                style = MaterialTheme.typography.titleLarge,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.onSurface
            )

            ReviewDetailRow(
                label = stringResource(Res.string.invest_flow_object),
                value = companyName
            )
            ReviewDetailRow(
                label = stringResource(Res.string.invest_flow_amount),
                value = formatCurrencyRubles(investmentAmount)
            )
        }
    }
}

@Composable
private fun ReviewDetailRow(
    label: String,
    value: String
) {
    Row(
        modifier = Modifier.fillMaxWidth(),
        horizontalArrangement = Arrangement.SpaceBetween,
        verticalAlignment = Alignment.CenterVertically
    ) {
        Text(
            text = label,
            style = MaterialTheme.typography.bodyLarge,
            color = MaterialTheme.colorScheme.onSurfaceVariant
        )
        Text(
            text = value,
            style = MaterialTheme.typography.bodyLarge,
            fontWeight = FontWeight.Bold,
            color = MaterialTheme.colorScheme.onSurface
        )
    }
}

@Composable
private fun DocumentsCard() {
    val documents = listOf(
        stringResource(Res.string.invest_flow_document_ownership),
        stringResource(Res.string.invest_flow_document_egrn),
        stringResource(Res.string.invest_flow_document_technical)
    )

    Card(
        modifier = Modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Text(
                text = stringResource(Res.string.invest_flow_documents),
                style = MaterialTheme.typography.titleLarge,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.onSurface
            )

            Spacer(modifier = Modifier.height(16.dp))

            documents.forEach { document ->
                Row(
                    modifier = Modifier
                        .fillMaxWidth()
                        .padding(vertical = 8.dp),
                    horizontalArrangement = Arrangement.SpaceBetween,
                    verticalAlignment = Alignment.CenterVertically
                ) {
                    Text(
                        text = document,
                        style = MaterialTheme.typography.bodyLarge,
                        color = MaterialTheme.colorScheme.onSurface
                    )
                    Icon(
                        imageVector = Icons.Default.Check,
                        contentDescription = null,
                        tint = MaterialTheme.colorScheme.tertiary,
                        modifier = Modifier.size(24.dp)
                    )
                }
            }
        }
    }
}

// Page 3: Payment
@Composable
private fun CompanyPaymentPage(
    investmentAmount: Double,
    companyName: String,
    onConfirm: () -> Unit
) {
    var selectedPaymentMethod by remember { mutableStateOf<PaymentMethod?>(null) }
    var showCardForm by remember { mutableStateOf(false) }
    
    var cardNumber by remember { mutableStateOf("") }
    var cardExpiry by remember { mutableStateOf("") }
    var cardCvv by remember { mutableStateOf("") }
    var cardHolderName by remember { mutableStateOf("") }

    LazyColumn(
        modifier = Modifier.fillMaxSize(),
        verticalArrangement = Arrangement.spacedBy(16.dp)
    ) {
        item {
            Spacer(modifier = Modifier.height(8.dp))
        }

        // Title and Subtitle
        item {
            Column {
                Text(
                    text = stringResource(Res.string.invest_flow_payment_title),
                    style = MaterialTheme.typography.headlineLarge,
                    fontWeight = FontWeight.Bold,
                    color = MaterialTheme.colorScheme.onSurface
                )
                Spacer(modifier = Modifier.height(8.dp))
                Text(
                    text = stringResource(Res.string.invest_flow_payment_subtitle),
                    style = MaterialTheme.typography.bodyLarge,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
            }
        }

        // Payment Methods
        item {
            PaymentMethodCard(
                title = stringResource(Res.string.invest_flow_payment_apple_pay),
                subtitle = stringResource(Res.string.invest_flow_payment_recommended),
                icon = Icons.Default.Store,
                iconTint = Color(0xFFFF3B30),
                isSelected = selectedPaymentMethod == PaymentMethod.APPLE_PAY,
                isRecommended = true,
                onClick = {
                    selectedPaymentMethod = PaymentMethod.APPLE_PAY
                    showCardForm = false
                }
            )
        }

        item {
            PaymentMethodCard(
                title = stringResource(Res.string.invest_flow_payment_bank_card),
                icon = Icons.Default.CreditCard,
                iconTint = Color(0xFFFFD700),
                isSelected = selectedPaymentMethod == PaymentMethod.BANK_CARD,
                onClick = {
                    selectedPaymentMethod = PaymentMethod.BANK_CARD
                    showCardForm = true
                }
            )
        }

        item {
            PaymentMethodCard(
                title = stringResource(Res.string.invest_flow_payment_bank_transfer),
                icon = Icons.Default.Store,
                iconTint = Color(0xFFFFD700),
                isSelected = selectedPaymentMethod == PaymentMethod.BANK_TRANSFER,
                onClick = {
                    selectedPaymentMethod = PaymentMethod.BANK_TRANSFER
                    showCardForm = false
                }
            )
        }

        // Card Form (if Bank Card is selected)
        if (showCardForm && selectedPaymentMethod == PaymentMethod.BANK_CARD) {
            item {
                CardForm(
                    cardNumber = cardNumber,
                    onCardNumberChange = { cardNumber = formatCardNumber(it) },
                    cardExpiry = cardExpiry,
                    onCardExpiryChange = { cardExpiry = formatExpiry(it) },
                    cardCvv = cardCvv,
                    onCardCvvChange = { cardCvv = formatCvv(it) },
                    cardHolderName = cardHolderName,
                    onCardHolderNameChange = { cardHolderName = it.uppercase() }
                )
            }
        }

        // Security Message
        item {
            SecurityMessageCard()
        }

        // Total Amount
        item {
            TotalAmountCard(investmentAmount = investmentAmount)
        }

        // Confirm Payment Button
        item {
            val isFormValid = if (selectedPaymentMethod == PaymentMethod.BANK_CARD) {
                isValidCardNumber(cardNumber) &&
                isValidExpiry(cardExpiry) &&
                isValidCvv(cardCvv) &&
                cardHolderName.isNotBlank()
            } else {
                selectedPaymentMethod != null
            }

            Button(
                onClick = onConfirm,
                modifier = Modifier.fillMaxWidth(),
                enabled = isFormValid,
                colors = ButtonDefaults.buttonColors(
                    containerColor = MaterialTheme.colorScheme.primary
                )
            ) {
                Text(
                    text = stringResource(Res.string.invest_flow_confirm_payment),
                    style = MaterialTheme.typography.titleMedium,
                    fontWeight = FontWeight.Bold
                )
            }
        }

        item {
            Spacer(modifier = Modifier.height(80.dp))
        }
    }
}

@Composable
private fun TotalAmountCard(investmentAmount: Double) {
    Card(
        modifier = Modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Row(
            modifier = Modifier
                .fillMaxWidth()
                .padding(16.dp),
            horizontalArrangement = Arrangement.SpaceBetween,
            verticalAlignment = Alignment.CenterVertically
        ) {
            Text(
                text = stringResource(Res.string.invest_flow_total_to_pay),
                style = MaterialTheme.typography.titleLarge,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.onSurface
            )
            Text(
                text = formatCurrencyRubles(investmentAmount),
                style = MaterialTheme.typography.headlineMedium,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.primary
            )
        }
    }
}

@Composable
private fun SecurityMessageCard() {
    Card(
        modifier = Modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Row(
            modifier = Modifier.padding(16.dp),
            verticalAlignment = Alignment.CenterVertically,
            horizontalArrangement = Arrangement.spacedBy(12.dp)
        ) {
            Icon(
                imageVector = Icons.Default.Check,
                contentDescription = null,
                tint = MaterialTheme.colorScheme.tertiary,
                modifier = Modifier.size(24.dp)
            )
            Text(
                text = stringResource(Res.string.invest_flow_security_message),
                style = MaterialTheme.typography.bodySmall,
                color = MaterialTheme.colorScheme.onSurfaceVariant
            )
        }
    }
}


// Copy validation and formatting functions from InvestmentFlowScreen
@Composable
private fun PaymentMethodCard(
    title: String,
    subtitle: String? = null,
    icon: androidx.compose.ui.graphics.vector.ImageVector,
    iconTint: Color,
    isSelected: Boolean,
    isRecommended: Boolean = false,
    onClick: () -> Unit
) {
    Card(
        modifier = Modifier
            .fillMaxWidth()
            .clickable(onClick = onClick),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = if (isSelected) {
                MaterialTheme.colorScheme.primaryContainer.copy(alpha = 0.3f)
            } else {
                Color.White.copy(alpha = 0.12f)
            }
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Row(
            modifier = Modifier
                .fillMaxWidth()
                .padding(16.dp),
            horizontalArrangement = Arrangement.SpaceBetween,
            verticalAlignment = Alignment.CenterVertically
        ) {
            Row(
                horizontalArrangement = Arrangement.spacedBy(12.dp),
                verticalAlignment = Alignment.CenterVertically
            ) {
                Icon(
                    imageVector = icon,
                    contentDescription = null,
                    tint = iconTint,
                    modifier = Modifier.size(32.dp)
                )
                Column {
                    Text(
                        text = title,
                        style = MaterialTheme.typography.bodyLarge,
                        fontWeight = FontWeight.Medium,
                        color = MaterialTheme.colorScheme.onSurface
                    )
                    if (subtitle != null) {
                        Text(
                            text = subtitle,
                            style = MaterialTheme.typography.bodySmall,
                            color = MaterialTheme.colorScheme.tertiary
                        )
                    }
                }
            }
            RadioButton(
                selected = isSelected,
                onClick = onClick,
                colors = RadioButtonDefaults.colors(
                    selectedColor = MaterialTheme.colorScheme.primary
                )
            )
        }
    }
}

// Import CardForm and validation functions from InvestmentFlowScreen
// For now, I'll add simplified versions

@Composable
private fun CardForm(
    cardNumber: String,
    onCardNumberChange: (String) -> Unit,
    cardExpiry: String,
    onCardExpiryChange: (String) -> Unit,
    cardCvv: String,
    onCardCvvChange: (String) -> Unit,
    cardHolderName: String,
    onCardHolderNameChange: (String) -> Unit
) {
    val cardType = detectCardType(cardNumber)
    val isCardNumberValid = isValidCardNumber(cardNumber)

    Card(
        modifier = Modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp),
            verticalArrangement = Arrangement.spacedBy(16.dp)
        ) {
            Text(
                text = stringResource(Res.string.invest_flow_card_data),
                style = MaterialTheme.typography.titleLarge,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.onSurface
            )

            // Card Number
            OutlinedTextField(
                value = cardNumber,
                onValueChange = onCardNumberChange,
                label = { Text(stringResource(Res.string.invest_flow_card_number)) },
                placeholder = { Text(stringResource(Res.string.invest_flow_card_number_placeholder)) },
                modifier = Modifier.fillMaxWidth(),
                keyboardOptions = KeyboardOptions(
                    keyboardType = KeyboardType.Number,
                    imeAction = ImeAction.Next
                ),
                singleLine = true,
                isError = cardNumber.isNotEmpty() && !isCardNumberValid,
                supportingText = {
                    if (cardNumber.isNotEmpty() && !isCardNumberValid) {
                        Text(
                            text = stringResource(Res.string.invest_flow_card_number_error),
                            color = MaterialTheme.colorScheme.error
                        )
                    } else if (isCardNumberValid && cardType != null) {
                        Text(
                            text = cardType,
                            color = MaterialTheme.colorScheme.primary
                        )
                    }
                },
                trailingIcon = {
                    if (isCardNumberValid && cardType != null) {
                        Icon(
                            imageVector = Icons.Default.Check,
                            contentDescription = null,
                            tint = MaterialTheme.colorScheme.primary
                        )
                    }
                },
                colors = OutlinedTextFieldDefaults.colors(
                    focusedBorderColor = MaterialTheme.colorScheme.primary,
                    unfocusedBorderColor = MaterialTheme.colorScheme.outline.copy(alpha = 0.5f),
                    errorBorderColor = MaterialTheme.colorScheme.error,
                    focusedLabelColor = MaterialTheme.colorScheme.primary,
                    unfocusedLabelColor = MaterialTheme.colorScheme.onSurfaceVariant,
                    focusedTextColor = MaterialTheme.colorScheme.onSurface,
                    unfocusedTextColor = MaterialTheme.colorScheme.onSurface
                ),
                shape = RoundedCornerShape(12.dp)
            )

            // Expiry and CVV Row
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.spacedBy(12.dp)
            ) {
                // Expiry Date
                OutlinedTextField(
                    value = cardExpiry,
                    onValueChange = onCardExpiryChange,
                    label = { Text(stringResource(Res.string.invest_flow_card_expiry)) },
                    placeholder = { Text(stringResource(Res.string.invest_flow_card_expiry_placeholder)) },
                    modifier = Modifier.weight(1f),
                    keyboardOptions = KeyboardOptions(
                        keyboardType = KeyboardType.Number,
                        imeAction = ImeAction.Next
                    ),
                    singleLine = true,
                    isError = cardExpiry.isNotEmpty() && !isValidExpiry(cardExpiry),
                    supportingText = {
                        if (cardExpiry.isNotEmpty() && !isValidExpiry(cardExpiry)) {
                            Text(
                                text = stringResource(Res.string.invest_flow_card_expiry_error),
                                color = MaterialTheme.colorScheme.error
                            )
                        }
                    },
                    colors = OutlinedTextFieldDefaults.colors(
                        focusedBorderColor = MaterialTheme.colorScheme.primary,
                        unfocusedBorderColor = MaterialTheme.colorScheme.outline.copy(alpha = 0.5f),
                        errorBorderColor = MaterialTheme.colorScheme.error,
                        focusedLabelColor = MaterialTheme.colorScheme.primary,
                        unfocusedLabelColor = MaterialTheme.colorScheme.onSurfaceVariant,
                        focusedTextColor = MaterialTheme.colorScheme.onSurface,
                        unfocusedTextColor = MaterialTheme.colorScheme.onSurface
                    ),
                    shape = RoundedCornerShape(12.dp)
                )

                // CVV
                OutlinedTextField(
                    value = cardCvv,
                    onValueChange = onCardCvvChange,
                    label = { Text(stringResource(Res.string.invest_flow_card_cvv)) },
                    placeholder = { Text(stringResource(Res.string.invest_flow_card_cvv_placeholder)) },
                    modifier = Modifier.weight(1f),
                    keyboardOptions = KeyboardOptions(
                        keyboardType = KeyboardType.Number,
                        imeAction = ImeAction.Next
                    ),
                    singleLine = true,
                    isError = cardCvv.isNotEmpty() && !isValidCvv(cardCvv),
                    supportingText = {
                        if (cardCvv.isNotEmpty() && !isValidCvv(cardCvv)) {
                            Text(
                                text = stringResource(Res.string.invest_flow_card_cvv_error),
                                color = MaterialTheme.colorScheme.error
                            )
                        }
                    },
                    colors = OutlinedTextFieldDefaults.colors(
                        focusedBorderColor = MaterialTheme.colorScheme.primary,
                        unfocusedBorderColor = MaterialTheme.colorScheme.outline.copy(alpha = 0.5f),
                        errorBorderColor = MaterialTheme.colorScheme.error,
                        focusedLabelColor = MaterialTheme.colorScheme.primary,
                        unfocusedLabelColor = MaterialTheme.colorScheme.onSurfaceVariant,
                        focusedTextColor = MaterialTheme.colorScheme.onSurface,
                        unfocusedTextColor = MaterialTheme.colorScheme.onSurface
                    ),
                    shape = RoundedCornerShape(12.dp)
                )
            }

            // Card Holder Name
            OutlinedTextField(
                value = cardHolderName,
                onValueChange = onCardHolderNameChange,
                label = { Text(stringResource(Res.string.invest_flow_card_holder_name)) },
                placeholder = { Text(stringResource(Res.string.invest_flow_card_holder_name_placeholder)) },
                modifier = Modifier.fillMaxWidth(),
                keyboardOptions = KeyboardOptions(
                    keyboardType = KeyboardType.Text,
                    imeAction = ImeAction.Done
                ),
                singleLine = true,
                colors = OutlinedTextFieldDefaults.colors(
                    focusedBorderColor = MaterialTheme.colorScheme.primary,
                    unfocusedBorderColor = MaterialTheme.colorScheme.outline.copy(alpha = 0.5f),
                    focusedLabelColor = MaterialTheme.colorScheme.primary,
                    unfocusedLabelColor = MaterialTheme.colorScheme.onSurfaceVariant,
                    focusedTextColor = MaterialTheme.colorScheme.onSurface,
                    unfocusedTextColor = MaterialTheme.colorScheme.onSurface
                ),
                shape = RoundedCornerShape(12.dp)
            )
        }
    }
}

// Validation and formatting functions (copy from InvestmentFlowScreen)
@Composable
private fun detectCardType(cardNumber: String): String? {
    val digitsOnly = cardNumber.replace(" ", "")
    if (digitsOnly.isEmpty()) return null

    return when {
        digitsOnly.matches(Regex("^4\\d{12}(\\d{3})?$")) -> stringResource(Res.string.invest_flow_card_type_visa)
        digitsOnly.matches(Regex("^5[1-5]\\d{14}$")) -> stringResource(Res.string.invest_flow_card_type_mastercard)
        else -> null
    }
}

private fun isValidCardNumber(cardNumber: String): Boolean {
    val digitsOnly = cardNumber.replace(" ", "")
    return digitsOnly.matches(Regex("^4\\d{12}(\\d{3})?$")) || // Visa
           digitsOnly.matches(Regex("^5[1-5]\\d{14}$")) // MasterCard
}

private fun formatCardNumber(input: String): String {
    val digitsOnly = input.filter { it.isDigit() }
    return digitsOnly.chunked(4).joinToString(" ").take(19)
}

@OptIn(ExperimentalTime::class)
private fun isValidExpiry(expiry: String): Boolean {
    if (expiry.length != 5 || !expiry.matches(Regex("\\d{2}/\\d{2}"))) {
        return false
    }

    val parts = expiry.split("/")
    val month = parts[0].toIntOrNull() ?: return false
    val year = parts[1].toIntOrNull() ?: return false

    if (month < 1 || month > 12) return false

    // Check if expiry is in the future
    val today = Clock.System.todayIn(TimeZone.currentSystemDefault())
    val currentMonth = today.month.number

    // Convert 2-digit year to full year (assuming 20xx for years 00-99)
    val fullYear = 2000 + year

    return try {
        // Compare year and month (card expires at the end of the month)
        if (fullYear > today.year) {
            true // Future year
        } else if (fullYear == today.year) {
            month >= currentMonth // Same year, check month
        } else {
            false // Past year
        }
    } catch (e: Exception) {
        false
    }
}

private fun formatExpiry(input: String): String {
    val digitsOnly = input.filter { it.isDigit() }
    return when {
        digitsOnly.length <= 2 -> digitsOnly
        else -> "${digitsOnly.take(2)}/${digitsOnly.drop(2).take(2)}"
    }
}

private fun isValidCvv(cvv: String): Boolean {
    return cvv.length == 3 && cvv.all { it.isDigit() }
}

private fun formatCvv(input: String): String {
    return input.filter { it.isDigit() }.take(3)
}




================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/ui/screens/ConstructionCompanyDetailsScreen.kt
================================================
package com.yet.home.ui.screens

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.PaddingValues
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.aspectRatio
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.Close
import androidx.compose.material.icons.filled.LocationOn
import androidx.compose.material.icons.filled.People
import androidx.compose.material.icons.filled.Star
import androidx.compose.material.icons.filled.TrendingUp
import androidx.compose.material3.Button
import androidx.compose.material3.ButtonDefaults
import androidx.compose.material3.Card
import androidx.compose.material3.CardDefaults
import androidx.compose.material3.CircularProgressIndicator
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Icon
import androidx.compose.material3.IconButton
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.ModalBottomSheet
import androidx.compose.material3.SheetState
import androidx.compose.material3.SheetValue
import androidx.compose.material3.Surface
import androidx.compose.material3.Text
import androidx.compose.material3.rememberModalBottomSheetState
import androidx.compose.runtime.Composable
import androidx.compose.runtime.LaunchedEffect
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.rememberCoroutineScope
import androidx.compose.runtime.setValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.layout.ContentScale
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.navigation.NavController
import coil3.compose.AsyncImage
import com.yet.domain.model.ConstructionCompany
import com.yet.home.ui.component.theme.dashboardBackground
import com.yet.home.ui.navigation.NavDestination
import com.yet.home.utils.formatCurrencyRubles
import com.yet.home.utils.formatNumberWithSpaces
import com.yet.home.utils.formatTwoDecimalCommon
import com.yet.home.viewmodel.ConstructionCompanyDetailsViewModel
import homepasss.composeapp.generated.resources.Res
import homepasss.composeapp.generated.resources.company_details_about
import homepasss.composeapp.generated.resources.company_details_expected_return
import homepasss.composeapp.generated.resources.company_details_invest
import homepasss.composeapp.generated.resources.company_details_investment_progress
import homepasss.composeapp.generated.resources.company_details_investors
import homepasss.composeapp.generated.resources.company_details_min_investment
import homepasss.composeapp.generated.resources.company_details_projects
import homepasss.composeapp.generated.resources.company_details_statistics
import homepasss.composeapp.generated.resources.investments_clear
import homepasss.composeapp.generated.resources.investments_error
import homepasss.composeapp.generated.resources.investments_projects_completed
import kotlinx.coroutines.delay
import kotlinx.coroutines.launch
import org.jetbrains.compose.resources.stringResource
import org.koin.compose.viewmodel.koinViewModel

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun ConstructionCompanyDetailsBottomSheet(
    companyId: String,
    navController: NavController,
    onClose: () -> Unit
) {
    val sheetState = rememberModalBottomSheetState(
        skipPartiallyExpanded = true,
    )
    val coroutineScope = rememberCoroutineScope()

    // Track previous value to detect transition from Expanded to Hidden
    var previousValue by remember { mutableStateOf<SheetValue?>(null) }

    // Handle sheet dismissal - only call onClose when sheet transitions from Expanded to Hidden
    LaunchedEffect(sheetState.currentValue) {
        if (previousValue == SheetValue.Expanded && sheetState.currentValue == SheetValue.Hidden) {
            // Small delay to ensure the sheet animation completes
            delay(200)
            onClose()
        }
        previousValue = sheetState.currentValue
    }

    ModalBottomSheet(
        onDismissRequest = {
            coroutineScope.launch {
                sheetState.hide()
            }
        },
        sheetState = sheetState,
        containerColor = Color.Transparent,
        dragHandle = {
            Box(
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(vertical = 12.dp),
                contentAlignment = Alignment.Center
            ) {
                Surface(
                    modifier = Modifier
                        .width(40.dp)
                        .height(4.dp),
                    shape = RoundedCornerShape(2.dp),
                    color = Color.White.copy(alpha = 0.3f)
                ) {}
                Row(
                    modifier = Modifier
                        .fillMaxWidth()
                        .padding(horizontal = 16.dp),
                    horizontalArrangement = Arrangement.End
                ) {
                    IconButton(onClick = {
                        coroutineScope.launch {
                            sheetState.hide()
                        }
                    }) {
                        Icon(
                            imageVector = Icons.Default.Close,
                            contentDescription = stringResource(Res.string.investments_clear),
                            tint = MaterialTheme.colorScheme.onSurface
                        )
                    }
                }
            }
        }
    ) {
        ConstructionCompanyDetailsContent(
            companyId = companyId,
            sheetState = sheetState,
            navController = navController,
            onClose = {
                coroutineScope.launch {
                    sheetState.hide()
                }
            }
        )
    }
}

@OptIn(ExperimentalMaterial3Api::class)
@Composable
private fun ConstructionCompanyDetailsContent(
    companyId: String,
    sheetState: SheetState,
    onClose: () -> Unit,
    navController: NavController,
    viewModel: ConstructionCompanyDetailsViewModel = koinViewModel()
) {
    val company by viewModel.company.collectAsState()
    val isLoading by viewModel.isLoading.collectAsState()
    val error by viewModel.error.collectAsState()
    val coroutineScope = rememberCoroutineScope()
    
    // Track navigation to invest screen
    var isNavigatingToInvest by remember { mutableStateOf(false) }
    var investCompanyId by remember { mutableStateOf<String?>(null) }

    LaunchedEffect(companyId) {
        viewModel.loadCompanyDetails(companyId)
    }
    
    // Handle navigation to invest screen after sheet closes
    LaunchedEffect(sheetState.currentValue) {
        if (isNavigatingToInvest && investCompanyId != null && sheetState.currentValue == SheetValue.Hidden) {
            delay(200)
            navController.navigate(NavDestination.InvestInCompany(companyId = investCompanyId!!))
            investCompanyId = null
            isNavigatingToInvest = false
        }
    }

    Box(
        modifier = Modifier
            .fillMaxSize()
            .background(dashboardBackground)
    ) {
        when {
            isLoading -> {
                Box(
                    modifier = Modifier.fillMaxSize(),
                    contentAlignment = Alignment.Center
                ) {
                    CircularProgressIndicator()
                }
            }
            error != null -> {
                Column(
                    modifier = Modifier
                        .fillMaxSize()
                        .padding(32.dp),
                    horizontalAlignment = Alignment.CenterHorizontally,
                    verticalArrangement = Arrangement.Center
                ) {
                    Text(
                        text = error ?: stringResource(Res.string.investments_error),
                        style = MaterialTheme.typography.bodyLarge,
                        color = MaterialTheme.colorScheme.error
                    )
                }
            }
            company != null -> {
                LazyColumn(
                    modifier = Modifier.fillMaxSize(),
                    contentPadding = PaddingValues(bottom = 80.dp),
                    verticalArrangement = Arrangement.spacedBy(16.dp)
                ) {
                    // Header Image
                    item {
                        CompanyHeaderImage(company = company!!)
                    }

                    // Company Info
                    item {
                        CompanyInfoCard(
                            company = company!!,
                            modifier = Modifier.padding(horizontal = 16.dp)
                        )
                    }

                    // Statistics Card
                    item {
                        StatisticsCard(
                            company = company!!,
                            modifier = Modifier.padding(horizontal = 16.dp)
                        )
                    }

                    // Investment Info Card
                    item {
                        InvestmentInfoCard(
                            company = company!!,
                            modifier = Modifier.padding(horizontal = 16.dp)
                        )
                    }

                    // About Card
                    item {
                        AboutCard(
                            description = company!!.description,
                            modifier = Modifier.padding(horizontal = 16.dp)
                        )
                    }

                    // Action Button
                    item {
                        Button(
                            onClick = {
                                // Navigate to investment flow after sheet closes
                                isNavigatingToInvest = true
                                investCompanyId = companyId
                                coroutineScope.launch {
                                    sheetState.hide()
                                }
                            },
                            modifier = Modifier
                                .fillMaxWidth()
                                .padding(horizontal = 16.dp),
                            colors = ButtonDefaults.buttonColors(
                                containerColor = MaterialTheme.colorScheme.primary
                            )
                        ) {
                            Text(
                                text = stringResource(Res.string.company_details_invest),
                                style = MaterialTheme.typography.titleMedium,
                                fontWeight = FontWeight.Bold
                            )
                        }
                    }
                }
            }
        }
    }
}

@Composable
private fun CompanyHeaderImage(company: ConstructionCompany) {
    Box(
        modifier = Modifier
            .fillMaxWidth()
            .aspectRatio(16f / 9f)
    ) {
        if (company.imageUrl != null) {
            AsyncImage(
                model = company.imageUrl,
                contentDescription = company.name,
                modifier = Modifier.fillMaxSize(),
                contentScale = ContentScale.Crop
            )
        } else {
            Box(
                modifier = Modifier
                    .fillMaxSize()
                    .background(Color.White.copy(alpha = 0.1f)),
                contentAlignment = Alignment.Center
            ) {
                Text(
                    text = company.name,
                    style = MaterialTheme.typography.headlineMedium,
                    color = MaterialTheme.colorScheme.onSurface
                )
            }
        }

        // Rating badge
        Surface(
            modifier = Modifier
                .align(Alignment.TopEnd)
                .padding(16.dp),
            shape = RoundedCornerShape(8.dp),
            color = Color.Black.copy(alpha = 0.6f)
        ) {
            Row(
                modifier = Modifier.padding(horizontal = 12.dp, vertical = 8.dp),
                verticalAlignment = Alignment.CenterVertically,
                horizontalArrangement = Arrangement.spacedBy(6.dp)
            ) {
                Icon(
                    imageVector = Icons.Default.Star,
                    contentDescription = null,
                    modifier = Modifier.size(18.dp),
                    tint = Color(0xFFFFD700)
                )
                Text(
                    text = formatTwoDecimalCommon(company.rating),
                    style = MaterialTheme.typography.titleMedium,
                    color = Color.White,
                    fontWeight = FontWeight.Bold
                )
            }
        }
    }
}

@Composable
private fun CompanyInfoCard(
    company: ConstructionCompany,
    modifier: Modifier = Modifier
) {
    Card(
        modifier = modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Text(
                text = company.name,
                style = MaterialTheme.typography.headlineSmall,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.onSurface
            )

            Spacer(modifier = Modifier.height(12.dp))

            // Location
            Row(
                verticalAlignment = Alignment.CenterVertically
            ) {
                Icon(
                    imageVector = Icons.Default.LocationOn,
                    contentDescription = null,
                    modifier = Modifier.size(20.dp),
                    tint = MaterialTheme.colorScheme.onSurfaceVariant
                )
                Spacer(modifier = Modifier.width(8.dp))
                Text(
                    text = company.location,
                    style = MaterialTheme.typography.bodyLarge,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
            }
        }
    }
}

@Composable
private fun StatisticsCard(
    company: ConstructionCompany,
    modifier: Modifier = Modifier
) {
    Card(
        modifier = modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Text(
                text = stringResource(Res.string.company_details_statistics),
                style = MaterialTheme.typography.titleLarge,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.onSurface
            )

            Spacer(modifier = Modifier.height(16.dp))

            // Projects
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween,
                verticalAlignment = Alignment.CenterVertically
            ) {
                Text(
                    text = stringResource(Res.string.company_details_projects),
                    style = MaterialTheme.typography.bodyLarge,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
                Text(
                    text = stringResource(
                        Res.string.investments_projects_completed,
                        company.completedProjects,
                        company.totalProjects
                    ),
                    style = MaterialTheme.typography.bodyLarge,
                    fontWeight = FontWeight.Bold,
                    color = MaterialTheme.colorScheme.onSurface
                )
            }

            Spacer(modifier = Modifier.height(12.dp))

            // Investors
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween,
                verticalAlignment = Alignment.CenterVertically
            ) {
                Row(
                    verticalAlignment = Alignment.CenterVertically
                ) {
                    Icon(
                        imageVector = Icons.Default.People,
                        contentDescription = null,
                        modifier = Modifier.size(20.dp),
                        tint = MaterialTheme.colorScheme.onSurfaceVariant
                    )
                    Spacer(modifier = Modifier.width(8.dp))
                    Text(
                        text = stringResource(Res.string.company_details_investors),
                        style = MaterialTheme.typography.bodyLarge,
                        color = MaterialTheme.colorScheme.onSurfaceVariant
                    )
                }
                Text(
                    text = formatNumberWithSpaces(company.investorsCount.toLong()),
                    style = MaterialTheme.typography.bodyLarge,
                    fontWeight = FontWeight.Bold,
                    color = MaterialTheme.colorScheme.onSurface
                )
            }

            Spacer(modifier = Modifier.height(12.dp))

            // Expected Return
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween,
                verticalAlignment = Alignment.CenterVertically
            ) {
                Row(
                    verticalAlignment = Alignment.CenterVertically
                ) {
                    Icon(
                        imageVector = Icons.Default.TrendingUp,
                        contentDescription = null,
                        modifier = Modifier.size(20.dp),
                        tint = MaterialTheme.colorScheme.tertiary
                    )
                    Spacer(modifier = Modifier.width(8.dp))
                    Text(
                        text = stringResource(Res.string.company_details_expected_return),
                        style = MaterialTheme.typography.bodyLarge,
                        color = MaterialTheme.colorScheme.onSurfaceVariant
                    )
                }
                Text(
                    text = "${formatTwoDecimalCommon(company.expectedReturn)}%",
                    style = MaterialTheme.typography.bodyLarge,
                    fontWeight = FontWeight.Bold,
                    color = MaterialTheme.colorScheme.tertiary
                )
            }
        }
    }
}

@Composable
private fun InvestmentInfoCard(
    company: ConstructionCompany,
    modifier: Modifier = Modifier
) {
    val progress = (company.currentInvestmentAmount / company.totalInvestmentAmount).coerceIn(0.0, 1.0)

    Card(
        modifier = modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Text(
                text = stringResource(Res.string.company_details_investment_progress),
                style = MaterialTheme.typography.titleLarge,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.onSurface
            )

            Spacer(modifier = Modifier.height(16.dp))

            // Progress
            Column {
                Row(
                    modifier = Modifier.fillMaxWidth(),
                    horizontalArrangement = Arrangement.SpaceBetween
                ) {
                    Text(
                        text = "${(progress * 100).toInt()}%",
                        style = MaterialTheme.typography.titleMedium,
                        fontWeight = FontWeight.Bold,
                        color = MaterialTheme.colorScheme.primary
                    )
                    Text(
                        text = "${formatCurrencyRubles(company.currentInvestmentAmount)} / ${formatCurrencyRubles(company.totalInvestmentAmount)}",
                        style = MaterialTheme.typography.bodyMedium,
                        color = MaterialTheme.colorScheme.onSurfaceVariant
                    )
                }
                Spacer(modifier = Modifier.height(8.dp))
                Surface(
                    modifier = Modifier
                        .fillMaxWidth()
                        .height(8.dp),
                    shape = RoundedCornerShape(4.dp),
                    color = MaterialTheme.colorScheme.surfaceVariant
                ) {
                    Box(
                        modifier = Modifier
                            .fillMaxWidth()
                            .height(8.dp)
                    ) {
                        Surface(
                            modifier = Modifier
                                .fillMaxWidth(progress.toFloat())
                                .height(8.dp),
                            shape = RoundedCornerShape(4.dp),
                            color = MaterialTheme.colorScheme.primary
                        ) {}
                    }
                }
            }

            Spacer(modifier = Modifier.height(16.dp))

            // Min Investment
            Column {
                Text(
                    text = stringResource(Res.string.company_details_min_investment),
                    style = MaterialTheme.typography.bodyMedium,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
                Spacer(modifier = Modifier.height(4.dp))
                Text(
                    text = formatCurrencyRubles(company.minInvestmentAmount),
                    style = MaterialTheme.typography.headlineSmall,
                    fontWeight = FontWeight.Bold,
                    color = MaterialTheme.colorScheme.primary
                )
            }
        }
    }
}

@Composable
private fun AboutCard(
    description: String,
    modifier: Modifier = Modifier
) {
    Card(
        modifier = modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Text(
                text = stringResource(Res.string.company_details_about),
                style = MaterialTheme.typography.titleLarge,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.onSurface
            )

            Spacer(modifier = Modifier.height(12.dp))

            Text(
                text = description,
                style = MaterialTheme.typography.bodyLarge,
                color = MaterialTheme.colorScheme.onSurfaceVariant,
                lineHeight = MaterialTheme.typography.bodyLarge.lineHeight * 1.5
            )
        }
    }
}




================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/ui/screens/HomeScreen.kt
================================================
package com.yet.home.ui.screens

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.aspectRatio
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.items
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.AccountCircle
import androidx.compose.material.icons.filled.ArrowUpward
import androidx.compose.material.icons.filled.LocationOn
import androidx.compose.material.icons.filled.People
import androidx.compose.material.icons.filled.Wallet
import androidx.compose.material3.Button
import androidx.compose.material3.Card
import androidx.compose.material3.CardDefaults
import androidx.compose.material3.CircularProgressIndicator
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Icon
import androidx.compose.material3.LinearProgressIndicator
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.OutlinedTextField
import androidx.compose.material3.Scaffold
import androidx.compose.material3.Surface
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.setValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.layout.ContentScale
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.navigation.NavController
import coil3.compose.AsyncImage
import com.yet.home.ui.navigation.NavDestination
import com.yet.domain.model.House
import com.yet.home.ui.component.theme.HomeTheme
import com.yet.home.ui.component.theme.dashboardBackground
import com.yet.home.utils.formatCurrencyRubles
import com.yet.home.utils.formatCurrencyRublesCompact
import com.yet.home.utils.formatNumberWithSpaces
import com.yet.home.viewmodel.HomeViewModel
import com.yet.home.viewmodel.PortfolioData
import com.yet.home.viewmodel.SolanaNetworkUiState
import com.yet.home.viewmodel.SolanaNetworkViewModel
import homepasss.composeapp.generated.resources.Res
import homepasss.composeapp.generated.resources.guest
import homepasss.composeapp.generated.resources.home_available_percent
import homepasss.composeapp.generated.resources.home_featured_coming_soon
import homepasss.composeapp.generated.resources.home_from
import homepasss.composeapp.generated.resources.home_portfolio_change
import homepasss.composeapp.generated.resources.home_total_portfolio
import homepasss.composeapp.generated.resources.home_welcome
import kotlinx.datetime.LocalDate
import kotlinx.datetime.LocalDateTime
import kotlinx.datetime.LocalTime
import org.jetbrains.compose.resources.stringResource
import org.jetbrains.compose.ui.tooling.preview.Preview
import org.koin.compose.viewmodel.koinViewModel

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun HomeScreen(
    navController: NavController,
    modifier: Modifier = Modifier,
    viewModel: HomeViewModel = koinViewModel()
) {
    val houses by viewModel.houses.collectAsState()
    val currentUser by viewModel.currentUser.collectAsState()
    val portfolioData by viewModel.portfolioData.collectAsState()
    val isLoading by viewModel.isLoading.collectAsState()
    val solanaViewModel = koinViewModel<SolanaNetworkViewModel>()
    val solanaState by solanaViewModel.uiState.collectAsState()

    Scaffold(
        modifier = modifier.fillMaxSize(),
        containerColor = Color.Transparent,
        content = { innerPadding ->
            if (isLoading) {
                Box(
                    modifier = Modifier.fillMaxSize(),
                    contentAlignment = Alignment.Center
                ) {
                    CircularProgressIndicator()
                }
            } else {
                LazyColumn(
                    modifier = Modifier
                        .fillMaxSize()
                        .background(dashboardBackground)
                        .padding(top = innerPadding.calculateTopPadding())
                        .padding(horizontal = 16.dp),
                    verticalArrangement = Arrangement.spacedBy(20.dp)
                ) {
                    item {
                        Spacer(modifier = Modifier.height(8.dp))
                    }

                    // Welcome Section
                    item {
                        WelcomeSection(userName = currentUser?.name ?: "")
                    }

                    // Portfolio Card
                    item {
                        PortfolioCard(portfolioData = portfolioData)
                    }

                    item {
                        SolanaNetworkCard(
                            state = solanaState,
                            onAccountChange = solanaViewModel::updateWatchAccount,
                            onRefresh = solanaViewModel::refresh,
                            onRequestAirdrop = solanaViewModel::requestAirdrop
                        )
                    }

                    // All Houses
                    if (houses.isEmpty()) {
                        item {
                            Column(
                                modifier = Modifier
                                    .fillMaxWidth()
                                    .padding(32.dp),
                                horizontalAlignment = Alignment.CenterHorizontally
                            ) {
                                Text(
                                    text = stringResource(Res.string.home_featured_coming_soon),
                                    style = MaterialTheme.typography.bodyLarge,
                                    color = MaterialTheme.colorScheme.onSurfaceVariant
                                )
                            }
                        }
                    } else {
                        items(houses) { house ->
                            PropertyCard(
                                house = house,
                                onClick = {
                                    navController.navigate(NavDestination.PropertyDetails(listingId = house.id.toString()))
                                }
                            )
                        }
                    }

                    item {
                        Spacer(modifier = Modifier.height(80.dp)) // Space for bottom navigation
                    }
                }
            }
        }
    )
}

@Composable
private fun SolanaNetworkCard(
    state: SolanaNetworkUiState,
    onAccountChange: (String) -> Unit,
    onRefresh: () -> Unit,
    onRequestAirdrop: (Double) -> Unit,
) {
    var airdropInput by remember(state.watchAccount) { mutableStateOf("0.1") }
    val parsedAmount = airdropInput.toDoubleOrNull()
    Card(
        modifier = Modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.08f)
        ),
    ) {
        Column(
            modifier = Modifier.padding(16.dp),
            verticalArrangement = Arrangement.spacedBy(12.dp)
        ) {
            Text(
                text = "Solana Devnet",
                style = MaterialTheme.typography.titleLarge,
                fontWeight = FontWeight.Bold
            )
            Text(
                text = "RPC: ${state.endpoint}",
                style = MaterialTheme.typography.bodyMedium,
                color = MaterialTheme.colorScheme.onSurfaceVariant
            )
            if (state.isLoading) {
                LinearProgressIndicator(modifier = Modifier.fillMaxWidth())
            }
            OutlinedTextField(
                value = state.watchAccount,
                onValueChange = onAccountChange,
                label = { Text("Публичный ключ Solana") },
                singleLine = true,
                modifier = Modifier.fillMaxWidth()
            )
            state.status?.let { status ->
                Text(
                    text = "Slot: ${status.slot}",
                    style = MaterialTheme.typography.bodyMedium
                )
                Text(
                    text = "Blockhash: ${status.blockhash.take(28)}…",
                    style = MaterialTheme.typography.bodyMedium
                )
                Text(
                    text = "Last block height: ${status.lastValidBlockHeight}",
                    style = MaterialTheme.typography.bodyMedium
                )
            } ?: Text(
                text = "Нет данных о сети. Нажмите «Обновить».",
                style = MaterialTheme.typography.bodyMedium
            )
            state.balance?.let { balance ->
                Text(
                    text = "Баланс: ${balance.sol} SOL",
                    style = MaterialTheme.typography.bodyLarge,
                    fontWeight = FontWeight.Medium
                )
                Text(
                    text = "Lamports: ${balance.lamports}",
                    style = MaterialTheme.typography.bodySmall,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
            }
            OutlinedTextField(
                value = airdropInput,
                onValueChange = { airdropInput = it },
                label = { Text("Сумма airdrop (SOL)") },
                singleLine = true,
                modifier = Modifier.fillMaxWidth()
            )
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.spacedBy(12.dp)
            ) {
                Button(
                    onClick = onRefresh,
                    enabled = !state.isLoading,
                    modifier = Modifier.weight(1f)
                ) {
                    Text("Обновить")
                }
                Button(
                    onClick = {
                        parsedAmount?.let(onRequestAirdrop)
                    },
                    enabled = !state.isLoading && parsedAmount != null && parsedAmount > 0.0,
                    modifier = Modifier.weight(1f)
                ) {
                    Text("Airdrop")
                }
            }
            state.lastSignature?.let { signature ->
                Text(
                    text = "Tx: ${signature.take(32)}…",
                    style = MaterialTheme.typography.bodySmall,
                    color = Color(0xFF22D3EE)
                )
            }
            state.errorMessage?.let { message ->
                Text(
                    text = message,
                    style = MaterialTheme.typography.bodySmall,
                    color = Color(0xFFF87171)
                )
            }
        }
    }
}

@Composable
private fun WelcomeSection(userName: String) {
    Column {
        Text(
            text = stringResource(Res.string.home_welcome),
            style = MaterialTheme.typography.bodyLarge,
            color = MaterialTheme.colorScheme.onSurfaceVariant
        )
        Text(
            text = userName.ifEmpty { stringResource(Res.string.guest) },
            style = MaterialTheme.typography.headlineLarge,
            fontWeight = FontWeight.Bold,
            color = MaterialTheme.colorScheme.onSurface
        )
    }
}

@Composable
private fun PortfolioCard(portfolioData: PortfolioData?) {
    Card(
        modifier = Modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween,
                verticalAlignment = Alignment.CenterVertically
            ) {
                Text(
                    text = stringResource(Res.string.home_total_portfolio),
                    style = MaterialTheme.typography.titleMedium,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
                Icon(
                    imageVector = Icons.Default.Wallet,
                    contentDescription = null,
                    modifier = Modifier.size(24.dp),
                    tint = MaterialTheme.colorScheme.onSurfaceVariant
                )
            }

            Spacer(modifier = Modifier.height(8.dp))

            val totalValue = portfolioData?.totalValue ?: 8450000.0
            Text(
                text = formatCurrencyRubles(totalValue),
                style = MaterialTheme.typography.headlineLarge,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.onSurface
            )

            portfolioData?.let { data ->
                Spacer(modifier = Modifier.height(4.dp))
                Row(
                    verticalAlignment = Alignment.CenterVertically
                ) {
                    Icon(
                        imageVector = Icons.Default.ArrowUpward,
                        contentDescription = null,
                        modifier = Modifier.size(16.dp),
                        tint = MaterialTheme.colorScheme.tertiary
                    )
                    Spacer(modifier = Modifier.width(4.dp))
                    Text(
                        text = stringResource(
                            Res.string.home_portfolio_change,
                            formatNumberWithSpaces(data.changeAmount.toLong()),
                            formatCurrencyRublesCompact(data.changePercentage)
                        ),
                        style = MaterialTheme.typography.bodyMedium,
                        color = MaterialTheme.colorScheme.tertiary
                    )
                }
            }
        }
    }
}

@Composable
fun PropertyCard(
    house: House,
    onClick: () -> Unit = {}
) {
    Card(
        modifier = Modifier
            .fillMaxWidth()
            .clickable(onClick = onClick),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column {
            // Image Section with badges
            Box(
                modifier = Modifier
                    .fillMaxWidth()
                    .aspectRatio(16f / 9f)
                    .clip(RoundedCornerShape(topStart = 16.dp, topEnd = 16.dp))
            ) {
                // Image from server using coil3
                val firstImage = house.images.firstOrNull()
                if (firstImage != null) {
                    AsyncImage(
                        model = firstImage,
                        contentDescription = house.name,
                        modifier = Modifier.fillMaxSize(),
                        contentScale = ContentScale.Crop,
                        onError = {
                            // Fallback to placeholder on error
                        }
                    )
                } else {
                    // Placeholder if no image URL
                    Box(
                        modifier = Modifier.fillMaxSize(),
                        contentAlignment = Alignment.Center
                    ) {
                        Icon(
                            imageVector = Icons.Default.AccountCircle,
                            contentDescription = null,
                            modifier = Modifier.size(64.dp),
                            tint = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.3f)
                        )
                    }
                }

                // Available badge (bottom left)
                Surface(
                    modifier = Modifier
                        .align(Alignment.BottomStart)
                        .padding(12.dp),
                    shape = RoundedCornerShape(8.dp),
                    color = Color.Black.copy(alpha = 0.6f)
                ) {
                    Text(
                        text = stringResource(Res.string.home_available_percent, 15),
                        modifier = Modifier.padding(horizontal = 8.dp, vertical = 4.dp),
                        style = MaterialTheme.typography.labelMedium,
                        color = Color.White
                    )
                }

                // Return badge (top right)
                Surface(
                    modifier = Modifier
                        .align(Alignment.TopEnd)
                        .padding(12.dp),
                    shape = RoundedCornerShape(8.dp),
                    color = MaterialTheme.colorScheme.primaryContainer
                ) {
                    Row(
                        modifier = Modifier.padding(horizontal = 8.dp, vertical = 4.dp),
                        verticalAlignment = Alignment.CenterVertically,
                        horizontalArrangement = Arrangement.spacedBy(4.dp)
                    ) {
                        Icon(
                            imageVector = Icons.Default.ArrowUpward,
                            contentDescription = null,
                            modifier = Modifier.size(14.dp),
                            tint = MaterialTheme.colorScheme.primary
                        )
                        Text(
                            text = "+12.5%", //todo
                            style = MaterialTheme.typography.labelMedium,
                            color = MaterialTheme.colorScheme.primary,
                            fontWeight = FontWeight.Bold
                        )
                    }
                }
            }

            // Details Section
            Column(
                modifier = Modifier
                    .padding(16.dp)
            ) {
                Text(
                    text = house.name,
                    style = MaterialTheme.typography.titleLarge,
                    fontWeight = FontWeight.Bold,
                    color = MaterialTheme.colorScheme.onSurface
                )

                Spacer(modifier = Modifier.height(8.dp))

                Row(
                    verticalAlignment = Alignment.CenterVertically
                ) {
                    Icon(
                        imageVector = Icons.Default.LocationOn,
                        contentDescription = null,
                        modifier = Modifier.size(16.dp),
                        tint = MaterialTheme.colorScheme.onSurfaceVariant
                    )
                    Spacer(modifier = Modifier.width(4.dp))
                    Text(
                        text = house.address,
                        style = MaterialTheme.typography.bodyMedium,
                        color = MaterialTheme.colorScheme.onSurfaceVariant
                    )
                }

                Spacer(modifier = Modifier.height(12.dp))

                Row(
                    modifier = Modifier.fillMaxWidth(),
                    horizontalArrangement = Arrangement.SpaceBetween,
                    verticalAlignment = Alignment.CenterVertically
                ) {
                    Column {
                        Text(
                            text = stringResource(Res.string.home_from),
                            style = MaterialTheme.typography.bodySmall,
                            color = MaterialTheme.colorScheme.onSurfaceVariant
                        )
                        Text(
                            text = formatCurrencyRubles(house.cost ?: 0.0),
                            style = MaterialTheme.typography.titleMedium,
                            fontWeight = FontWeight.Bold,
                            color = MaterialTheme.colorScheme.onSurface
                        )
                    }

                    Row(
                        verticalAlignment = Alignment.CenterVertically
                    ) {
                        Icon(
                            imageVector = Icons.Default.People,
                            contentDescription = null,
                            modifier = Modifier.size(20.dp),
                            tint = MaterialTheme.colorScheme.onSurfaceVariant
                        )
                        Spacer(modifier = Modifier.width(4.dp))
                        Text(
                            text = "247", //todo
                            style = MaterialTheme.typography.bodyMedium,
                            color = MaterialTheme.colorScheme.onSurfaceVariant
                        )
                    }
                }
            }
        }
    }
}

@Preview
@Composable
fun HomeScreenPreview() {
    HomeTheme {
        PropertyCard(
            house = House(
                id = 1,
                name = "Cozy Apartment in the City",
                address = "123 Main St, Cityville",
                cost = 150000.0,
                images = listOf("https://www.compass.com/m/0/9f190731-0e47-4848-8873-328df87f4ade/750x1000.webp"),
                area = 100,
                tokens = null,
                type = "APARTMENT"
            )
        )
    }
}



================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/ui/screens/InvestmentsScreen.kt
================================================
package com.yet.home.ui.screens

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.PaddingValues
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.aspectRatio
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.layout.statusBarsPadding
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.items
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.Close
import androidx.compose.material.icons.filled.LocationOn
import androidx.compose.material.icons.filled.People
import androidx.compose.material.icons.filled.Search
import androidx.compose.material.icons.filled.Star
import androidx.compose.material3.Card
import androidx.compose.material3.CardDefaults
import androidx.compose.material3.CircularProgressIndicator
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Icon
import androidx.compose.material3.IconButton
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.Scaffold
import androidx.compose.material3.Surface
import androidx.compose.material3.Text
import androidx.compose.material3.TextField
import androidx.compose.material3.TextFieldDefaults
import androidx.compose.material3.TopAppBar
import androidx.compose.material3.TopAppBarDefaults
import androidx.compose.runtime.Composable
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.setValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.layout.ContentScale
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.navigation.NavController
import coil3.compose.AsyncImage
import com.yet.domain.model.ConstructionCompany
import com.yet.home.ui.navigation.NavDestination
import com.yet.home.ui.component.theme.dashboardBackground
import com.yet.home.utils.formatCurrencyRubles
import com.yet.home.utils.formatNumberWithSpaces
import com.yet.home.utils.formatTwoDecimalCommon
import com.yet.home.viewmodel.InvestmentsViewModel
import homepasss.composeapp.generated.resources.Res
import homepasss.composeapp.generated.resources.investments_clear
import homepasss.composeapp.generated.resources.investments_companies_found
import homepasss.composeapp.generated.resources.investments_error
import homepasss.composeapp.generated.resources.investments_expected_return
import homepasss.composeapp.generated.resources.investments_investors
import homepasss.composeapp.generated.resources.investments_loading
import homepasss.composeapp.generated.resources.investments_min_investment
import homepasss.composeapp.generated.resources.investments_no_results
import homepasss.composeapp.generated.resources.investments_projects_completed
import homepasss.composeapp.generated.resources.investments_search
import homepasss.composeapp.generated.resources.investments_search_hint
import homepasss.composeapp.generated.resources.investments_try_again
import org.jetbrains.compose.resources.stringResource
import org.koin.compose.viewmodel.koinViewModel

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun InvestmentsScreen(
    navController: NavController,
    modifier: Modifier = Modifier,
    viewModel: InvestmentsViewModel = koinViewModel()
) {
    val companies by viewModel.companies.collectAsState()
    val isLoading by viewModel.isLoading.collectAsState()
    val error by viewModel.error.collectAsState()
    
    var searchQuery by remember { mutableStateOf("") }

    Scaffold(
        modifier = modifier.fillMaxSize(),
        containerColor = Color.Transparent,
        topBar = {
            SearchBar(
                query = searchQuery,
                onQueryChange = {
                    searchQuery = it
                    viewModel.searchCompanies(it)
                },
                modifier = Modifier
                    .fillMaxWidth()
                    .statusBarsPadding()
                    .padding(horizontal = 16.dp, vertical = 8.dp)
            )
        },
        content = { innerPadding ->
            Box(
                modifier = Modifier
                    .fillMaxSize()
                    .background(dashboardBackground)
            ) {
                when {
                    isLoading -> {
                        Column(
                            modifier = Modifier.fillMaxSize(),
                            horizontalAlignment = Alignment.CenterHorizontally,
                            verticalArrangement = Arrangement.Center
                        ) {
                            CircularProgressIndicator()
                            Spacer(modifier = Modifier.height(16.dp))
                            Text(
                                text = stringResource(Res.string.investments_loading),
                                style = MaterialTheme.typography.bodyLarge,
                                color = MaterialTheme.colorScheme.onSurface
                            )
                        }
                    }
                    error != null -> {
                        Column(
                            modifier = Modifier
                                .fillMaxSize()
                                .padding(32.dp),
                            horizontalAlignment = Alignment.CenterHorizontally,
                            verticalArrangement = Arrangement.Center
                        ) {
                            Text(
                                text = error ?: stringResource(Res.string.investments_error),
                                style = MaterialTheme.typography.bodyLarge,
                                color = MaterialTheme.colorScheme.error
                            )
                        }
                    }
                    companies.isEmpty() -> {
                        Column(
                            modifier = Modifier
                                .fillMaxSize()
                                .padding(32.dp),
                            horizontalAlignment = Alignment.CenterHorizontally,
                            verticalArrangement = Arrangement.Center
                        ) {
                            Text(
                                text = stringResource(Res.string.investments_no_results),
                                style = MaterialTheme.typography.bodyLarge,
                                color = MaterialTheme.colorScheme.onSurface
                            )
                            Spacer(modifier = Modifier.height(8.dp))
                            Text(
                                text = stringResource(Res.string.investments_try_again),
                                style = MaterialTheme.typography.bodyMedium,
                                color = MaterialTheme.colorScheme.onSurfaceVariant
                            )
                        }
                    }
                    else -> {
                        LazyColumn(
                            modifier = Modifier
                                .fillMaxSize()
                                .padding(top = innerPadding.calculateTopPadding()),
                            contentPadding = PaddingValues(horizontal = 16.dp, vertical = 8.dp),
                            verticalArrangement = Arrangement.spacedBy(16.dp)
                        ) {
                            item {
                                Row(
                                    modifier = Modifier.fillMaxWidth(),
                                    horizontalArrangement = Arrangement.SpaceBetween,
                                    verticalAlignment = Alignment.CenterVertically
                                ) {
                                    Text(
                                        text = stringResource(
                                            Res.string.investments_companies_found,
                                            companies.size
                                        ),
                                        style = MaterialTheme.typography.titleMedium,
                                        color = MaterialTheme.colorScheme.onSurface
                                    )
                                }
                            }

                            items(companies) { company ->
                                ConstructionCompanyCard(
                                    company = company,
                                    onClick = {
                                        navController.navigate(NavDestination.ConstructionCompanyDetails(companyId = company.id))
                                    }
                                )
                            }

                            item {
                                Spacer(modifier = Modifier.height(80.dp)) // Space for bottom navigation
                            }
                        }
                    }
                }
            }
        }
    )
}

@Composable
private fun SearchBar(
    query: String,
    onQueryChange: (String) -> Unit,
    modifier: Modifier = Modifier
) {
    Surface(
        modifier = modifier,
        shape = RoundedCornerShape(28.dp),
        color = MaterialTheme.colorScheme.surface.copy(alpha = 0.9f),
        tonalElevation = 3.dp
    ) {
        TextField(
            value = query,
            onValueChange = onQueryChange,
            modifier = Modifier.fillMaxWidth(),
            placeholder = { 
                Text(
                    text = stringResource(Res.string.investments_search_hint),
                    color = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.6f)
                ) 
            },
            leadingIcon = {
                Icon(
                    imageVector = Icons.Default.Search,
                    contentDescription = stringResource(Res.string.investments_search),
                    tint = MaterialTheme.colorScheme.onSurfaceVariant
                )
            },
            trailingIcon = {
                if (query.isNotEmpty()) {
                    IconButton(onClick = { onQueryChange("") }) {
                        Icon(
                            imageVector = Icons.Default.Close,
                            contentDescription = stringResource(Res.string.investments_clear),
                            tint = MaterialTheme.colorScheme.onSurfaceVariant
                        )
                    }
                }
            },
            singleLine = true,
            colors = TextFieldDefaults.colors(
                focusedContainerColor = Color.Transparent,
                unfocusedContainerColor = Color.Transparent,
                disabledContainerColor = Color.Transparent,
                focusedIndicatorColor = Color.Transparent,
                unfocusedIndicatorColor = Color.Transparent,
                disabledIndicatorColor = Color.Transparent
            )
        )
    }
}

@Composable
fun ConstructionCompanyCard(
    company: ConstructionCompany,
    onClick: () -> Unit = {}
) {
    Card(
        modifier = Modifier
            .fillMaxWidth()
            .clickable(onClick = onClick),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column {
            // Image Section
            Box(
                modifier = Modifier
                    .fillMaxWidth()
                    .aspectRatio(16f / 9f)
                    .clip(RoundedCornerShape(topStart = 16.dp, topEnd = 16.dp))
            ) {
                if (company.imageUrl != null) {
                    AsyncImage(
                        model = company.imageUrl,
                        contentDescription = company.name,
                        modifier = Modifier.fillMaxSize(),
                        contentScale = ContentScale.Crop
                    )
                } else {
                    Box(
                        modifier = Modifier.fillMaxSize(),
                        contentAlignment = Alignment.Center
                    ) {
                        Text(
                            text = company.name,
                            style = MaterialTheme.typography.titleLarge,
                            color = MaterialTheme.colorScheme.onSurfaceVariant
                        )
                    }
                }

                // Rating badge (top right)
                Surface(
                    modifier = Modifier
                        .align(Alignment.TopEnd)
                        .padding(12.dp),
                    shape = RoundedCornerShape(8.dp),
                    color = Color.Black.copy(alpha = 0.6f)
                ) {
                    Row(
                        modifier = Modifier.padding(horizontal = 8.dp, vertical = 4.dp),
                        verticalAlignment = Alignment.CenterVertically,
                        horizontalArrangement = Arrangement.spacedBy(4.dp)
                    ) {
                        Icon(
                            imageVector = Icons.Default.Star,
                            contentDescription = null,
                            modifier = Modifier.size(14.dp),
                            tint = Color(0xFFFFD700)
                        )
                        Text(
                            text = formatTwoDecimalCommon(company.rating),
                            style = MaterialTheme.typography.labelMedium,
                            color = Color.White,
                            fontWeight = FontWeight.Bold
                        )
                    }
                }

                // Expected Return badge (bottom left)
                Surface(
                    modifier = Modifier
                        .align(Alignment.BottomStart)
                        .padding(12.dp),
                    shape = RoundedCornerShape(8.dp),
                    color = MaterialTheme.colorScheme.tertiaryContainer
                ) {
                    Text(
                        text = stringResource(
                            Res.string.investments_expected_return,
                            formatTwoDecimalCommon(company.expectedReturn)
                        ),
                        modifier = Modifier.padding(horizontal = 8.dp, vertical = 4.dp),
                        style = MaterialTheme.typography.labelMedium,
                        color = MaterialTheme.colorScheme.onTertiaryContainer,
                        fontWeight = FontWeight.Bold
                    )
                }
            }

            // Details Section
            Column(
                modifier = Modifier.padding(16.dp)
            ) {
                Text(
                    text = company.name,
                    style = MaterialTheme.typography.titleLarge,
                    fontWeight = FontWeight.Bold,
                    color = MaterialTheme.colorScheme.onSurface
                )

                Spacer(modifier = Modifier.height(8.dp))

                Text(
                    text = company.description,
                    style = MaterialTheme.typography.bodyMedium,
                    color = MaterialTheme.colorScheme.onSurfaceVariant,
                    maxLines = 2
                )

                Spacer(modifier = Modifier.height(12.dp))

                // Location
                Row(
                    verticalAlignment = Alignment.CenterVertically,
                    modifier = Modifier.fillMaxWidth()
                ) {
                    Icon(
                        imageVector = Icons.Default.LocationOn,
                        contentDescription = null,
                        modifier = Modifier.size(16.dp),
                        tint = MaterialTheme.colorScheme.onSurfaceVariant
                    )
                    Spacer(modifier = Modifier.width(4.dp))
                    Text(
                        text = company.location,
                        style = MaterialTheme.typography.bodySmall,
                        color = MaterialTheme.colorScheme.onSurfaceVariant
                    )
                }

                Spacer(modifier = Modifier.height(12.dp))

                // Stats Row
                Row(
                    modifier = Modifier.fillMaxWidth(),
                    horizontalArrangement = Arrangement.SpaceBetween
                ) {
                    // Projects
                    Column {
                        Text(
                            text = stringResource(
                                Res.string.investments_projects_completed,
                                company.completedProjects,
                                company.totalProjects
                            ),
                            style = MaterialTheme.typography.bodySmall,
                            color = MaterialTheme.colorScheme.onSurfaceVariant
                        )
                    }

                    // Investors
                    Row(
                        verticalAlignment = Alignment.CenterVertically
                    ) {
                        Icon(
                            imageVector = Icons.Default.People,
                            contentDescription = null,
                            modifier = Modifier.size(16.dp),
                            tint = MaterialTheme.colorScheme.onSurfaceVariant
                        )
                        Spacer(modifier = Modifier.width(4.dp))
                        Text(
                            text = stringResource(
                                Res.string.investments_investors,
                                formatNumberWithSpaces(company.investorsCount.toLong())
                            ),
                            style = MaterialTheme.typography.bodySmall,
                            color = MaterialTheme.colorScheme.onSurfaceVariant
                        )
                    }
                }

                Spacer(modifier = Modifier.height(12.dp))

                // Investment Info
                Row(
                    modifier = Modifier.fillMaxWidth(),
                    horizontalArrangement = Arrangement.SpaceBetween,
                    verticalAlignment = Alignment.CenterVertically
                ) {
                    Column {
                        Text(
                            text = stringResource(Res.string.investments_min_investment),
                            style = MaterialTheme.typography.bodySmall,
                            color = MaterialTheme.colorScheme.onSurfaceVariant
                        )
                        Text(
                            text = formatCurrencyRubles(company.minInvestmentAmount),
                            style = MaterialTheme.typography.titleMedium,
                            fontWeight = FontWeight.Bold,
                            color = MaterialTheme.colorScheme.primary
                        )
                    }

                    // Progress indicator
                    val progress = (company.currentInvestmentAmount / company.totalInvestmentAmount).coerceIn(0.0, 1.0)
                    Column(
                        horizontalAlignment = Alignment.End
                    ) {
                        Text(
                            text = "${(progress * 100).toInt()}%",
                            style = MaterialTheme.typography.bodySmall,
                            color = MaterialTheme.colorScheme.onSurfaceVariant
                        )
                        Surface(
                            modifier = Modifier
                                .width(80.dp)
                                .height(4.dp),
                            shape = RoundedCornerShape(2.dp),
                            color = MaterialTheme.colorScheme.surfaceVariant
                        ) {
                            Surface(
                                modifier = Modifier
                                    .width((80.dp * progress.toFloat()).coerceAtMost(80.dp))
                                    .height(4.dp),
                                shape = RoundedCornerShape(2.dp),
                                color = MaterialTheme.colorScheme.primary
                            ) {}
                        }
                    }
                }
            }
        }
    }
}




================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/ui/screens/InvestmentSuccessScreen.kt
================================================
package com.yet.home.ui.screens

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.PaddingValues
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.Check
import androidx.compose.material3.Button
import androidx.compose.material3.ButtonDefaults
import androidx.compose.material3.Card
import androidx.compose.material3.CardDefaults
import androidx.compose.material3.Icon
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.OutlinedButton
import androidx.compose.material3.Scaffold
import androidx.compose.material3.Surface
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.navigation.NavController
import com.yet.home.ui.component.theme.dashboardBackground
import com.yet.home.utils.formatCurrencyRubles
import com.yet.home.utils.formatTwoDecimalCommon
import homepasss.composeapp.generated.resources.Res
import homepasss.composeapp.generated.resources.details_projected_income
import homepasss.composeapp.generated.resources.invest_flow_amount
import homepasss.composeapp.generated.resources.invest_flow_investment_details
import homepasss.composeapp.generated.resources.invest_flow_object
import homepasss.composeapp.generated.resources.invest_success_go_to_portfolio
import homepasss.composeapp.generated.resources.invest_success_message
import homepasss.composeapp.generated.resources.invest_success_share
import homepasss.composeapp.generated.resources.invest_success_title
import homepasss.composeapp.generated.resources.invest_success_your_share
import org.jetbrains.compose.resources.stringResource

@Composable
fun InvestmentSuccessScreen(
    listingId: String,
    sharePercentage: Float,
    investmentAmount: Double,
    propertyTitle: String,
    navController: NavController,
    modifier: Modifier = Modifier
) {
    // Calculate estimated income (12.5% yield as default)
    val yield = 12.5
    val estimatedIncomePerYear = (investmentAmount * yield) / 100
    Scaffold(
        modifier = modifier.fillMaxSize(),
        containerColor = Color.Transparent,
        content = { innerPadding ->
            Box(
                modifier = Modifier
                    .fillMaxSize()
                    .background(dashboardBackground)
            ) {
                LazyColumn(
                    modifier = Modifier
                        .fillMaxSize()
                        .padding(top = innerPadding.calculateTopPadding())
                        .padding(horizontal = 16.dp),
                    contentPadding = PaddingValues(vertical = 8.dp),
                    horizontalAlignment = Alignment.CenterHorizontally,
                    verticalArrangement = Arrangement.spacedBy(24.dp)
                ) {
                    item {
                        Spacer(modifier = Modifier.height(32.dp))
                    }

                    // Success Icon
                    item {
                        Surface(
                            modifier = Modifier.size(80.dp),
                            shape = CircleShape,
                            color = MaterialTheme.colorScheme.tertiary
                        ) {
                            Box(
                                modifier = Modifier.fillMaxSize(),
                                contentAlignment = Alignment.Center
                            ) {
                                Icon(
                                    imageVector = Icons.Default.Check,
                                    contentDescription = null,
                                    tint = Color.White,
                                    modifier = Modifier.size(48.dp)
                                )
                            }
                        }
                    }

                    // Title
                    item {
                        Text(
                            text = stringResource(Res.string.invest_success_title),
                            style = MaterialTheme.typography.headlineLarge,
                            fontWeight = FontWeight.Bold,
                            color = MaterialTheme.colorScheme.onSurface,
                            textAlign = androidx.compose.ui.text.style.TextAlign.Center
                        )
                    }

                    // Message
                    item {
                        Text(
                            text = stringResource(Res.string.invest_success_message),
                            style = MaterialTheme.typography.bodyLarge,
                            color = MaterialTheme.colorScheme.onSurfaceVariant,
                            textAlign = androidx.compose.ui.text.style.TextAlign.Center,
                            modifier = Modifier.padding(horizontal = 16.dp)
                        )
                    }

                    // Investment Details Card
                    item {
                        SuccessInvestmentDetailsCard(
                            propertyTitle = propertyTitle,
                            sharePercentage = sharePercentage,
                            investmentAmount = investmentAmount,
                            estimatedIncomePerYear = estimatedIncomePerYear
                        )
                    }

                    // Action Buttons
                    item {
                        Column(
                            modifier = Modifier.fillMaxWidth(),
                            verticalArrangement = Arrangement.spacedBy(12.dp)
                        ) {
                            Button(
                                onClick = {
                                    // Navigate to portfolio
                                    navController.navigate(com.yet.home.ui.navigation.NavDestination.Profile) {
                                        popUpTo(com.yet.home.ui.navigation.NavDestination.Home) {
                                            inclusive = false
                                        }
                                    }
                                },
                                modifier = Modifier.fillMaxWidth(),
                                colors = ButtonDefaults.buttonColors(
                                    containerColor = MaterialTheme.colorScheme.primary
                                )
                            ) {
                                Text(
                                    text = stringResource(Res.string.invest_success_go_to_portfolio),
                                    style = MaterialTheme.typography.titleMedium,
                                    fontWeight = FontWeight.Bold
                                )
                            }

                            OutlinedButton(
                                onClick = {
                                    // TODO: Implement share functionality
                                },
                                modifier = Modifier.fillMaxWidth(),
                                colors = ButtonDefaults.outlinedButtonColors(
                                    contentColor = MaterialTheme.colorScheme.onSurface
                                )
                            ) {
                                Text(
                                    text = stringResource(Res.string.invest_success_share),
                                    style = MaterialTheme.typography.titleMedium,
                                    fontWeight = FontWeight.Bold
                                )
                            }
                        }
                    }

                    item {
                        Spacer(modifier = Modifier.height(80.dp))
                    }
                }
            }
        }
    )
}

@Composable
private fun SuccessInvestmentDetailsCard(
    propertyTitle: String,
    sharePercentage: Float,
    investmentAmount: Double,
    estimatedIncomePerYear: Double
) {
    Card(
        modifier = Modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Text(
                text = stringResource(Res.string.invest_flow_investment_details),
                style = MaterialTheme.typography.titleLarge,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.onSurface
            )

            Spacer(modifier = Modifier.height(16.dp))

            SuccessDetailRow(label = stringResource(Res.string.invest_flow_object), value = propertyTitle)
            Spacer(modifier = Modifier.height(12.dp))
            SuccessDetailRow(label = stringResource(Res.string.invest_success_your_share), value = "${formatTwoDecimalCommon(sharePercentage.toDouble())}%")
            Spacer(modifier = Modifier.height(12.dp))
            SuccessDetailRow(label = stringResource(Res.string.invest_flow_amount), value = formatCurrencyRubles(investmentAmount))
            Spacer(modifier = Modifier.height(12.dp))
            SuccessDetailRow(
                label = stringResource(Res.string.details_projected_income),
                value = formatCurrencyRubles(estimatedIncomePerYear),
                valueColor = MaterialTheme.colorScheme.tertiary
            )
        }
    }
}

@Composable
private fun SuccessDetailRow(
    label: String,
    value: String,
    valueColor: Color = MaterialTheme.colorScheme.onSurface
) {
    Row(
        modifier = Modifier.fillMaxWidth(),
        horizontalArrangement = Arrangement.SpaceBetween,
        verticalAlignment = Alignment.CenterVertically
    ) {
        Text(
            text = label,
            style = MaterialTheme.typography.bodyLarge,
            color = MaterialTheme.colorScheme.onSurfaceVariant
        )
        Text(
            text = value,
            style = MaterialTheme.typography.bodyLarge,
            fontWeight = FontWeight.Bold,
            color = valueColor
        )
    }
}




================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/ui/screens/ProfileScreen.kt
================================================
package com.yet.home.ui.screens

import androidx.compose.foundation.Canvas
import androidx.compose.foundation.background
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.PaddingValues
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.items
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.AccountCircle
import androidx.compose.material.icons.filled.ArrowUpward
import androidx.compose.material.icons.filled.ExitToApp
import androidx.compose.material3.Button
import androidx.compose.material3.Card
import androidx.compose.material3.CardDefaults
import androidx.compose.material3.CircularProgressIndicator
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Icon
import androidx.compose.material3.IconButton
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.Scaffold
import androidx.compose.material3.Surface
import androidx.compose.material3.Text
import androidx.compose.material3.TextButton
import androidx.compose.material3.TopAppBar
import androidx.compose.material3.TopAppBarDefaults
import androidx.compose.runtime.Composable
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.geometry.Offset
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.graphics.Path
import androidx.compose.ui.graphics.StrokeCap
import androidx.compose.ui.graphics.drawscope.Stroke
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.text.style.TextAlign
import androidx.compose.ui.unit.dp
import com.yet.home.ui.component.theme.dashboardBackground
import com.yet.home.utils.formatCurrencyRubles
import com.yet.home.utils.formatCurrencyRublesCompact
import com.yet.home.utils.formatNumberWithSpaces
import com.yet.home.utils.formatTwoDecimalCommon
import com.yet.home.viewmodel.AuthViewModel
import com.yet.home.viewmodel.ProfileViewModel
import homepasss.composeapp.generated.resources.Res
import homepasss.composeapp.generated.resources.guest
import homepasss.composeapp.generated.resources.portfolio_empty
import homepasss.composeapp.generated.resources.profile_asset_commercial
import homepasss.composeapp.generated.resources.profile_asset_distribution
import homepasss.composeapp.generated.resources.profile_asset_land
import homepasss.composeapp.generated.resources.profile_asset_legend
import homepasss.composeapp.generated.resources.profile_asset_parking
import homepasss.composeapp.generated.resources.profile_asset_residential
import homepasss.composeapp.generated.resources.profile_auth_required
import homepasss.composeapp.generated.resources.profile_details
import homepasss.composeapp.generated.resources.profile_in_portfolio
import homepasss.composeapp.generated.resources.profile_login_button
import homepasss.composeapp.generated.resources.profile_logout
import homepasss.composeapp.generated.resources.profile_monthly_income
import homepasss.composeapp.generated.resources.profile_my_objects
import homepasss.composeapp.generated.resources.profile_objects
import homepasss.composeapp.generated.resources.profile_per_month
import homepasss.composeapp.generated.resources.profile_portfolio_dynamics
import homepasss.composeapp.generated.resources.profile_share
import homepasss.composeapp.generated.resources.profile_title
import homepasss.composeapp.generated.resources.profile_total_income
import homepasss.composeapp.generated.resources.profile_total_value_title
import org.jetbrains.compose.resources.stringResource
import org.koin.compose.viewmodel.koinViewModel

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun ProfileScreen(
    modifier: Modifier = Modifier,
    authViewModel: AuthViewModel = koinViewModel(),
    profileViewModel: ProfileViewModel = koinViewModel(),
    onLogout: () -> Unit,
    onNavigateToAuth: () -> Unit
) {
    val currentUser by authViewModel.currentUser.collectAsState()
    val propertyShares by profileViewModel.propertyShares.collectAsState()
    val totalValue by profileViewModel.totalValue.collectAsState()
    val isLoading by profileViewModel.isLoading.collectAsState()

    Scaffold(
        modifier = modifier.fillMaxSize(),
        containerColor = Color.Transparent,
        topBar = {
            TopAppBar(
                title = {
                    Text(
                        text = stringResource(Res.string.profile_title),
                        style = MaterialTheme.typography.headlineMedium
                    )
                },
                colors = TopAppBarDefaults.topAppBarColors().copy(
                    containerColor = Color.Transparent
                )
            )
        },
        content = { innerPadding ->
            Box(
                modifier = Modifier
                    .fillMaxSize()
                    .background(dashboardBackground)
            ) {
                currentUser?.let { user ->
                    if (isLoading) {
                        Column(
                            modifier = Modifier.fillMaxSize(),
                            horizontalAlignment = Alignment.CenterHorizontally,
                            verticalArrangement = Arrangement.Center
                        ) {
                            CircularProgressIndicator()
                        }
                    } else {
                        LazyColumn(
                            modifier = Modifier
                                .fillMaxSize()
                                .padding(top = innerPadding.calculateTopPadding())
                                .padding(horizontal = 16.dp),
                            contentPadding = PaddingValues(vertical = 8.dp),
                            verticalArrangement = Arrangement.spacedBy(16.dp)
                        ) {
                            item {
                                Spacer(modifier = Modifier.height(8.dp))
                            }

                            // User Avatar and Info Card
                            item {
                                UserProfileCard(
                                    userName = currentUser?.name ?: "",
                                    userEmail = currentUser?.email ?: "",
                                    onLogoutClick = {
                                        authViewModel.logout()
                                        onLogout()
                                    }
                                )
                            }

                            // Total Value Card
                            item {
                                TotalValueCard(totalValue = totalValue)
                            }

                            // Portfolio Dynamics Card (simplified chart placeholder)
                            item {
                                PortfolioDynamicsCard()
                            }

                            // Asset Distribution Card (simplified pie chart placeholder)
                            item {
                                AssetDistributionCard(propertyShares = propertyShares)
                            }

                            // My Objects Section
                            item {
                                Text(
                                    text = stringResource(Res.string.profile_my_objects),
                                    style = MaterialTheme.typography.titleLarge,
                                    fontWeight = FontWeight.Bold,
                                    color = MaterialTheme.colorScheme.onSurface,
                                    modifier = Modifier.padding(vertical = 8.dp)
                                )
                            }

                            // Property Shares as Objects
                            items(propertyShares) { share ->
                                PropertyObjectCard(share = share)
                            }

                            // If no objects, show empty state
                            if (propertyShares.isEmpty()) {
                                item {
                                    Column(
                                        modifier = Modifier
                                            .fillMaxWidth()
                                            .padding(32.dp),
                                        horizontalAlignment = Alignment.CenterHorizontally
                                    ) {
                                        Text(
                                            text = stringResource(Res.string.portfolio_empty),
                                            style = MaterialTheme.typography.bodyLarge,
                                            color = MaterialTheme.colorScheme.onSurfaceVariant
                                        )
                                    }
                                }
                            }

                            // Summary Cards Row
                            item {
                                Row(
                                    modifier = Modifier.fillMaxWidth(),
                                    horizontalArrangement = Arrangement.spacedBy(12.dp)
                                ) {
                                    SummaryCard(
                                        title = stringResource(Res.string.profile_total_income),
                                        value = calculateTotalIncome(propertyShares),
                                        subtitle = stringResource(Res.string.profile_per_month),
                                        modifier = Modifier.weight(1f)
                                    )
                                    SummaryCard(
                                        title = stringResource(Res.string.profile_objects),
                                        value = propertyShares.size.toString(),
                                        subtitle = stringResource(Res.string.profile_in_portfolio),
                                        modifier = Modifier.weight(1f)
                                    )
                                }
                            }

                            item {
                                Spacer(modifier = Modifier.height(80.dp))
                            }
                        }
                    }
                } ?: run {
                    // User not authenticated - show auth prompt
                    Column(
                        modifier = Modifier
                            .fillMaxSize()
                            .padding(innerPadding),
                        horizontalAlignment = Alignment.CenterHorizontally,
                        verticalArrangement = Arrangement.Center
                    ) {
                        Text(
                            text = stringResource(Res.string.profile_auth_required),
                            style = MaterialTheme.typography.bodyLarge,
                            color = MaterialTheme.colorScheme.onSurface,
                            textAlign = TextAlign.Center
                        )
                        Spacer(modifier = Modifier.height(24.dp))
                        Button(
                            onClick = onNavigateToAuth,
                            modifier = Modifier.fillMaxWidth(0.8f)
                        ) {
                            Text(stringResource(Res.string.profile_login_button))
                        }
                    }
                }
            }
        }
    )
}

@Composable
private fun UserProfileCard(
    userName: String,
    userEmail: String,
    onLogoutClick: () -> Unit
) {
    Card(
        modifier = Modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Row(
            modifier = Modifier
                .fillMaxWidth()
                .padding(16.dp),
            horizontalArrangement = Arrangement.spacedBy(16.dp),
            verticalAlignment = Alignment.CenterVertically
        ) {
            // Avatar
            Surface(
                modifier = Modifier.size(64.dp),
                shape = CircleShape,
                color = MaterialTheme.colorScheme.primaryContainer
            ) {
                Icon(
                    imageVector = Icons.Default.AccountCircle,
                    contentDescription = null,
                    modifier = Modifier
                        .fillMaxSize()
                        .padding(12.dp),
                    tint = MaterialTheme.colorScheme.onPrimaryContainer
                )
            }

            // Name and Email
            Column(
                modifier = Modifier.weight(1f)
            ) {
                Text(
                    text = userName.ifEmpty { stringResource(Res.string.guest) },
                    style = MaterialTheme.typography.titleLarge,
                    fontWeight = FontWeight.Bold,
                    color = MaterialTheme.colorScheme.onSurface
                )
                Spacer(modifier = Modifier.height(4.dp))
                Text(
                    text = userEmail,
                    style = MaterialTheme.typography.bodyMedium,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
            }

            // Logout Icon
            IconButton(
                onClick = onLogoutClick
            ) {
                Icon(
                    imageVector = Icons.Default.ExitToApp,
                    contentDescription = stringResource(Res.string.profile_logout),
                    tint = MaterialTheme.colorScheme.error
                )
            }
        }
    }
}

@Composable
private fun TotalValueCard(totalValue: Double) {
    Card(
        modifier = Modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Text(
                text = stringResource(Res.string.profile_total_value_title),
                style = MaterialTheme.typography.titleMedium,
                color = MaterialTheme.colorScheme.onSurfaceVariant
            )

            Spacer(modifier = Modifier.height(8.dp))

            val displayValue = if (totalValue > 0) totalValue else 8450000.0
            Text(
                text = formatCurrencyRubles(displayValue),
                style = MaterialTheme.typography.headlineLarge,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.onSurface
            )

            Spacer(modifier = Modifier.height(4.dp))

            // Mock change data
            val changeAmount = 145230.0
            val changePercentage = 1.75
            Row(
                verticalAlignment = Alignment.CenterVertically
            ) {
                Icon(
                    imageVector = Icons.Default.ArrowUpward,
                    contentDescription = null,
                    modifier = Modifier.size(16.dp),
                    tint = MaterialTheme.colorScheme.tertiary
                )
                Spacer(modifier = Modifier.width(4.dp))
                Text(
                    text = "+${formatCurrencyRublesCompact(changeAmount)} (+${
                        formatTwoDecimalCommon(
                            changePercentage
                        )
                    }%)",
                    style = MaterialTheme.typography.bodyMedium,
                    color = MaterialTheme.colorScheme.tertiary
                )
            }
        }
    }
}

@Composable
private fun PortfolioDynamicsCard() {
    // Mock data for portfolio growth over 5 years
    val portfolioData = listOf(
        7500000.0, // 2020
        7800000.0, // 2021
        8100000.0, // 2022
        8300000.0, // 2023
        8450000.0  // 2024
    )
    
    val years = listOf("2020", "2021", "2022", "2023", "2024")
    
    Card(
        modifier = Modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Text(
                text = stringResource(Res.string.profile_portfolio_dynamics),
                style = MaterialTheme.typography.titleMedium,
                color = MaterialTheme.colorScheme.onSurfaceVariant
            )

            Spacer(modifier = Modifier.height(16.dp))

            // Chart
            Box(
                modifier = Modifier
                    .fillMaxWidth()
                    .height(160.dp)
                    .clip(RoundedCornerShape(8.dp))
                    .background(Color.White.copy(alpha = 0.05f))
                    .padding(vertical = 8.dp, horizontal = 4.dp)
            ) {
                // Y-axis labels
                val minValue = portfolioData.minOrNull() ?: 0.0
                val maxValue = portfolioData.maxOrNull() ?: 1.0
                val range = maxValue - minValue
                
                Column(
                    modifier = Modifier
                        .fillMaxSize()
                        .padding(end = 8.dp),
                    verticalArrangement = Arrangement.SpaceBetween
                ) {
                    Text(
                        text = formatCompactNumber(maxValue),
                        style = MaterialTheme.typography.labelSmall,
                        color = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.6f),
                        modifier = Modifier.padding(start = 4.dp)
                    )
                    Text(
                        text = formatCompactNumber(minValue + range / 2),
                        style = MaterialTheme.typography.labelSmall,
                        color = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.6f),
                        modifier = Modifier.padding(start = 4.dp)
                    )
                    Text(
                        text = formatCompactNumber(minValue),
                        style = MaterialTheme.typography.labelSmall,
                        color = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.6f),
                        modifier = Modifier.padding(start = 4.dp)
                    )
                }

                // Chart area with graph
                Box(
                    modifier = Modifier
                        .fillMaxSize()
                        .padding(start = 50.dp, end = 8.dp, bottom = 24.dp, top = 8.dp)
                ) {
                    PortfolioChart(
                        data = portfolioData,
                        modifier = Modifier.fillMaxSize()
                    )
                }

                // X-axis labels (years)
                Row(
                    modifier = Modifier
                        .fillMaxWidth()
                        .padding(start = 50.dp, end = 8.dp, bottom = 4.dp)
                        .align(Alignment.BottomStart),
                    horizontalArrangement = Arrangement.SpaceBetween
                ) {
                    years.forEach { year ->
                        Text(
                            text = year,
                            style = MaterialTheme.typography.labelSmall,
                            color = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.6f)
                        )
                    }
                }
            }
        }
    }
}

@Composable
private fun PortfolioChart(
    data: List<Double>,
    modifier: Modifier = Modifier
) {
    val primaryColor = MaterialTheme.colorScheme.primary
    Canvas(modifier = modifier) {
        val width = size.width
        val height = size.height
        
        // Calculate min and max values
        val minValue = data.minOrNull() ?: 0.0
        val maxValue = data.maxOrNull() ?: 1.0
        val range = maxValue - minValue
        
        // Calculate points
        val points = data.mapIndexed { index, value ->
            val x = (index.toFloat() / (data.size - 1).coerceAtLeast(1)) * width
            val normalizedValue = ((value - minValue) / range.coerceAtLeast(0.1))
            val y = height - (normalizedValue * height)
            Offset(x, y.toFloat())
        }
        
        // Draw grid lines
        val gridColor = Color.White.copy(alpha = 0.1f)
        for (i in 0..2) {
            val y = (i * height / 2)
            drawLine(
                color = gridColor,
                start = Offset(0f, y),
                end = Offset(width, y),
                strokeWidth = 1.dp.toPx()
            )
        }
        
        // Draw line
        if (points.size > 1) {
            val path = Path().apply {
                moveTo(points[0].x, points[0].y)
                for (i in 1 until points.size) {
                    lineTo(points[i].x, points[i].y)
                }
            }
            
            drawPath(
                path = path,
                color = primaryColor,
                style = Stroke(
                    width = 3.dp.toPx(),
                    cap = StrokeCap.Round
                )
            )
        }
        
        // Draw points
        points.forEach { point ->
            drawCircle(
                color = primaryColor,
                radius = 4.dp.toPx(),
                center = point
            )
            // White center for points
            drawCircle(
                color = Color.White,
                radius = 2.dp.toPx(),
                center = point
            )
        }
    }
}

@Composable
private fun AssetDistributionCard(propertyShares: List<com.yet.domain.model.PropertyShare>) {
    Card(
        modifier = Modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Text(
                text = stringResource(Res.string.profile_asset_distribution),
                style = MaterialTheme.typography.titleMedium,
                color = MaterialTheme.colorScheme.onSurfaceVariant
            )

            Spacer(modifier = Modifier.height(16.dp))

            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween
            ) {
                // Simplified pie chart placeholder
                Box(
                    modifier = Modifier
                        .size(100.dp)
                        .clip(CircleShape)
                        .background(Color.White.copy(alpha = 0.05f)),
                    contentAlignment = Alignment.Center
                ) {
                    Text(
                        text = "45%",
                        style = MaterialTheme.typography.titleLarge,
                        color = MaterialTheme.colorScheme.onSurface
                    )
                }

                // Legend
                Column(
                    modifier = Modifier.padding(start = 16.dp),
                    verticalArrangement = Arrangement.spacedBy(8.dp)
                ) {
                    LegendItem(
                        label = stringResource(Res.string.profile_asset_residential),
                        percentage = 45,
                        color = Color(0xFF3B82F6)
                    )
                    LegendItem(
                        label = stringResource(Res.string.profile_asset_commercial),
                        percentage = 30,
                        color = Color(0xFF8B5CF6)
                    )
                    LegendItem(
                        label = stringResource(Res.string.profile_asset_land),
                        percentage = 15,
                        color = Color(0xFFEC4899)
                    )
                    LegendItem(
                        label = stringResource(Res.string.profile_asset_parking),
                        percentage = 10,
                        color = Color(0xFF06B6D4)
                    )
                }
            }
        }
    }
}

@Composable
private fun LegendItem(label: String, percentage: Int, color: Color) {
    Row(
        verticalAlignment = Alignment.CenterVertically
    ) {
        Box(
            modifier = Modifier
                .size(12.dp)
                .clip(CircleShape)
                .background(color)
        )
        Spacer(modifier = Modifier.width(8.dp))
        Text(
            text = stringResource(Res.string.profile_asset_legend, label, percentage),
            style = MaterialTheme.typography.bodySmall,
            color = MaterialTheme.colorScheme.onSurfaceVariant
        )
    }
}

@Composable
private fun PropertyObjectCard(share: com.yet.domain.model.PropertyShare) {
    Card(
        modifier = Modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween,
                verticalAlignment = Alignment.Top
            ) {
                Column(modifier = Modifier.weight(1f)) {
                    Text(
                        text = share.propertyTitle,
                        style = MaterialTheme.typography.titleLarge,
                        fontWeight = FontWeight.Bold,
                        color = MaterialTheme.colorScheme.onSurface
                    )
                    Spacer(modifier = Modifier.height(4.dp))
                    Text(
                        text = "Москва, Сити", // Mock location
                        style = MaterialTheme.typography.bodyMedium,
                        color = MaterialTheme.colorScheme.onSurfaceVariant
                    )
                }
                Column(
                    horizontalAlignment = Alignment.End
                ) {
                    Text(
                        text = formatCurrencyRubles(share.currentValue),
                        style = MaterialTheme.typography.titleLarge,
                        fontWeight = FontWeight.Bold,
                        color = MaterialTheme.colorScheme.onSurface
                    )
                    Row(
                        verticalAlignment = Alignment.CenterVertically
                    ) {
                        Icon(
                            imageVector = Icons.Default.ArrowUpward,
                            contentDescription = null,
                            modifier = Modifier.size(14.dp),
                            tint = MaterialTheme.colorScheme.tertiary
                        )
                        Spacer(modifier = Modifier.width(2.dp))
                        Text(
                            text = "+6%", // Mock change
                            style = MaterialTheme.typography.bodySmall,
                            color = MaterialTheme.colorScheme.tertiary
                        )
                    }
                }
            }

            Spacer(modifier = Modifier.height(12.dp))

            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween
            ) {
                    Text(
                        text = "${stringResource(Res.string.profile_share)} ${formatTwoDecimalCommon(share.percentage)}%",
                        style = MaterialTheme.typography.bodyMedium,
                        color = MaterialTheme.colorScheme.onSurfaceVariant
                    )
                Column(
                    horizontalAlignment = Alignment.End
                ) {
                    Text(
                        text = stringResource(Res.string.profile_monthly_income),
                        style = MaterialTheme.typography.bodySmall,
                        color = MaterialTheme.colorScheme.onSurfaceVariant
                    )
                    Text(
                        text = formatCurrencyRublesCompact(12500.0), // Mock income
                        style = MaterialTheme.typography.bodyMedium,
                        fontWeight = FontWeight.Bold,
                        color = MaterialTheme.colorScheme.tertiary
                    )
                }
            }

            Spacer(modifier = Modifier.height(8.dp))

            TextButton(
                onClick = { /* Navigate to details */ }
            ) {
                Text(
                    text = stringResource(Res.string.profile_details),
                    color = MaterialTheme.colorScheme.primary
                )
            }
        }
    }
}

@Composable
private fun SummaryCard(
    title: String,
    value: String,
    subtitle: String,
    modifier: Modifier = Modifier
) {
    Card(
        modifier = modifier,
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Text(
                text = title,
                style = MaterialTheme.typography.bodyMedium,
                color = MaterialTheme.colorScheme.onSurfaceVariant
            )
            Spacer(modifier = Modifier.height(4.dp))
            Text(
                text = value,
                style = MaterialTheme.typography.headlineMedium,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.onSurface
            )
            Spacer(modifier = Modifier.height(2.dp))
            Text(
                text = subtitle,
                style = MaterialTheme.typography.bodySmall,
                color = MaterialTheme.colorScheme.onSurfaceVariant
            )
        }
    }
}

private fun calculateTotalIncome(propertyShares: List<com.yet.domain.model.PropertyShare>): String {
    // Mock calculation: 12500 per share
    val totalIncome = propertyShares.size * 12500.0
    return formatCurrencyRubles(totalIncome)
}

private fun formatCompactNumber(value: Double): String {
    return when {
        value >= 1_000_000_000 -> {
            val billions = value / 1_000_000_000
            "${formatTwoDecimalCommon(billions)}B"
        }
        value >= 1_000_000 -> {
            val millions = value / 1_000_000
            "${formatTwoDecimalCommon(millions)}M"
        }
        value >= 1_000 -> {
            val thousands = value / 1_000
            "${formatTwoDecimalCommon(thousands)}K"
        }
        else -> {
            value.toLong().toString()
        }
    }
}



================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/ui/screens/PropertyDetailsBottomSheet.kt
================================================
package com.yet.home.ui.screens

import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.Close
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Icon
import androidx.compose.material3.IconButton
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.ModalBottomSheet
import androidx.compose.material3.SheetValue
import androidx.compose.material3.Surface
import androidx.compose.material3.rememberModalBottomSheetState
import androidx.compose.runtime.Composable
import androidx.compose.runtime.LaunchedEffect
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.rememberCoroutineScope
import androidx.compose.runtime.setValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.unit.dp
import androidx.navigation.NavController
import com.yet.home.ui.navigation.NavDestination
import kotlinx.coroutines.delay
import kotlinx.coroutines.launch

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun PropertyDetailsBottomSheet(
    listingId: String,
    navController: NavController,
    onClose: () -> Unit
) {
    val sheetState = rememberModalBottomSheetState(
        skipPartiallyExpanded = true,
    )
    val coroutineScope = rememberCoroutineScope()

    // Track previous value to detect transition from Expanded to Hidden
    var previousValue by remember { mutableStateOf<SheetValue?>(null) }
    var isNavigatingToInvest by remember { mutableStateOf(false) }
    var investListingId by remember { mutableStateOf<String?>(null) }

    // Handle sheet dismissal - only call onClose when sheet transitions from Expanded to Hidden
    LaunchedEffect(sheetState.currentValue) {
        if (previousValue == SheetValue.Expanded && sheetState.currentValue == SheetValue.Hidden) {
            // Small delay to ensure the sheet animation completes
            delay(200)
            if (isNavigatingToInvest && investListingId != null) {
                // Navigate to invest screen after sheet is closed
                navController.navigate(NavDestination.Invest(listingId = investListingId!!))
                investListingId = null
                isNavigatingToInvest = false
            } else if (!isNavigatingToInvest) {
                onClose()
            }
        }
        previousValue = sheetState.currentValue
    }

    ModalBottomSheet(
        onDismissRequest = {
            coroutineScope.launch {
                sheetState.hide()
            }
        },
        sheetState = sheetState,
        containerColor = Color.Transparent,
        dragHandle = {
            // Custom drag handle with close button
            Box(
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(vertical = 12.dp),
                contentAlignment = Alignment.Center
            ) {
                Surface(
                    modifier = Modifier
                        .width(40.dp)
                        .height(4.dp),
                    shape = RoundedCornerShape(2.dp),
                    color = Color.White.copy(alpha = 0.3f)
                ) {}
                // Close button
                Row(
                    modifier = Modifier
                        .fillMaxWidth()
                        .padding(horizontal = 16.dp),
                    horizontalArrangement = Arrangement.End
                ) {
                    IconButton(
                        onClick = {
                            coroutineScope.launch {
                                sheetState.hide()
                            }
                        }
                    ) {
                        Icon(
                            imageVector = Icons.Default.Close,
                            contentDescription = "Закрыть",
                            tint = MaterialTheme.colorScheme.onSurface
                        )
                    }
                }
            }
        }
    ) {
        PropertyDetailsScreen(
            listingId = listingId,
            sheetState = sheetState,
            onClose = {
                coroutineScope.launch {
                    sheetState.hide()
                }
            },
            onInvest = {
                // Set flag and store listingId for navigation after sheet closes
                isNavigatingToInvest = true
                investListingId = listingId
                // Hide the sheet - navigation will happen in LaunchedEffect after sheet closes
                coroutineScope.launch {
                    sheetState.hide()
                }
            },
            onFullPurchase = {
                coroutineScope.launch {
                    sheetState.hide()
                }
            }
        )
    }
}




================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/ui/screens/PropertyDetailsScreen.kt
================================================
package com.yet.home.ui.screens

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.PaddingValues
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.pager.HorizontalPager
import androidx.compose.foundation.pager.rememberPagerState
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.ArrowBack
import androidx.compose.material.icons.filled.ArrowForward
import androidx.compose.material.icons.filled.Home
import androidx.compose.material.icons.filled.LocationOn
import androidx.compose.material.icons.filled.People
import androidx.compose.material.icons.filled.TrendingUp
import androidx.compose.material3.Button
import androidx.compose.material3.ButtonDefaults
import androidx.compose.material3.Card
import androidx.compose.material3.CardDefaults
import androidx.compose.material3.CircularProgressIndicator
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Icon
import androidx.compose.material3.IconButton
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.OutlinedButton
import androidx.compose.material3.SheetState
import androidx.compose.material3.Surface
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.runtime.LaunchedEffect
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.runtime.rememberCoroutineScope
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.layout.ContentScale
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import coil3.compose.AsyncImage
import com.yet.home.ui.component.theme.dashboardBackground
import com.yet.home.utils.formatCurrencyRubles
import com.yet.home.viewmodel.PropertyDetailsViewModel
import homepasss.composeapp.generated.resources.Res
import homepasss.composeapp.generated.resources.details_area
import homepasss.composeapp.generated.resources.details_available
import homepasss.composeapp.generated.resources.details_bedrooms
import homepasss.composeapp.generated.resources.details_current_investors
import homepasss.composeapp.generated.resources.details_description
import homepasss.composeapp.generated.resources.details_from
import homepasss.composeapp.generated.resources.details_full_purchase
import homepasss.composeapp.generated.resources.details_invest
import homepasss.composeapp.generated.resources.details_investment_info
import homepasss.composeapp.generated.resources.details_min_share
import homepasss.composeapp.generated.resources.details_projected_income
import homepasss.composeapp.generated.resources.details_yield
import kotlinx.coroutines.launch
import org.jetbrains.compose.resources.stringResource
import org.koin.compose.viewmodel.koinViewModel

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun PropertyDetailsScreen(
    listingId: String,
    sheetState: SheetState,
    modifier: Modifier = Modifier,
    viewModel: PropertyDetailsViewModel = koinViewModel(),
    onClose: () -> Unit,
    onInvest: () -> Unit = {},
    onFullPurchase: () -> Unit = {}
) {
    val house by viewModel.house.collectAsState()
    val isLoading by viewModel.isLoading.collectAsState()
    val currentImageIndex by viewModel.currentImageIndex.collectAsState()
    val coroutineScope = rememberCoroutineScope()

    // Load property details on first composition
    LaunchedEffect(listingId) {
        viewModel.loadPropertyDetails(listingId)
    }

    // Content only - ModalBottomSheet is handled by PropertyDetailsBottomSheet
    BottomSheetContent(
            house = house,
            isLoading = isLoading,
            currentImageIndex = currentImageIndex,
            viewModel = viewModel,
            onClose = {
                coroutineScope.launch {
                    sheetState.hide()
                }
            },
            onInvest = {
                onInvest()
                coroutineScope.launch {
                    sheetState.hide()
                }
            },
            onFullPurchase = {
                onFullPurchase()
                coroutineScope.launch {
                    sheetState.hide()
                }
            }
        )
    }

@Composable
private fun BottomSheetContent(
    house: com.yet.domain.model.House?,
    isLoading: Boolean,
    currentImageIndex: Int,
    viewModel: PropertyDetailsViewModel,
    onClose: () -> Unit,
    onInvest: () -> Unit,
    onFullPurchase: () -> Unit
) {
    Box(
        modifier = Modifier
            .fillMaxSize()
            .background(dashboardBackground)
    ) {
        if (isLoading) {
            Column(
                modifier = Modifier.fillMaxSize(),
                horizontalAlignment = Alignment.CenterHorizontally,
                verticalArrangement = Arrangement.Center
            ) {
                CircularProgressIndicator()
            }
        } else {
            LazyColumn(
                modifier = Modifier.fillMaxSize(),
                contentPadding = PaddingValues(bottom = 100.dp),
                verticalArrangement = Arrangement.spacedBy(16.dp)
            ) {
                // Image Gallery
                item {
                    ImageGallery(
                        images = house?.images ?: emptyList(),
                        currentIndex = currentImageIndex,
                        onPreviousClick = { viewModel.previousImage() },
                        onNextClick = { viewModel.nextImage() },
                        onIndexChange = { viewModel.setCurrentImageIndex(it) }
                    )
                }

                // Property Title and Location
                item {
                    Column(
                        modifier = Modifier
                            .fillMaxWidth()
                            .padding(horizontal = 16.dp)
                    ) {
                        Text(
                            text = house?.name ?: house?.description ?: "",
                            style = MaterialTheme.typography.headlineMedium,
                            fontWeight = FontWeight.Bold,
                            color = MaterialTheme.colorScheme.onSurface
                        )
                        Spacer(modifier = Modifier.height(8.dp))
                        Row(
                            verticalAlignment = Alignment.CenterVertically
                        ) {
                            Icon(
                                imageVector = Icons.Default.LocationOn,
                                contentDescription = null,
                                modifier = Modifier.size(16.dp),
                                tint = MaterialTheme.colorScheme.onSurfaceVariant
                            )
                            Spacer(modifier = Modifier.width(4.dp))
                            Text(
                                text = house?.address ?: "",
                                style = MaterialTheme.typography.bodyMedium,
                                color = MaterialTheme.colorScheme.onSurfaceVariant
                            )
                        }
                    }
                }

                // Property Characteristics Cards
                item {
                    Row(
                        modifier = Modifier
                            .fillMaxWidth()
                            .padding(horizontal = 16.dp),
                        horizontalArrangement = Arrangement.spacedBy(12.dp),
                    ) {
                        CharacteristicCard(
                            icon = Icons.Default.Home,
                            label = stringResource(Res.string.details_bedrooms),
                            value = viewModel.bedrooms.toString(),
                            modifier = Modifier.weight(1f)
                        )
                        CharacteristicCard(
                            icon = Icons.Default.Home,
                            label = stringResource(Res.string.details_area),
                            value = "${viewModel.area.toInt()} м²",
                            modifier = Modifier.weight(1f)
                        )
                        CharacteristicCard(
                            icon = Icons.Default.TrendingUp,
                            label = stringResource(Res.string.details_yield),
                            value = "${viewModel.yield}%",
                            modifier = Modifier.weight(1f)
                        )
                    }
                }

                // Investment Information Card
                item {
                    InvestmentInfoCard(
                        minShare = viewModel.minShare,
                        currentInvestors = viewModel.currentInvestors,
                        availablePercent = viewModel.availablePercent,
                        projectedIncome = viewModel.projectedIncomePerYear,
                        modifier = Modifier.padding(horizontal = 16.dp)
                    )
                }

                // Description Card
                item {
                    DescriptionCard(
                        description = house?.description ?: house?.name ?: "",
                        modifier = Modifier.padding(horizontal = 16.dp)
                    )
                }

                // Action Buttons
                item {
                    Row(
                        modifier = Modifier
                            .fillMaxWidth()
                            .padding(horizontal = 16.dp, vertical = 16.dp),
                        horizontalArrangement = Arrangement.spacedBy(12.dp)
                    ) {
                        OutlinedButton(
                            onClick = onFullPurchase,
                            modifier = Modifier.weight(1f),
                            colors = ButtonDefaults.outlinedButtonColors(
                                contentColor = MaterialTheme.colorScheme.onSurface
                            )
                        ) {
                            Text(stringResource(Res.string.details_full_purchase))
                        }
                        Button(
                            onClick = onInvest,
                            modifier = Modifier.weight(1f),
                            colors = ButtonDefaults.buttonColors(
                                containerColor = MaterialTheme.colorScheme.primary
                            )
                        ) {
                            Text(stringResource(Res.string.details_invest))
                        }
                    }
                }
            }
        }
    }
}


@Composable
private fun ImageGallery(
    images: List<String>,
    currentIndex: Int,
    onPreviousClick: () -> Unit,
    onNextClick: () -> Unit,
    onIndexChange: (Int) -> Unit
) {
    if (images.isEmpty()) {
        Box(
            modifier = Modifier
                .fillMaxWidth()
                .height(300.dp)
                .background(Color.White.copy(alpha = 0.1f)),
            contentAlignment = Alignment.Center
        ) {
            Text(
                text = "Нет изображений",
                color = MaterialTheme.colorScheme.onSurfaceVariant
            )
        }
        return
    }

    val pagerState = rememberPagerState(pageCount = { images.size }, initialPage = currentIndex)
    val coroutineScope = rememberCoroutineScope()

    LaunchedEffect(currentIndex) {
        if (pagerState.currentPage != currentIndex) {
            pagerState.animateScrollToPage(currentIndex)
        }
    }

    Box(
        modifier = Modifier
            .fillMaxWidth()
            .height(300.dp)
    ) {
        HorizontalPager(
            state = pagerState,
            modifier = Modifier.fillMaxSize()
        ) { page ->
            Box(
                modifier = Modifier.fillMaxSize()
            ) {
                AsyncImage(
                    model = images[page],
                    contentDescription = null,
                    modifier = Modifier.fillMaxSize(),
                    contentScale = ContentScale.Crop,
                    onError = {}
                )
            }
        }

        // Navigation buttons
        if (images.size > 1) {
            // Previous button
            IconButton(
                onClick = {
                    coroutineScope.launch {
                        val prevPage = if (pagerState.currentPage == 0) {
                            images.size - 1
                        } else {
                            pagerState.currentPage - 1
                        }
                        pagerState.animateScrollToPage(prevPage)
                        onIndexChange(prevPage)
                    }
                },
                modifier = Modifier
                    .align(Alignment.CenterStart)
                    .padding(8.dp)
            ) {
                Surface(
                    shape = CircleShape,
                    color = Color.White.copy(alpha = 0.3f)
                ) {
                    Icon(
                        imageVector = Icons.Default.ArrowBack,
                        contentDescription = "Предыдущее",
                        modifier = Modifier.padding(8.dp),
                        tint = Color.White
                    )
                }
            }

            // Next button
            IconButton(
                onClick = {
                    coroutineScope.launch {
                        val nextPage = (pagerState.currentPage + 1) % images.size
                        pagerState.animateScrollToPage(nextPage)
                        onIndexChange(nextPage)
                    }
                },
                modifier = Modifier
                    .align(Alignment.CenterEnd)
                    .padding(8.dp)
            ) {
                Surface(
                    shape = CircleShape,
                    color = Color.White.copy(alpha = 0.3f)
                ) {
                    Icon(
                        imageVector = Icons.Default.ArrowForward,
                        contentDescription = "Следующее",
                        modifier = Modifier.padding(8.dp),
                        tint = Color.White
                    )
                }
            }

            // Page indicators
            Row(
                modifier = Modifier
                    .align(Alignment.BottomCenter)
                    .padding(bottom = 16.dp),
                horizontalArrangement = Arrangement.spacedBy(4.dp)
            ) {
                images.forEachIndexed { index, _ ->
                    Box(
                        modifier = Modifier
                            .size(if (index == pagerState.currentPage) 8.dp else 6.dp)
                            .clip(CircleShape)
                            .background(
                                if (index == pagerState.currentPage) {
                                    Color.White
                                } else {
                                    Color.White.copy(alpha = 0.5f)
                                }
                            )
                    )
                }
            }
        }
    }
}

@Composable
private fun CharacteristicCard(
    icon: androidx.compose.ui.graphics.vector.ImageVector,
    label: String,
    value: String,
    modifier: Modifier = Modifier
) {
    Card(
        modifier = modifier,
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.fillMaxWidth().padding(16.dp),
            horizontalAlignment = Alignment.CenterHorizontally,
            verticalArrangement = Arrangement.Center
        ) {
            Icon(
                imageVector = icon,
                contentDescription = null,
                modifier = Modifier.size(24.dp),
                tint = MaterialTheme.colorScheme.primary
            )
            Spacer(modifier = Modifier.height(8.dp))
            Text(
                text = label,
                style = MaterialTheme.typography.bodySmall,
                color = MaterialTheme.colorScheme.onSurfaceVariant
            )
            Spacer(modifier = Modifier.height(4.dp))
            Text(
                text = value,
                style = MaterialTheme.typography.titleMedium,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.onSurface
            )
        }
    }
}

@Composable
private fun InvestmentInfoCard(
    minShare: Double,
    currentInvestors: Int,
    availablePercent: Int,
    projectedIncome: Double,
    modifier: Modifier = Modifier
) {
    Card(
        modifier = modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween,
                verticalAlignment = Alignment.CenterVertically
            ) {
                Text(
                    text = stringResource(Res.string.details_investment_info),
                    style = MaterialTheme.typography.titleLarge,
                    fontWeight = FontWeight.Bold,
                    color = MaterialTheme.colorScheme.onSurface
                )
                Icon(
                    imageVector = Icons.Default.People,
                    contentDescription = null,
                    modifier = Modifier.size(24.dp),
                    tint = MaterialTheme.colorScheme.onSurfaceVariant
                )
            }

            Spacer(modifier = Modifier.height(16.dp))

            InvestmentInfoRow(
                label = stringResource(Res.string.details_min_share),
                value = "${stringResource(Res.string.details_from)} ${formatCurrencyRubles(minShare)}"
            )
            Spacer(modifier = Modifier.height(12.dp))
            InvestmentInfoRow(
                label = stringResource(Res.string.details_current_investors),
                value = currentInvestors.toString()
            )
            Spacer(modifier = Modifier.height(12.dp))
            InvestmentInfoRow(
                label = stringResource(Res.string.details_available),
                value = "$availablePercent%",
                valueColor = MaterialTheme.colorScheme.tertiary
            )
            Spacer(modifier = Modifier.height(12.dp))
            InvestmentInfoRow(
                label = stringResource(Res.string.details_projected_income),
                value = formatCurrencyRubles(projectedIncome)
            )
        }
    }
}

@Composable
private fun InvestmentInfoRow(
    label: String,
    value: String,
    valueColor: Color = MaterialTheme.colorScheme.onSurface
) {
    Row(
        modifier = Modifier.fillMaxWidth(),
        horizontalArrangement = Arrangement.SpaceBetween,
        verticalAlignment = Alignment.CenterVertically
    ) {
        Text(
            text = label,
            style = MaterialTheme.typography.bodyMedium,
            color = MaterialTheme.colorScheme.onSurfaceVariant
        )
        Text(
            text = value,
            style = MaterialTheme.typography.bodyLarge,
            fontWeight = FontWeight.Bold,
            color = valueColor
        )
    }
}

@Composable
private fun DescriptionCard(
    description: String,
    modifier: Modifier = Modifier
) {
    Card(
        modifier = modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(
            containerColor = Color.White.copy(alpha = 0.12f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Text(
                text = stringResource(Res.string.details_description),
                style = MaterialTheme.typography.titleLarge,
                fontWeight = FontWeight.Bold,
                color = MaterialTheme.colorScheme.onSurface
            )
            Spacer(modifier = Modifier.height(12.dp))
            Text(
                text = description,
                style = MaterialTheme.typography.bodyMedium,
                color = MaterialTheme.colorScheme.onSurfaceVariant,
                lineHeight = MaterialTheme.typography.bodyMedium.lineHeight * 1.5
            )
        }
    }
}




================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/ui/screens/SearchScreen.kt
================================================
package com.yet.home.ui.screens

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.FlowRow
import androidx.compose.foundation.layout.PaddingValues
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.items
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.ArrowDownward
import androidx.compose.material.icons.filled.Close
import androidx.compose.material.icons.filled.Search
import androidx.compose.material3.CircularProgressIndicator
import androidx.compose.material3.DropdownMenu
import androidx.compose.material3.DropdownMenuItem
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Icon
import androidx.compose.material3.IconButton
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.Scaffold
import androidx.compose.material3.Surface
import androidx.compose.material3.Text
import androidx.compose.material3.TextButton
import androidx.compose.material3.TextField
import androidx.compose.material3.TextFieldDefaults
import androidx.compose.material3.TopAppBar
import androidx.compose.material3.TopAppBarDefaults
import androidx.compose.runtime.Composable
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.setValue
import androidx.navigation.NavController
import androidx.compose.ui.Alignment
import com.yet.home.ui.navigation.NavDestination
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.unit.dp
import com.yet.domain.model.ListingType
import com.yet.home.ui.component.theme.dashboardBackground
import com.yet.home.ui.screens.PropertyCard
import com.yet.home.viewmodel.SearchViewModel
import com.yet.home.viewmodel.SortOption
import homepasss.composeapp.generated.resources.Res
import homepasss.composeapp.generated.resources.search_filter_all
import homepasss.composeapp.generated.resources.search_filter_fractional
import homepasss.composeapp.generated.resources.search_filter_whole
import homepasss.composeapp.generated.resources.search_found_objects
import homepasss.composeapp.generated.resources.search_hint
import homepasss.composeapp.generated.resources.search_no_results
import homepasss.composeapp.generated.resources.search_sort_by_newest
import homepasss.composeapp.generated.resources.search_sort_by_popularity
import homepasss.composeapp.generated.resources.search_sort_by_price_high
import homepasss.composeapp.generated.resources.search_sort_by_price_low
import homepasss.composeapp.generated.resources.search_try_again
import org.jetbrains.compose.resources.stringResource
import org.koin.compose.viewmodel.koinViewModel

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun SearchScreen(
    navController: NavController,
    modifier: Modifier = Modifier,
    viewModel: SearchViewModel = koinViewModel()
) {
    val searchQuery by viewModel.searchQuery.collectAsState()
    val searchResults by viewModel.searchResults.collectAsState()
    val isSearching by viewModel.isSearching.collectAsState()
    val selectedListingType by viewModel.selectedListingType.collectAsState()
    val sortOption by viewModel.sortOption.collectAsState()

    Scaffold(
        modifier = modifier.fillMaxSize(),
        containerColor = Color.Transparent,
        topBar = {
            TopAppBar(
                title = {
                    SearchBar(
                        query = searchQuery,
                        onQueryChange = { viewModel.updateSearchQuery(it) },
                        modifier = Modifier
                            .fillMaxWidth()
                            .padding(horizontal = 16.dp, vertical = 8.dp)
                    )
                },
                colors = TopAppBarDefaults.topAppBarColors().copy(
                    containerColor = Color.Transparent
                )
            )
        },
        content = { innerPadding ->
            Box(
                modifier = Modifier
                    .fillMaxSize()
                    .background(dashboardBackground)
            ) {
                Column(
                    modifier = Modifier
                        .fillMaxSize()
                        .padding(top = innerPadding.calculateTopPadding())
                ) {
                // Filters and Sort Row
                FlowRow(
                    modifier = Modifier
                        .fillMaxWidth()
                        .padding(horizontal = 16.dp, vertical = 8.dp),
                    horizontalArrangement = Arrangement.SpaceBetween,
                ) {
                    // Listing Type Filter
                    ListingTypeFilter(
                        selectedType = selectedListingType,
                        onTypeSelected = { viewModel.setListingTypeFilter(it) }
                    )

                    // Sort Dropdown
                    SortDropdown(
                        selectedOption = sortOption,
                        onOptionSelected = { viewModel.setSortOption(it) }
                    )
                }

                if (isSearching) {
                    Column(
                        modifier = Modifier.fillMaxSize(),
                        horizontalAlignment = Alignment.CenterHorizontally,
                        verticalArrangement = Arrangement.Center
                    ) {
                        CircularProgressIndicator()
                        Spacer(modifier = Modifier.height(16.dp))
                        Text(
                            text = "Поиск...",
                            style = MaterialTheme.typography.bodyLarge,
                            color = MaterialTheme.colorScheme.onSurface
                        )
                    }
                } else if (searchResults.isEmpty()) {
                    Column(
                        modifier = Modifier
                            .fillMaxSize()
                            .padding(32.dp),
                        horizontalAlignment = Alignment.CenterHorizontally,
                        verticalArrangement = Arrangement.Center
                    ) {
                        Text(
                            text = stringResource(Res.string.search_no_results),
                            style = MaterialTheme.typography.bodyLarge,
                            color = MaterialTheme.colorScheme.onSurface
                        )
                        Spacer(modifier = Modifier.height(8.dp))
                        Text(
                            text = stringResource(Res.string.search_try_again),
                            style = MaterialTheme.typography.bodyMedium,
                            color = MaterialTheme.colorScheme.onSurfaceVariant
                        )
                    }
                } else {
                    LazyColumn(
                        modifier = Modifier.fillMaxSize(),
                        contentPadding = PaddingValues(horizontal = 16.dp, vertical = 8.dp),
                        verticalArrangement = Arrangement.spacedBy(16.dp)
                    ) {
                        item {
                            Row(
                                modifier = Modifier.fillMaxWidth(),
                                horizontalArrangement = Arrangement.SpaceBetween,
                                verticalAlignment = Alignment.CenterVertically
                            ) {
                                Text(
                                    text = stringResource(
                                        Res.string.search_found_objects,
                                        searchResults.size
                                    ),
                                    style = MaterialTheme.typography.titleMedium,
                                    color = MaterialTheme.colorScheme.onSurface
                                )
                            }
                        }

                        items(searchResults) { house ->
                            PropertyCard(
                                house = house,
                                onClick = {
                                    navController.navigate(NavDestination.PropertyDetails(listingId = house.id.toString()))
                                }
                            )
                        }

                        item {
                            Spacer(modifier = Modifier.height(80.dp)) // Space for bottom navigation
                        }
                    }
                }
            }
            }
        }
    )
}

@Composable
private fun SearchBar(
    query: String,
    onQueryChange: (String) -> Unit,
    modifier: Modifier = Modifier
) {
    Surface(
        modifier = modifier,
        shape = RoundedCornerShape(28.dp),
        color = MaterialTheme.colorScheme.surface.copy(alpha = 0.9f),
        tonalElevation = 3.dp
    ) {
        TextField(
            value = query,
            onValueChange = onQueryChange,
            modifier = Modifier.fillMaxWidth(),
            placeholder = { 
                Text(
                    text = stringResource(Res.string.search_hint),
                    color = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.6f)
                ) 
            },
            leadingIcon = {
                Icon(
                    imageVector = Icons.Default.Search,
                    contentDescription = "Поиск",
                    tint = MaterialTheme.colorScheme.onSurfaceVariant
                )
            },
            trailingIcon = {
                if (query.isNotEmpty()) {
                    IconButton(onClick = { onQueryChange("") }) {
                        Icon(
                            imageVector = Icons.Default.Close,
                            contentDescription = "Очистить",
                            tint = MaterialTheme.colorScheme.onSurfaceVariant
                        )
                    }
                }
            },
            singleLine = true,
            colors = TextFieldDefaults.colors(
                focusedContainerColor = Color.Transparent,
                unfocusedContainerColor = Color.Transparent,
                disabledContainerColor = Color.Transparent,
                focusedIndicatorColor = Color.Transparent,
                unfocusedIndicatorColor = Color.Transparent,
                disabledIndicatorColor = Color.Transparent
            )
        )
    }
}

@Composable
private fun ListingTypeFilter(
    selectedType: ListingType?,
    onTypeSelected: (ListingType?) -> Unit
) {
    Row(
        horizontalArrangement = Arrangement.spacedBy(8.dp)
    ) {
        FilterChip(
            text = stringResource(Res.string.search_filter_all),
            isSelected = selectedType == null,
            onClick = { onTypeSelected(null) }
        )
        FilterChip(
            text = stringResource(Res.string.search_filter_whole),
            isSelected = selectedType == ListingType.WHOLE,
            onClick = { onTypeSelected(ListingType.WHOLE) }
        )
        FilterChip(
            text = stringResource(Res.string.search_filter_fractional),
            isSelected = selectedType == ListingType.FRACTIONAL,
            onClick = { onTypeSelected(ListingType.FRACTIONAL) }
        )
    }
}

@Composable
private fun FilterChip(
    text: String,
    isSelected: Boolean,
    onClick: () -> Unit
) {
    Box(
        modifier = Modifier
            .background(
                color = if (isSelected) MaterialTheme.colorScheme.primaryContainer else MaterialTheme.colorScheme.surfaceVariant,
                shape = RoundedCornerShape(16.dp)
            )
            .clickable(onClick = onClick)
            .padding(horizontal = 12.dp, vertical = 6.dp)
    ) {
        Text(
            text = text,
            style = MaterialTheme.typography.labelMedium,
            color = if (isSelected) MaterialTheme.colorScheme.onPrimaryContainer else MaterialTheme.colorScheme.onSurfaceVariant
        )
    }
}

@Composable
private fun SortDropdown(
    selectedOption: SortOption,
    onOptionSelected: (SortOption) -> Unit
) {
    var expanded by remember { mutableStateOf(false) }

    Box {
        TextButton(
            onClick = { expanded = true }
        ) {
            Text(
                text = when (selectedOption) {
                    SortOption.POPULARITY -> stringResource(Res.string.search_sort_by_popularity)
                    SortOption.PRICE_LOW_TO_HIGH -> stringResource(Res.string.search_sort_by_price_low)
                    SortOption.PRICE_HIGH_TO_LOW -> stringResource(Res.string.search_sort_by_price_high)
                    SortOption.NEWEST -> stringResource(Res.string.search_sort_by_newest)
                },
                style = MaterialTheme.typography.bodyMedium
            )
            Spacer(modifier = Modifier.width(4.dp))
            Icon(
                imageVector = Icons.Default.ArrowDownward,
                contentDescription = null,
                modifier = Modifier.padding(start = 4.dp)
            )
        }

        DropdownMenu(
            expanded = expanded,
            onDismissRequest = { expanded = false }
        ) {
            DropdownMenuItem(
                text = { Text(stringResource(Res.string.search_sort_by_popularity)) },
                onClick = {
                    onOptionSelected(SortOption.POPULARITY)
                    expanded = false
                }
            )
            DropdownMenuItem(
                text = { Text(stringResource(Res.string.search_sort_by_price_low)) },
                onClick = {
                    onOptionSelected(SortOption.PRICE_LOW_TO_HIGH)
                    expanded = false
                }
            )
            DropdownMenuItem(
                text = { Text(stringResource(Res.string.search_sort_by_price_high)) },
                onClick = {
                    onOptionSelected(SortOption.PRICE_HIGH_TO_LOW)
                    expanded = false
                }
            )
            DropdownMenuItem(
                text = { Text(stringResource(Res.string.search_sort_by_newest)) },
                onClick = {
                    onOptionSelected(SortOption.NEWEST)
                    expanded = false
                }
            )
        }
    }
}



================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/utils/formatTwoDecimalCommon.kt
================================================
package com.yet.home.utils

import kotlin.math.roundToLong

fun formatTwoDecimalCommon(value: Double): String {
    // Умножаем на 100, округляем до ближайшего целого, чтобы отсечь лишние знаки
    val rounded = (value * 100).roundToLong()
    
    // Получаем целую часть
    val integerPart = rounded / 100
    
    // Получаем дробную часть
    val fractionalPart = rounded % 100
    
    // Для отрицательных чисел `rounded % 100` тоже будет отрицательным, берем по модулю
    val positiveFractionalPart = kotlin.math.abs(fractionalPart)

    // Форматируем дробную часть, чтобы она всегда имела 2 цифры (например, 5 -> "05")
    val fractionalString = positiveFractionalPart.toString().padStart(2, '0')

    return "$integerPart.$fractionalString"
}

fun formatNumberWithSpaces(value: Long): String {
    return value.toString().reversed().chunked(3).joinToString(" ").reversed()
}

fun formatCurrencyRubles(value: Double): String {
    val rounded = value.roundToLong()
    val formatted = formatNumberWithSpaces(rounded)
    return "$$formatted"
}

fun formatCurrencyRublesCompact(value: Double): String {
    val rounded = value.roundToLong()
    return "$$rounded"
}


================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/viewmodel/AuthViewModel.kt
================================================
package com.yet.home.viewmodel

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.yet.domain.model.User
import com.yet.domain.repository.AuthRepository
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch
import org.koin.android.annotation.KoinViewModel
import org.koin.core.component.KoinComponent
import org.koin.core.component.inject

@KoinViewModel
class AuthViewModel : ViewModel(), KoinComponent {

    private val authRepository: AuthRepository by inject()

    private val _authState = MutableStateFlow<AuthState>(AuthState.Idle)
    val authState: StateFlow<AuthState> = _authState.asStateFlow()

    private val _currentUser = MutableStateFlow<User?>(null)
    val currentUser: StateFlow<User?> = _currentUser.asStateFlow()

    init {
        checkCurrentUser()
    }

    fun login(email: String, password: String) {
        viewModelScope.launch {
            _authState.value = AuthState.Loading
            val result = authRepository.login(email, password)
            result.fold(
                onSuccess = { user ->
                    _currentUser.value = user
                    _authState.value = AuthState.Success
                },
                onFailure = { error ->
                    _authState.value = AuthState.Error(error.message ?: "Login failed")
                }
            )
        }
    }

    fun register(name: String, email: String, password: String) {
        viewModelScope.launch {
            _authState.value = AuthState.Loading
            val result = authRepository.register(name, email, password)
            result.fold(
                onSuccess = { user ->
                    _currentUser.value = user
                    _authState.value = AuthState.Success
                },
                onFailure = { error ->
                    _authState.value = AuthState.Error(error.message ?: "Registration failed")
                }
            )
        }
    }

    fun logout() {
        _currentUser.value = null
        _authState.value = AuthState.Idle
    }

    private fun checkCurrentUser() {
        viewModelScope.launch {
            val result = authRepository.getCurrentUser()
            result.fold(
                onSuccess = { user ->
                    _currentUser.value = user
                },
                onFailure = {
                    _currentUser.value = null
                }
            )
        }
    }

    fun resetState() {
        _authState.value = AuthState.Idle
    }
}

sealed class AuthState {
    object Idle : AuthState()
    object Loading : AuthState()
    object Success : AuthState()
    data class Error(val message: String) : AuthState()
}



================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/viewmodel/ConstructionCompanyDetailsViewModel.kt
================================================
package com.yet.home.viewmodel

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.yet.domain.model.ConstructionCompany
import com.yet.domain.repository.ConstructionCompanyRepository
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch
import org.koin.android.annotation.KoinViewModel
import org.koin.core.component.KoinComponent
import org.koin.core.component.inject

@KoinViewModel
class ConstructionCompanyDetailsViewModel : ViewModel(), KoinComponent {

    private val constructionCompanyRepository: ConstructionCompanyRepository by inject()

    private val _company = MutableStateFlow<ConstructionCompany?>(null)
    val company: StateFlow<ConstructionCompany?> = _company.asStateFlow()

    private val _isLoading = MutableStateFlow(false)
    val isLoading: StateFlow<Boolean> = _isLoading.asStateFlow()

    private val _error = MutableStateFlow<String?>(null)
    val error: StateFlow<String?> = _error.asStateFlow()

    fun loadCompanyDetails(companyId: String) {
        viewModelScope.launch {
            _isLoading.value = true
            _error.value = null
            try {
                val result = constructionCompanyRepository.getCompanyById(companyId)
                result.fold(
                    onSuccess = { company ->
                        _company.value = company
                    },
                    onFailure = { exception ->
                        _error.value = exception.message ?: "Failed to load company"
                        _company.value = null
                    }
                )
            } catch (e: Exception) {
                _error.value = e.message ?: "Unknown error"
                _company.value = null
            } finally {
                _isLoading.value = false
            }
        }
    }
}




================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/viewmodel/HomeViewModel.kt
================================================
package com.yet.home.viewmodel

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.yet.domain.model.House
import com.yet.domain.model.User
import com.yet.domain.repository.AuthRepository
import com.yet.domain.repository.HouseRepository
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch
import org.koin.android.annotation.KoinViewModel
import org.koin.core.component.KoinComponent
import org.koin.core.component.inject

data class PortfolioData(
    val totalValue: Double,
    val changeAmount: Double,
    val changePercentage: Double
)

@KoinViewModel
class HomeViewModel : ViewModel(), KoinComponent {

    private val houseRepository: HouseRepository by inject()
    private val authRepository: AuthRepository by inject()

    private val _houses = MutableStateFlow<List<House>>(emptyList())
    val houses: StateFlow<List<House>> = _houses.asStateFlow()

    private val _currentUser = MutableStateFlow<User?>(null)
    val currentUser: StateFlow<User?> = _currentUser.asStateFlow()

    private val _portfolioData = MutableStateFlow<PortfolioData?>(null)
    val portfolioData: StateFlow<PortfolioData?> = _portfolioData.asStateFlow()

    private val _isLoading = MutableStateFlow(false)
    val isLoading: StateFlow<Boolean> = _isLoading.asStateFlow()

    init {
        loadData()
    }

    private fun loadData() {
        viewModelScope.launch {
            _isLoading.value = true
            try {
                loadCurrentUser()
                loadPortfolio()
                loadHouses()
            } finally {
                _isLoading.value = false
            }
        }
    }

    private suspend fun loadCurrentUser() {
        val result = authRepository.getCurrentUser()
        result.fold(
            onSuccess = { user ->
                _currentUser.value = user
            },
            onFailure = {
                _currentUser.value = null
            }
        )
    }

    private suspend fun loadPortfolio() {
        // TODO: Get current user ID from auth repository
        val userId = "1" // Mock user ID for now
        
        val userHousesResult = houseRepository.getUserHouses(userId)

        var totalValue = 0.0

        userHousesResult.fold(
            onSuccess = { houses ->
                // Вычисляем общую стоимость портфеля на основе стоимости домов
                totalValue = houses.sumOf { it.cost ?: 0.0 }
            },
            onFailure = {}
        )

        // Mock change data - в реальном приложении это должно приходить из API
        val changeAmount = 145230.0
        val changePercentage = 1.75
        
        // Если totalValue равен 0, используем mock данные для демонстрации
        val displayValue = if (totalValue > 0) totalValue else 8450000.0
        
        _portfolioData.value = PortfolioData(
            totalValue = displayValue,
            changeAmount = changeAmount,
            changePercentage = changePercentage
        )
    }

    private suspend fun loadHouses() {
        val result = houseRepository.getHouses(10)
        result.fold(
            onSuccess = { houses ->
                _houses.value = houses
            },
            onFailure = { error ->
                // Handle error - логируем для отладки
                error.printStackTrace()
                _houses.value = emptyList()
            }
        )
    }
}



================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/viewmodel/InvestmentsViewModel.kt
================================================
package com.yet.home.viewmodel

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.yet.domain.model.ConstructionCompany
import com.yet.domain.repository.ConstructionCompanyRepository
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch
import org.koin.android.annotation.KoinViewModel
import org.koin.core.component.KoinComponent
import org.koin.core.component.inject

@KoinViewModel
class InvestmentsViewModel : ViewModel(), KoinComponent {

    private val constructionCompanyRepository: ConstructionCompanyRepository by inject()

    private val _companies = MutableStateFlow<List<ConstructionCompany>>(emptyList())
    val companies: StateFlow<List<ConstructionCompany>> = _companies.asStateFlow()

    private val _isLoading = MutableStateFlow(false)
    val isLoading: StateFlow<Boolean> = _isLoading.asStateFlow()

    private val _error = MutableStateFlow<String?>(null)
    val error: StateFlow<String?> = _error.asStateFlow()

    init {
        loadCompanies()
    }

    fun loadCompanies() {
        viewModelScope.launch {
            _isLoading.value = true
            _error.value = null
            try {
                val result = constructionCompanyRepository.getAllCompanies()
                result.fold(
                    onSuccess = { companies ->
                        _companies.value = companies
                    },
                    onFailure = { exception ->
                        _error.value = exception.message ?: "Failed to load companies"
                        _companies.value = emptyList()
                    }
                )
            } catch (e: Exception) {
                _error.value = e.message ?: "Unknown error"
                _companies.value = emptyList()
            } finally {
                _isLoading.value = false
            }
        }
    }

    fun searchCompanies(query: String) {
        viewModelScope.launch {
            _isLoading.value = true
            _error.value = null
            try {
                val result = if (query.isBlank()) {
                    constructionCompanyRepository.getAllCompanies()
                } else {
                    constructionCompanyRepository.searchCompanies(query)
                }
                result.fold(
                    onSuccess = { companies ->
                        _companies.value = companies
                    },
                    onFailure = { exception ->
                        _error.value = exception.message ?: "Failed to search companies"
                        _companies.value = emptyList()
                    }
                )
            } catch (e: Exception) {
                _error.value = e.message ?: "Unknown error"
                _companies.value = emptyList()
            } finally {
                _isLoading.value = false
            }
        }
    }
}




================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/viewmodel/MainViewModel.kt
================================================
package com.yet.home.viewmodel

import androidx.lifecycle.ViewModel
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import org.koin.android.annotation.KoinViewModel

@KoinViewModel
class MainViewModel : ViewModel() {

    private val _selectedTab = MutableStateFlow(BottomNavTab.HOME)
    val selectedTab: StateFlow<BottomNavTab> = _selectedTab.asStateFlow()

    fun selectTab(tab: BottomNavTab) {
        _selectedTab.value = tab
    }
}

enum class BottomNavTab {
    HOME, SEARCH, INVESTMENTS, PROFILE
}



================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/viewmodel/PortfolioViewModel.kt
================================================
package com.yet.home.viewmodel

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.yet.domain.model.Investment
import com.yet.domain.model.PropertyShare
import com.yet.domain.repository.HomeRepository
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch
import org.koin.android.annotation.KoinViewModel
import org.koin.core.component.KoinComponent
import org.koin.core.component.inject

@KoinViewModel
class PortfolioViewModel: ViewModel(), KoinComponent {

    private val homeRepository: HomeRepository by inject()

    private val _investments = MutableStateFlow<List<Investment>>(emptyList())
    val investments: StateFlow<List<Investment>> = _investments.asStateFlow()

    private val _propertyShares = MutableStateFlow<List<PropertyShare>>(emptyList())
    val propertyShares: StateFlow<List<PropertyShare>> = _propertyShares.asStateFlow()

    private val _totalValue = MutableStateFlow(0.0)
    val totalValue: StateFlow<Double> = _totalValue.asStateFlow()

    private val _isLoading = MutableStateFlow(false)
    val isLoading: StateFlow<Boolean> = _isLoading.asStateFlow()

    init {
        loadPortfolio()
    }

    private fun loadPortfolio() {
        viewModelScope.launch {
            _isLoading.value = true
            try {
                // TODO: Get current user ID from auth repository
                val userId = "user1" // Mock user ID for now

                val investmentsResult = homeRepository.getUserInvestments(userId)
                val sharesResult = homeRepository.getUserPropertyShares(userId)

                var totalValue = 0.0

                investmentsResult.fold(
                    onSuccess = { investments ->
                        _investments.value = investments
                        totalValue += investments.sumOf { it.amount }
                    },
                    onFailure = {
                        _investments.value = emptyList()
                    }
                )

                sharesResult.fold(
                    onSuccess = { shares ->
                        _propertyShares.value = shares
                        totalValue += shares.sumOf { it.currentValue }
                    },
                    onFailure = {
                        _propertyShares.value = emptyList()
                    }
                )

                _totalValue.value = totalValue
            } catch (e: Exception) {
                // Handle error
                _investments.value = emptyList()
                _propertyShares.value = emptyList()
                _totalValue.value = 0.0
            } finally {
                _isLoading.value = false
            }
        }
    }
}



================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/viewmodel/ProfileViewModel.kt
================================================
package com.yet.home.viewmodel

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.yet.domain.model.Investment
import com.yet.domain.model.PropertyShare
import com.yet.domain.model.User
import com.yet.domain.repository.AuthRepository
import com.yet.domain.repository.HomeRepository
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch
import org.koin.android.annotation.KoinViewModel
import org.koin.core.component.KoinComponent
import org.koin.core.component.inject

@KoinViewModel
class ProfileViewModel : ViewModel(), KoinComponent {

    private val authRepository: AuthRepository by inject()
    private val homeRepository: HomeRepository by inject()

    private val _currentUser = MutableStateFlow<User?>(null)
    val currentUser: StateFlow<User?> = _currentUser.asStateFlow()

    private val _investments = MutableStateFlow<List<Investment>>(emptyList())
    val investments: StateFlow<List<Investment>> = _investments.asStateFlow()

    private val _propertyShares = MutableStateFlow<List<PropertyShare>>(emptyList())
    val propertyShares: StateFlow<List<PropertyShare>> = _propertyShares.asStateFlow()

    private val _totalValue = MutableStateFlow(0.0)
    val totalValue: StateFlow<Double> = _totalValue.asStateFlow()

    private val _isLoading = MutableStateFlow(false)
    val isLoading: StateFlow<Boolean> = _isLoading.asStateFlow()

    init {
        loadCurrentUser()
        loadPortfolio()
    }

    private fun loadCurrentUser() {
        viewModelScope.launch {
            _isLoading.value = true
            val result = authRepository.getCurrentUser()
            result.fold(
                onSuccess = { user ->
                    _currentUser.value = user
                },
                onFailure = {
                    _currentUser.value = null
                }
            )
            _isLoading.value = false
        }
    }

    private fun loadPortfolio() {
        viewModelScope.launch {
            _isLoading.value = true
            try {
                // TODO: Get current user ID from auth repository
                val userId = "user1" // Mock user ID for now

                val investmentsResult = homeRepository.getUserInvestments(userId)
                val sharesResult = homeRepository.getUserPropertyShares(userId)

                var totalValue = 0.0

                investmentsResult.fold(
                    onSuccess = { investments ->
                        _investments.value = investments
                        totalValue += investments.sumOf { it.amount }
                    },
                    onFailure = {
                        _investments.value = emptyList()
                    }
                )

                sharesResult.fold(
                    onSuccess = { shares ->
                        _propertyShares.value = shares
                        totalValue += shares.sumOf { it.currentValue }
                    },
                    onFailure = {
                        _propertyShares.value = emptyList()
                    }
                )

                _totalValue.value = totalValue
            } catch (e: Exception) {
                // Handle error
                _investments.value = emptyList()
                _propertyShares.value = emptyList()
                _totalValue.value = 0.0
            } finally {
                _isLoading.value = false
            }
        }
    }

    fun refreshProfile() {
        loadCurrentUser()
        loadPortfolio()
    }
}



================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/viewmodel/PropertyDetailsViewModel.kt
================================================
package com.yet.home.viewmodel

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.yet.domain.model.House
import com.yet.domain.repository.HouseRepository
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch
import org.koin.android.annotation.KoinViewModel
import org.koin.core.component.KoinComponent
import org.koin.core.component.inject

@KoinViewModel
class PropertyDetailsViewModel : ViewModel(), KoinComponent {

    private val houseRepository: HouseRepository by inject()

    private val _house = MutableStateFlow<House?>(null)
    val house: StateFlow<House?> = _house.asStateFlow()

    private val _isLoading = MutableStateFlow(false)
    val isLoading: StateFlow<Boolean> = _isLoading.asStateFlow()

    private val _currentImageIndex = MutableStateFlow(0)
    val currentImageIndex: StateFlow<Int> = _currentImageIndex.asStateFlow()

    // Mock investment data
    val minShare = 2500000.0
    val currentInvestors = 247
    val availablePercent = 15
    val projectedIncomePerYear = 312500.0
    val bedrooms = 3
    val area = 145.0
    val yield = 12.5

    fun loadPropertyDetails(houseId: String) {
        viewModelScope.launch {
            _isLoading.value = true
            try {
                val result = houseRepository.getHouseDetails(houseId)
                result.fold(
                    onSuccess = { house ->
                        _house.value = house
                    },
                    onFailure = {
                        _house.value = null
                    }
                )
            } catch (e: Exception) {
                _house.value = null
            } finally {
                _isLoading.value = false
            }
        }
    }

    fun setCurrentImageIndex(index: Int) {
        _currentImageIndex.value = index
    }

    fun nextImage() {
        val house = _house.value
        if (house != null && house.images.isNotEmpty()) {
            val nextIndex = (_currentImageIndex.value + 1) % house.images.size
            _currentImageIndex.value = nextIndex
        }
    }

    fun previousImage() {
        val house = _house.value
        if (house != null && house.images.isNotEmpty()) {
            val prevIndex = if (_currentImageIndex.value == 0) {
                house.images.size - 1
            } else {
                _currentImageIndex.value - 1
            }
            _currentImageIndex.value = prevIndex
        }
    }
}




================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/viewmodel/SearchViewModel.kt
================================================
package com.yet.home.viewmodel

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.yet.domain.model.House
import com.yet.domain.model.ListingType
import com.yet.domain.repository.HouseRepository
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch
import org.koin.android.annotation.KoinViewModel
import org.koin.core.component.KoinComponent
import org.koin.core.component.inject

enum class SortOption {
    POPULARITY, PRICE_LOW_TO_HIGH, PRICE_HIGH_TO_LOW, NEWEST
}

@KoinViewModel
class SearchViewModel : ViewModel(), KoinComponent {

    private val houseRepository: HouseRepository by inject()

    private val _searchQuery = MutableStateFlow("")
    val searchQuery: StateFlow<String> = _searchQuery.asStateFlow()

    private val _searchResults = MutableStateFlow<List<House>>(emptyList())
    val searchResults: StateFlow<List<House>> = _searchResults.asStateFlow()

    private val _allHouses = MutableStateFlow<List<House>>(emptyList())
    val allHouses: StateFlow<List<House>> = _allHouses.asStateFlow()

    private val _isSearching = MutableStateFlow(false)
    val isSearching: StateFlow<Boolean> = _isSearching.asStateFlow()

    // Filters
    private val _selectedListingType = MutableStateFlow<ListingType?>(null)
    val selectedListingType: StateFlow<ListingType?> = _selectedListingType.asStateFlow()

    private val _minPrice = MutableStateFlow<Double?>(null)
    val minPrice: StateFlow<Double?> = _minPrice.asStateFlow()

    private val _maxPrice = MutableStateFlow<Double?>(null)
    val maxPrice: StateFlow<Double?> = _maxPrice.asStateFlow()

    private val _sortOption = MutableStateFlow(SortOption.POPULARITY)
    val sortOption: StateFlow<SortOption> = _sortOption.asStateFlow()

    init {
        loadAllHouses()
    }

    fun updateSearchQuery(query: String) {
        _searchQuery.value = query
        performSearch()
    }

    fun setListingTypeFilter(type: ListingType?) {
        _selectedListingType.value = type
        performSearch()
    }

    fun setPriceRange(min: Double?, max: Double?) {
        _minPrice.value = min
        _maxPrice.value = max
        performSearch()
    }

    fun setSortOption(option: SortOption) {
        _sortOption.value = option
        performSearch()
    }

    private fun loadAllHouses() {
        viewModelScope.launch {
            val result = houseRepository.getHouses()
            result.fold(
                onSuccess = { houses ->
                    _allHouses.value = houses
                    performSearch()
                },
                onFailure = {
                    _allHouses.value = emptyList()
                }
            )
        }
    }

    private fun performSearch() {
        viewModelScope.launch {
            _isSearching.value = true
            try {
                var results = if (_searchQuery.value.isNotBlank()) {
                    // Фильтруем по запросу поиска
                    _allHouses.value.filter { house ->
                        house.name.contains(_searchQuery.value, ignoreCase = true) ||
                        house.address.contains(_searchQuery.value, ignoreCase = true) ||
                        house.description?.contains(_searchQuery.value, ignoreCase = true) == true
                    }
                } else {
                    _allHouses.value
                }

                // Apply filters
                _selectedListingType.value?.let { type ->
                    results = results.filter { it.listingType == type }
                }

                _minPrice.value?.let { min ->
                    results = results.filter { (it.cost ?: 0.0) >= min }
                }

                _maxPrice.value?.let { max ->
                    results = results.filter { (it.cost ?: 0.0) <= max }
                }

                // Apply sorting
                results = when (_sortOption.value) {
                    SortOption.PRICE_LOW_TO_HIGH -> results.sortedBy { it.cost ?: 0.0 }
                    SortOption.PRICE_HIGH_TO_LOW -> results.sortedByDescending { it.cost ?: 0.0 }
                    SortOption.NEWEST -> results.sortedByDescending { it.listedAt }
                    SortOption.POPULARITY -> results // Keep original order for popularity
                }

                _searchResults.value = results
            } catch (e: Exception) {
                _searchResults.value = emptyList()
            } finally {
                _isSearching.value = false
            }
        }
    }
}



================================================
FILE: composeApp/src/commonMain/kotlin/com/yet/home/viewmodel/SolanaNetworkViewModel.kt
================================================
package com.yet.home.viewmodel

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.yet.domain.model.SolanaAccountBalance
import com.yet.domain.model.SolanaClusterConfig
import com.yet.domain.model.SolanaNetworkStatus
import com.yet.domain.repository.SolanaChainRepository
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.flow.update
import kotlinx.coroutines.launch
import org.koin.android.annotation.KoinViewModel
import org.koin.core.component.KoinComponent
import org.koin.core.component.inject

data class SolanaNetworkUiState(
    val endpoint: String,
    val watchAccount: String,
    val status: SolanaNetworkStatus? = null,
    val balance: SolanaAccountBalance? = null,
    val lastSignature: String? = null,
    val isLoading: Boolean = false,
    val errorMessage: String? = null,
)

@KoinViewModel
class SolanaNetworkViewModel : ViewModel(), KoinComponent {

    private val repository: SolanaChainRepository by inject()
    private val clusterConfig: SolanaClusterConfig by inject()

    private val _uiState = MutableStateFlow(
        SolanaNetworkUiState(
            endpoint = clusterConfig.endpoint,
            watchAccount = clusterConfig.defaultWatchAccount,
        ),
    )
    val uiState: StateFlow<SolanaNetworkUiState> = _uiState.asStateFlow()

    init {
        refresh()
    }

    fun updateWatchAccount(value: String) {
        _uiState.update { it.copy(watchAccount = value.trim()) }
    }

    fun refresh() {
        val publicKey = _uiState.value.watchAccount
        if (publicKey.isBlank()) {
            _uiState.update {
                it.copy(errorMessage = "Введите публичный ключ кошелька для запроса в Solana.")
            }
            return
        }
        viewModelScope.launch {
            _uiState.update { it.copy(isLoading = true, errorMessage = null) }
            val statusResult = repository.getNetworkStatus()
            val balanceResult = repository.getAccountBalance(publicKey)
            _uiState.update { current ->
                current.copy(
                    status = statusResult.getOrNull(),
                    balance = balanceResult.getOrNull(),
                    errorMessage = statusResult.exceptionOrNull()?.message
                        ?: balanceResult.exceptionOrNull()?.message,
                    isLoading = false,
                )
            }
        }
    }

    fun requestAirdrop(amountSol: Double) {
        val publicKey = _uiState.value.watchAccount
        if (publicKey.isBlank()) {
            _uiState.update {
                it.copy(errorMessage = "Введите публичный ключ кошелька для запроса airdrop.")
            }
            return
        }
        if (amountSol <= 0.0) {
            _uiState.update {
                it.copy(errorMessage = "Сумма airdrop должна быть больше 0 SOL.")
            }
            return
        }
        viewModelScope.launch {
            _uiState.update { it.copy(isLoading = true, errorMessage = null) }
            val requestResult = repository.requestAirdrop(publicKey, amountSol)
            _uiState.update { current ->
                current.copy(
                    lastSignature = requestResult.getOrNull(),
                    errorMessage = requestResult.exceptionOrNull()?.message,
                    isLoading = false,
                )
            }
            if (requestResult.isSuccess) {
                refresh()
            }
        }
    }
}



================================================
FILE: composeApp/src/iosMain/kotlin/com/yet/home/MainViewController.kt
================================================
package com.yet.home

import androidx.compose.ui.window.ComposeUIViewController
import com.yet.home.di.initKoin

fun MainViewController() = ComposeUIViewController {
    initKoin()
    App()
}


================================================
FILE: composeApp/src/iosMain/kotlin/com/yet/home/Platform.ios.kt
================================================
package com.yet.home

import platform.UIKit.UIDevice

class IOSPlatform: Platform {
    override val name: String = UIDevice.currentDevice.systemName() + " " + UIDevice.currentDevice.systemVersion
}

actual fun getPlatform(): Platform = IOSPlatform()


================================================
FILE: core/data/build.gradle.kts
================================================
import com.google.devtools.ksp.gradle.KspAATask
import de.jensklingenberg.ktorfit.gradle.ErrorCheckingMode

plugins {
    alias(libs.plugins.local.kotlin.multiplatform)
    alias(libs.plugins.local.koin)
    alias(libs.plugins.ktor.fit)
}

kotlin {

    sourceSets {
        commonMain.dependencies {
            implementation(projects.core.domain)

            implementation(libs.foundation.metaplex.solana)

            implementation(libs.bundles.multiplatform.settings)
            implementation(libs.bundles.ktorfit)
        }

        val commonTest by getting {
            dependencies {
                implementation(libs.bundles.testing)

                implementation(libs.multiplatform.settings.test)
                implementation(libs.multiplatform.settings.coroutines)
            }
        }
    }
}

project.tasks.withType<KspAATask>().configureEach {
    if (name != "kspCommonMainKotlinMetadata") {
        dependsOn("kspCommonMainKotlinMetadata")
    }
}

ktorfit {
    errorCheckingMode = ErrorCheckingMode.ERROR
    generateQualifiedTypeName = false
}



================================================
FILE: core/data/src/commonMain/kotlin/com/yet/data/api/HouseApi.kt
================================================
package com.yet.data.api

import com.yet.data.model.HouseDTO
import com.yet.data.model.UserResponse
import de.jensklingenberg.ktorfit.http.GET
import de.jensklingenberg.ktorfit.http.Query
import de.jensklingenberg.ktorfit.http.Path

interface HouseApi {

    @GET("houses")
    suspend fun getHouses(
        @Query("n") count: Int = 10
    ): List<HouseDTO>

    @GET("user_houses")
    suspend fun getUserHouses(
        @Query("user_id") userId: Int,
        @Query("n") count: Int = 10
    ): List<HouseDTO>

    @GET("user/{user_id}")
    suspend fun getUser(
        @Path("user_id") userId: Int
    ): UserResponse
}




================================================
FILE: core/data/src/commonMain/kotlin/com/yet/data/di/ApiModule.kt
================================================
package com.yet.data.di

import com.yet.data.api.HouseApi
import com.yet.data.api.createHouseApi
import de.jensklingenberg.ktorfit.Ktorfit
import io.ktor.client.HttpClient
import io.ktor.client.engine.cio.CIO
import io.ktor.client.plugins.HttpTimeout
import io.ktor.client.plugins.contentnegotiation.ContentNegotiation
import io.ktor.client.plugins.logging.LogLevel
import io.ktor.client.plugins.logging.Logging
import io.ktor.serialization.kotlinx.json.json
import kotlinx.serialization.json.Json
import org.koin.core.annotation.ComponentScan
import org.koin.core.annotation.Module
import org.koin.core.annotation.Single

@Module
@ComponentScan("com.yet.data.api")
class ApiModule {

    @Single
    fun provideJson(): Json =
        Json {
            ignoreUnknownKeys = true
            encodeDefaults = true
            isLenient = true
            coerceInputValues = true
        }

    @Single
    fun provideHttpClient(json: Json): HttpClient = HttpClient(CIO) {
        install(ContentNegotiation) {
            json(json)
        }
        install(HttpTimeout)

        install(Logging) {
            level = LogLevel.ALL
        }
    }

    @Single
    fun provideKtorfit(httpClient: HttpClient): Ktorfit =
        Ktorfit.Builder()
            .baseUrl("http://jumbo.galagen.net:2205/")
            .httpClient(httpClient)
            .build()

    @Single
    fun provideHouseApi(ktorfit: Ktorfit): HouseApi {
        return ktorfit.createHouseApi()
    }
}


================================================
FILE: core/data/src/commonMain/kotlin/com/yet/data/di/DataModule.kt
================================================
package com.yet.data.di

import com.russhwolf.settings.ExperimentalSettingsApi
import com.russhwolf.settings.ObservableSettings
import com.russhwolf.settings.Settings
import com.russhwolf.settings.coroutines.FlowSettings
import com.russhwolf.settings.coroutines.toFlowSettings
import com.russhwolf.settings.observable.makeObservable
import com.yet.data.repository.HouseRepositoryImpl
import com.yet.domain.model.SolanaClusterConfig
import com.yet.domain.repository.HouseRepository
import foundation.metaplex.rpc.RPC
import org.koin.core.annotation.ComponentScan
import org.koin.core.annotation.Module
import org.koin.core.annotation.Single

@Module([ApiModule::class])
@ComponentScan("com.yet.data")
class DataModule {
    
    @Single
    fun provideHouseRepository(impl: HouseRepositoryImpl): HouseRepository = impl
    
    @Single
    fun provideSettings(): Settings = Settings()

    @OptIn(ExperimentalSettingsApi::class)
    @Single
    fun provideFlowSettings(settings: Settings): FlowSettings {
        val observableSettings: ObservableSettings = settings.makeObservable()
        return observableSettings.toFlowSettings()
    }

    @Single
    fun provideSolanaClusterConfig(): SolanaClusterConfig = SolanaClusterConfig(
        endpoint = DEVNET_ENDPOINT,
        programId = PROPERTY_PROGRAM_ID,
        defaultWatchAccount = DEFAULT_WATCH_ACCOUNT,
    )

    @Single
    fun provideSolanaRpc(config: SolanaClusterConfig): RPC = RPC(config.endpoint)
}

private const val DEVNET_ENDPOINT = "https://api.devnet.solana.com"
private const val PROPERTY_PROGRAM_ID = "Bvq9mwXmV95Mz848zK8FZ11JiKfLjGc7savK5u657H9Z"
private const val DEFAULT_WATCH_ACCOUNT = "8TgxbPoJxSxAi8uKXuX4nHCqB6fRwVi6zkRgZNpm5Xnr"




================================================
FILE: core/data/src/commonMain/kotlin/com/yet/data/mapper/HouseMapper.kt
================================================
package com.yet.data.mapper

import com.yet.data.model.HouseDTO
import com.yet.domain.model.House
import com.yet.domain.model.ListingType
import com.yet.domain.model.PropertyStatus
import com.yet.domain.model.PropertyType

/**
 * Функция расширения для преобразования HouseDTO в доменную модель House
 */
fun HouseDTO.toHouse(): House {
    // Маппим тип недвижимости
    val propertyType = when (type?.uppercase()) {
        "APARTMENT", "APARTAMENT" -> PropertyType.APARTMENT
        "HOUSE" -> PropertyType.HOUSE
        else -> null
    }
    
    // Определяем тип листинга на основе наличия tokens
    val listingType = if (tokens != null && tokens > 0) {
        ListingType.FRACTIONAL
    } else {
        ListingType.WHOLE
    }
    
    // Маппим статус (по умолчанию FOR_SALE, так как в API нет статуса)
    val status = PropertyStatus.FOR_SALE
    
    return House(
        id = id,
        name = name,
        address = address,
        area = area,
        images = images,
        cost = cost,
        tokens = tokens,
        type = type,
        description = name, // Используем name как description
        status = status,
        listingType = listingType,
        propertyType = propertyType,
        listedAt = null, // В API нет даты листинга
        agentId = null // В API нет agentId
    )
}

/**
 * Функция расширения для преобразования списка HouseDTO в список House
 */
fun List<HouseDTO>.toHouse(): List<House> = map { it.toHouse() }




================================================
FILE: core/data/src/commonMain/kotlin/com/yet/data/mapper/UserMapper.kt
================================================
package com.yet.data.mapper

import com.yet.data.model.UserResponse
import com.yet.domain.model.User
import com.yet.domain.model.UserRole

object UserMapper {
    
    fun UserResponse.toDomain(): User {
        // Проверяем, что все обязательные поля присутствуют
        require(id != null) { "User id is required" }
        require(wallet != null) { "User wallet is required" }
        require(name != null) { "User name is required" }
        require(surname != null) { "User surname is required" }
        
        // Объединяем name и surname в полное имя
        val fullName = "$name $surname".trim()
        
        // Используем wallet как email, если нет отдельного email поля
        val email = wallet ?: ""
        
        // По умолчанию роль - INVESTOR, так как в API нет роли
        val userRole = UserRole.INVESTOR
        
        return User(
            id = id.toString(),
            name = fullName,
            email = email,
            userRole = userRole
        )
    }
}




================================================
FILE: core/data/src/commonMain/kotlin/com/yet/data/model/HouseDTO.kt
================================================
package com.yet.data.model

import kotlinx.serialization.Serializable

@Serializable
data class HouseDTO(
    val id: Int,
    val name: String,
    val address: String,
    val area: Int? = null,
    val images: List<String>,
    val cost: Double? = null,
    val tokens: Int? = null,
    val type: String? = null
)




================================================
FILE: core/data/src/commonMain/kotlin/com/yet/data/model/UserResponse.kt
================================================
package com.yet.data.model

import kotlinx.serialization.Serializable

@Serializable
data class UserResponse(
    val id: Int? = null,
    val wallet: String? = null,
    val name: String? = null,
    val surname: String? = null
)




================================================
FILE: core/data/src/commonMain/kotlin/com/yet/data/repository/AuthRepositoryImpl.kt
================================================
package com.yet.data.repository

import com.yet.data.api.HouseApi
import com.yet.data.mapper.UserMapper
import com.yet.domain.model.User
import com.yet.domain.model.UserRole
import com.yet.domain.repository.AuthRepository
import jakarta.inject.Inject
import jakarta.inject.Singleton
import kotlinx.coroutines.delay
import kotlin.time.Duration.Companion.seconds

@Singleton
class AuthRepositoryImpl @Inject constructor(
    private val houseApi: HouseApi
) : AuthRepository {

    private val mockUsers = listOf(
        User(
            id = "user1",
            name = "John Doe",
            email = "john@example.com",
            userRole = UserRole.BUYER
        ),
        User(
            id = "user2",
            name = "Jane Smith",
            email = "jane@example.com",
            userRole = UserRole.SELLER
        ),
        User(
            id = "user3",
            name = "Bob Johnson",
            email = "bob@example.com",
            userRole = UserRole.INVESTOR
        ),
        User(
            id = "user4",
            name = "Alice Brown",
            email = "alice@example.com",
            userRole = UserRole.AGENT
        )
    )

    private var currentUser: User? = null

    override suspend fun login(email: String, password: String): Result<User> {
        delay(1.seconds)
        val user = mockUsers.find { it.email == email }
        return if (user != null && password == "password") { // Simple mock password check
            currentUser = user
            Result.success(user)
        } else {
            Result.failure(Exception("Invalid credentials"))
        }
    }

    override suspend fun register(name: String, email: String, password: String): Result<User> {
        delay(1.seconds)
        val existingUser = mockUsers.find { it.email == email }
        return if (existingUser == null) {
            val newUser = User(
                id = "user${mockUsers.size + 1}",
                name = name,
                email = email,
                userRole = UserRole.BUYER // Default role for new users
            )
            currentUser = newUser
            Result.success(newUser)
        } else {
            Result.failure(Exception("User already exists"))
        }
    }

    override suspend fun getCurrentUser(): Result<User?> {
        delay(0.5.seconds)
        return Result.success(currentUser)
    }

    /**
     * Получить пользователя через API
     */
    suspend fun getUserById(userId: Int): Result<User> {
        return try {
            val userResponse = houseApi.getUser(userId)
            // Проверяем, что ответ не пустой
            if (userResponse.id == null || userResponse.wallet == null || 
                userResponse.name == null || userResponse.surname == null) {
                return Result.failure(Exception("User not found or incomplete data"))
            }
            val user = UserMapper.run { userResponse.toDomain() }
            Result.success(user)
        } catch (e: Exception) {
            Result.failure(Exception("Failed to get user: ${e.message}", e))
        }
    }
}



================================================
FILE: core/data/src/commonMain/kotlin/com/yet/data/repository/HomeRepositoryImpl.kt
================================================
package com.yet.data.repository

import com.yet.data.api.HouseApi
import com.yet.data.mapper.toHouse
import com.yet.domain.model.House
import com.yet.domain.model.Investment
import com.yet.domain.model.PropertyShare
import com.yet.domain.model.User
import com.yet.domain.model.UserRole
import com.yet.domain.repository.HomeRepository
import jakarta.inject.Inject
import org.koin.core.annotation.Single
import kotlinx.coroutines.delay
import kotlinx.datetime.LocalDate
import kotlin.time.Duration.Companion.seconds

@Single
class HomeRepositoryImpl @Inject constructor(
    private val houseApi: HouseApi
) : HomeRepository {

    override suspend fun getHouses(count: Int): Result<List<House>> = runCatching {
        houseApi.getHouses(count).map { it.toHouse() }
    }

    override suspend fun getUserHouses(userId: Int, count: Int): Result<List<House>> = runCatching {
        houseApi.getUserHouses(userId, count).map { it.toHouse() }
    }

    override suspend fun getHouseDetails(id: Int): Result<House> = runCatching {
        val houses = houseApi.getHouses(100).map { it.toHouse() }
        houses.firstOrNull { it.id == id } ?: error("House not found")
    }

    override suspend fun getCurrentUser(userId: Int): Result<User?> = runCatching {
        val dto = houseApi.getUser(userId)
        User(
            id = dto.id.toString(),
            name = dto.name.toString(),
            email = dto.wallet.toString(),
            userRole = UserRole.INVESTOR
        )
    }

    // --- Mocks for investments and shares (until backend provides endpoints) ---
    private val mockInvestments = mutableListOf(
        Investment(
            id = "invest1",
            userId = "user1",
            propertyId = "1",
            propertyTitle = "Коммерческая недвижимость с высоким доходом",
            amount = 100000.0,
            date = "2024-10-01",
            investedAmount = 100000.0,
            investmentDate = LocalDate(2024, 10, 1),
            expectedReturn = 8.5
        ),
        Investment(
            id = "invest2",
            userId = "user1",
            propertyId = "2",
            propertyTitle = "Многофункциональный объект в растущем районе",
            amount = 75000.0,
            date = "2024-09-15",
            investedAmount = 75000.0,
            investmentDate = LocalDate(2024, 9, 15),
            expectedReturn = 7.2
        )
    )

    private val mockPropertyShares = mutableListOf(
        PropertyShare(
            id = "share1",
            propertyId = "1",
            propertyTitle = "Коммерческая недвижимость с высоким доходом",
            ownerId = "user1",
            percentage = 5.2,
            currentValue = 260000.0,
            sharePercentage = 5.2,
            purchasePrice = 100000.0,
            purchaseDate = LocalDate(2024, 10, 1)
        ),
        PropertyShare(
            id = "share2",
            propertyId = "2",
            propertyTitle = "Многофункциональный объект в растущем районе",
            ownerId = "user1",
            percentage = 2.5,
            currentValue = 187500.0,
            sharePercentage = 2.5,
            purchasePrice = 75000.0,
            purchaseDate = LocalDate(2024, 9, 15)
        )
    )

    override suspend fun getUserInvestments(userId: String): Result<List<Investment>> {
        delay(1.seconds)
        return Result.success(mockInvestments.filter { it.userId == userId })
    }

    override suspend fun getUserPropertyShares(userId: String): Result<List<PropertyShare>> {
        delay(1.seconds)
        return Result.success(mockPropertyShares.filter { it.ownerId == userId })
    }
}





================================================
FILE: core/data/src/commonMain/kotlin/com/yet/data/repository/HouseRepositoryImpl.kt
================================================
package com.yet.data.repository

import com.yet.data.api.HouseApi
import com.yet.data.mapper.toHouse
import com.yet.domain.model.House
import com.yet.domain.repository.HouseRepository
import org.koin.core.annotation.Single

@Single
class HouseRepositoryImpl(
    private val houseApi: HouseApi
) : HouseRepository {

    override suspend fun getHouses(count: Int): Result<List<House>> {
        return try {
            val dtoList = houseApi.getHouses(count)
            val houses = dtoList.toHouse()
            Result.success(houses)
        } catch (e: Exception) {
            e.printStackTrace()
            Result.failure(e)
        }
    }

    override suspend fun getUserHouses(userId: String): Result<List<House>> {
        return try {
            // Конвертируем userId из String в Int для API
            val userIdInt = userId.toIntOrNull()
                ?: return Result.failure(IllegalArgumentException("Invalid user ID format: $userId"))
            
            val dtoList = houseApi.getUserHouses(userIdInt)
            Result.success(dtoList.toHouse())
        } catch (e: Exception) {
            Result.failure(e)
        }
    }

    override suspend fun getHouseDetails(id: String): Result<House> {
        return try {
            // Конвертируем id из String в Int для поиска
            val idInt = id.toIntOrNull()
                ?: return Result.failure(IllegalArgumentException("Invalid house ID format: $id"))
            
            // Получаем список домов и ищем нужный по id
            // В будущем можно добавить отдельный endpoint для получения одного дома
            val houses = houseApi.getHouses(100)
            val house = houses.find { it.id == idInt }
            
            if (house != null) {
                Result.success(house.toHouse())
            } else {
                Result.failure(Exception("House not found with id: $id"))
            }
        } catch (e: Exception) {
            Result.failure(e)
        }
    }
}




================================================
FILE: core/data/src/commonMain/kotlin/com/yet/data/repository/SolanaChainRepositoryImpl.kt
================================================
package com.yet.data.repository

import com.yet.domain.model.SolanaAccountBalance
import com.yet.domain.model.SolanaClusterConfig
import com.yet.domain.model.SolanaNetworkStatus
import com.yet.domain.repository.SolanaChainRepository
import foundation.metaplex.amount.sol
import foundation.metaplex.rpc.Commitment
import foundation.metaplex.rpc.RPC
import foundation.metaplex.rpc.RpcGetBalanceConfiguration
import foundation.metaplex.rpc.RpcGetLatestBlockhashConfiguration
import foundation.metaplex.rpc.RpcGetSlotConfiguration
import foundation.metaplex.rpc.RpcRequestAirdropConfiguration
import foundation.metaplex.solanapublickeys.PublicKey
import jakarta.inject.Inject
import jakarta.inject.Singleton

@Singleton
class SolanaChainRepositoryImpl @Inject constructor(
    private val rpc: RPC,
    private val clusterConfig: SolanaClusterConfig,
) : SolanaChainRepository {

    override suspend fun getNetworkStatus(): Result<SolanaNetworkStatus> = runCatching {
        val latestBlockhash = rpc.getLatestBlockhash(
            RpcGetLatestBlockhashConfiguration(commitment = Commitment.confirmed),
        )
        val slot = rpc.getSlot(RpcGetSlotConfiguration(commitment = Commitment.confirmed))
        SolanaNetworkStatus(
            endpoint = clusterConfig.endpoint,
            slot = slot,
            blockhash = latestBlockhash.blockhash,
            lastValidBlockHeight = latestBlockhash.lastValidBlockHeight,
        )
    }

    override suspend fun getAccountBalance(publicKey: String): Result<SolanaAccountBalance> =
        runCatching {
            val balanceLamports = rpc.getBalance(
                PublicKey(publicKey),
                RpcGetBalanceConfiguration(commitment = Commitment.confirmed),
            )
            SolanaAccountBalance(
                publicKey = publicKey,
                lamports = balanceLamports,
                sol = balanceLamports.toDouble() / LAMPORTS_IN_SOL,
            )
        }

    override suspend fun requestAirdrop(
        publicKey: String,
        amountSol: Double,
    ): Result<String> = runCatching {
        val signatureBytes = rpc.requestAirdrop(
            RpcRequestAirdropConfiguration(
                publicKey = PublicKey(publicKey),
                lamports = sol(amountSol),
                commitment = Commitment.confirmed,
            ),
        )
        signatureBytes.decodeToString()
    }

    private companion object {
        private const val LAMPORTS_IN_SOL = 1_000_000_000.0
    }
}



================================================
FILE: core/data/src/commonMain/kotlin/com/yet/data/utils/provideSolanaClusterConfig.kt
================================================
package com.yet.data.utils

import com.yet.domain.model.SolanaClusterConfig
import foundation.metaplex.rpc.RPC

private const val DEVNET_ENDPOINT = "https://api.devnet.solana.com"
private const val PROPERTY_PROGRAM_ID = "Bvq9mwXmV95Mz848zK8FZ11JiKfLjGc7savK5u657H9Z"
private const val DEFAULT_WATCH_ACCOUNT = "8TgxbPoJxSxAi8uKXuX4nHCqB6fRwVi6zkRgZNpm5Xnr"


fun provideSolanaClusterConfig(): SolanaClusterConfig = SolanaClusterConfig(
    endpoint = DEVNET_ENDPOINT,
    programId = PROPERTY_PROGRAM_ID,
    defaultWatchAccount = DEFAULT_WATCH_ACCOUNT,
)


fun provideSolanaRpc(config: SolanaClusterConfig): RPC = RPC(config.endpoint)


================================================
FILE: core/domain/build.gradle.kts
================================================
plugins {
    alias(libs.plugins.local.kotlin.multiplatform)
}

kotlin {

    sourceSets {
        commonMain.dependencies {}
    }
}


================================================
FILE: core/domain/src/commonMain/kotlin/com/yet/domain/model/Address.kt
================================================
package com.yet.domain.model


data class Address(
    val street: String,
    val city: String,
    val state: String,
    val zip: String
)



================================================
FILE: core/domain/src/commonMain/kotlin/com/yet/domain/model/ConstructionCompany.kt
================================================
package com.yet.domain.model

data class ConstructionCompany(
    val id: String,
    val name: String,
    val description: String,
    val logoUrl: String?,
    val imageUrl: String?,
    val totalProjects: Int,
    val completedProjects: Int,
    val totalInvestmentAmount: Double,
    val currentInvestmentAmount: Double,
    val minInvestmentAmount: Double,
    val expectedReturn: Double, // в процентах
    val location: String,
    val rating: Double,
    val investorsCount: Int,
    val isActive: Boolean
)




================================================
FILE: core/domain/src/commonMain/kotlin/com/yet/domain/model/Enums.kt
================================================
package com.yet.domain.model

enum class UserRole {
    BUYER, SELLER, INVESTOR, AGENT
}

enum class PropertyType {
    APARTMENT, HOUSE
}

enum class PropertyStatus {
    FOR_SALE, SOLD, FRACTIONAL_AVAILABLE
}

enum class ListingType {
    WHOLE, FRACTIONAL
}

enum class OfferStatus {
    PENDING, ACCEPTED, REJECTED
}



================================================
FILE: core/domain/src/commonMain/kotlin/com/yet/domain/model/House.kt
================================================
package com.yet.domain.model

import kotlinx.datetime.LocalDateTime

data class House(
    val id: Int,
    val name: String,
    val address: String,
    val area: Int? = null,
    val images: List<String>,
    val cost: Double? = null,
    val tokens: Int? = null,
    val type: String? = null,
    // Дополнительные поля из старых моделей
    val description: String? = null,
    val status: PropertyStatus? = null,
    val listingType: ListingType? = null,
    val propertyType: PropertyType? = null,
    val listedAt: LocalDateTime? = null,
    val agentId: String? = null
)



================================================
FILE: core/domain/src/commonMain/kotlin/com/yet/domain/model/Investment.kt
================================================
package com.yet.domain.model

import kotlinx.datetime.LocalDate



data class Investment(
    val id: String,
    val userId: String,
    val propertyId: String,
    val propertyTitle: String,
    val amount: Double,
    val date: String,
    val investedAmount: Double,
    val investmentDate: LocalDate,
    val expectedReturn: Double
)



================================================
FILE: core/domain/src/commonMain/kotlin/com/yet/domain/model/Offer.kt
================================================
package com.yet.domain.model

import kotlinx.datetime.LocalDateTime



data class Offer(
    val id: String,
    val propertyId: String,
    val buyerId: String,
    val offerAmount: Double,
    val status: OfferStatus,
    val createdAt: LocalDateTime
)



================================================
FILE: core/domain/src/commonMain/kotlin/com/yet/domain/model/PropertyShare.kt
================================================
package com.yet.domain.model

import kotlinx.datetime.LocalDate



data class PropertyShare(
    val id: String,
    val propertyId: String,
    val propertyTitle: String,
    val ownerId: String,
    val percentage: Double,
    val currentValue: Double,
    val sharePercentage: Double,
    val purchasePrice: Double,
    val purchaseDate: LocalDate
)



================================================
FILE: core/domain/src/commonMain/kotlin/com/yet/domain/model/SolanaAccountBalance.kt
================================================
package com.yet.domain.model

/**
 * Convenience wrapper around lamports to present SOL to the UI layer.
 */
data class SolanaAccountBalance(
    val publicKey: String,
    val lamports: Long,
    val sol: Double,
)



================================================
FILE: core/domain/src/commonMain/kotlin/com/yet/domain/model/SolanaClusterConfig.kt
================================================
package com.yet.domain.model

/**
 * Shared configuration for the Solana cluster that the app interacts with.
 *
 * Keeping this data class in `core-domain` lets every platform (Android/iOS/JVM)
 * understand which RPC endpoint and default account should be used without
 * leaking implementation details from the data layer.
 */
data class SolanaClusterConfig(
    val endpoint: String,
    val programId: String,
    val defaultWatchAccount: String,
)



================================================
FILE: core/domain/src/commonMain/kotlin/com/yet/domain/model/SolanaNetworkStatus.kt
================================================
package com.yet.domain.model

/**
 * Snapshot of the RPC cluster state returned by [foundation.metaplex.rpc.RPC].
 */
data class SolanaNetworkStatus(
    val endpoint: String,
    val slot: ULong,
    val blockhash: String,
    val lastValidBlockHeight: ULong,
)



================================================
FILE: core/domain/src/commonMain/kotlin/com/yet/domain/model/User.kt
================================================
package com.yet.domain.model




data class User(
    val id: String,
    val name: String,
    val email: String,
    val userRole: UserRole
)



================================================
FILE: core/domain/src/commonMain/kotlin/com/yet/domain/repository/AuthRepository.kt
================================================
package com.yet.domain.repository

import com.yet.domain.model.User


interface AuthRepository {
    suspend fun login(email: String, password: String): Result<User>
    suspend fun register(name: String, email: String, password: String): Result<User>
    suspend fun getCurrentUser(): Result<User?>
}



================================================
FILE: core/domain/src/commonMain/kotlin/com/yet/domain/repository/ConstructionCompanyRepository.kt
================================================
package com.yet.domain.repository

import com.yet.domain.model.ConstructionCompany

interface ConstructionCompanyRepository {
    suspend fun getAllCompanies(): Result<List<ConstructionCompany>>
    suspend fun getCompanyById(id: String): Result<ConstructionCompany>
    suspend fun searchCompanies(query: String): Result<List<ConstructionCompany>>
}




================================================
FILE: core/domain/src/commonMain/kotlin/com/yet/domain/repository/HomeRepository.kt
================================================
package com.yet.domain.repository

import com.yet.domain.model.House
import com.yet.domain.model.Investment
import com.yet.domain.model.PropertyShare
import com.yet.domain.model.User

interface HomeRepository {
    suspend fun getHouses(count: Int = 10): Result<List<House>>
    suspend fun getUserHouses(userId: Int, count: Int = 10): Result<List<House>>
    suspend fun getHouseDetails(id: Int): Result<House>

    suspend fun getCurrentUser(userId: Int = 1): Result<User?>
    suspend fun getUserInvestments(userId: String): Result<List<Investment>>
    suspend fun getUserPropertyShares(userId: String): Result<List<PropertyShare>>
}





================================================
FILE: core/domain/src/commonMain/kotlin/com/yet/domain/repository/HouseRepository.kt
================================================
package com.yet.domain.repository

import com.yet.domain.model.House

interface HouseRepository {
    suspend fun getHouses(count: Int = 10): Result<List<House>>
    suspend fun getUserHouses(userId: String): Result<List<House>>
    suspend fun getHouseDetails(id: String): Result<House>
}




================================================
FILE: core/domain/src/commonMain/kotlin/com/yet/domain/repository/SolanaChainRepository.kt
================================================
package com.yet.domain.repository

import com.yet.domain.model.SolanaAccountBalance
import com.yet.domain.model.SolanaNetworkStatus

interface SolanaChainRepository {
    suspend fun getNetworkStatus(): Result<SolanaNetworkStatus>
    suspend fun getAccountBalance(publicKey: String): Result<SolanaAccountBalance>
    suspend fun requestAirdrop(publicKey: String, amountSol: Double): Result<String>
}



================================================
FILE: gradle/libs.versions.toml
================================================
[versions]
agp = "8.11.2"
android-compileSdk = "36"
android-minSdk = "24"
android-targetSdk = "36"

androidx-activity = "1.11.0"
androidx-appcompat = "1.7.1"
androidx-core = "1.17.0"

androidx-espresso = "3.7.0"
androidx-lifecycle = "2.9.6"
androidx-testExt = "1.3.0"

junit = "4.13.2"
robolectric = "4.16"
turbine = "1.2.1"
mockk = "1.14.6"
coreKtx = "1.7.0"

composeHotReload = "1.0.0-rc03"
composeMultiplatform = "1.9.3"
androidx-navigation = "2.9.1"
coilComposeCore = "3.3.0"

ktor = "3.3.2"
ktor-fit = "2.6.4"

kotlin = "2.2.21"
ksp = "2.3.0"

kotlinx-coroutines = "1.10.2"
kotlinxDatetime = "0.7.1-0.6.x-compat"
kotlinxSerializationJson = "1.9.0"
jetbrainsKotlinWrappers = "2025.10.11"
solanakmp = "0.2.10"

koin = "4.1.1"
koin-annotation = "2.3.1"

multiplatformSettings = "1.3.0"
sqldelight = "2.2.1"

[libraries]
androidx-core-ktx = { module = "androidx.core:core-ktx", version.ref = "androidx-core" }
androidx-appcompat = { module = "androidx.appcompat:appcompat", version.ref = "androidx-appcompat" }
androidx-lifecycle-viewmodelCompose = { module = "org.jetbrains.androidx.lifecycle:lifecycle-viewmodel-compose", version.ref = "androidx-lifecycle" }

androidx-activity-compose = { module = "androidx.activity:activity-compose", version.ref = "androidx-activity" }
androidx-lifecycle-runtimeCompose = { module = "org.jetbrains.androidx.lifecycle:lifecycle-runtime-compose", version.ref = "androidx-lifecycle" }

#coil
coil = { module = "io.coil-kt.coil3:coil", version.ref = "coilComposeCore" }
coil-compose-core = { module = "io.coil-kt.coil3:coil-compose-core", version.ref = "coilComposeCore" }
coil-compose = { module = "io.coil-kt.coil3:coil-compose", version.ref = "coilComposeCore" }
coil-network-ktor = { module = "io.coil-kt.coil3:coil-network-ktor3", version.ref = "coilComposeCore" }

#ktor-fit
ktor-fit = { module = "de.jensklingenberg.ktorfit:ktorfit-lib", version.ref = "ktor-fit" }
ktor-fit-converter-response = { module = "de.jensklingenberg.ktorfit:ktorfit-converters-response", version.ref = "ktor-fit" }
ktor-fit-converter-call = { module = "de.jensklingenberg.ktorfit:ktorfit-converters-call", version.ref = "ktor-fit" }
ktor-fit-converter-flow = { module = "de.jensklingenberg.ktorfit:ktorfit-converters-flow", version.ref = "ktor-fit" }

#ktor
ktor-serialization-kotlinx-json = { module = "io.ktor:ktor-serialization-kotlinx-json", version.ref = "ktor" }
ktor-client-content-negotiation = { module = "io.ktor:ktor-client-content-negotiation", version.ref = "ktor" }
ktor-client-serialization = { module = "io.ktor:ktor-client-serialization", version.ref = "ktor" }
ktor-client-auth = { module = "io.ktor:ktor-client-auth", version.ref = "ktor" }
ktor-client-logging = { module = "io.ktor:ktor-client-logging", version.ref = "ktor" }
ktor-client-cio = { module = "io.ktor:ktor-client-cio", version.ref = "ktor" }

#kotlinx
kotlinx-coroutinesSwing = { module = "org.jetbrains.kotlinx:kotlinx-coroutines-swing", version.ref = "kotlinx-coroutines" }
kotlinx-coroutines-core = { module = "org.jetbrains.kotlinx:kotlinx-coroutines-core", version.ref = "kotlinx-coroutines" }
kotlinx-datetime = { module = "org.jetbrains.kotlinx:kotlinx-datetime", version.ref = "kotlinxDatetime" }
kotlinx-serialization-json = { module = "org.jetbrains.kotlinx:kotlinx-serialization-json", version.ref = "kotlinxSerializationJson" }
kotlin-browser = { module = "org.jetbrains.kotlin-wrappers:kotlin-browser" }
jetbrains-kotlinWrappers-kotlinWrappersBom = { group = "org.jetbrains.kotlin-wrappers", name = "kotlin-wrappers-bom", version.ref = "jetbrainsKotlinWrappers" }
foundation-metaplex-solana = { module = "foundation.metaplex:solana", version.ref = "solanakmp" }

#koin
koin-core = { group = "io.insert-koin", name = "koin-core", version.ref = "koin" }
koin-android = { group = "io.insert-koin", name = "koin-android", version.ref = "koin" }
koin-compose = { group = "io.insert-koin", name = "koin-compose", version.ref = "koin" }
koin-compose-viewmodel = { group = "io.insert-koin", name = "koin-compose-viewmodel", version.ref = "koin" }
koin-compose-viewmodel-navigation = { group = "io.insert-koin", name = "koin-compose-viewmodel-navigation", version.ref = "koin" }
koin-test = { group = "io.insert-koin", name = "koin-test", version.ref = "koin" }

koin-annotation = { group = "io.insert-koin", name = "koin-annotations", version.ref = "koin-annotation" }
koin-annotation-compiler = { group = "io.insert-koin", name = "koin-ksp-compiler", version.ref = "koin-annotation" }
koin-jsr330 = { group = "io.insert-koin", name = "koin-jsr330", version.ref = "koin-annotation" }


#settings
multiplatform-settings = { module = "com.russhwolf:multiplatform-settings", version.ref = "multiplatformSettings" }
multiplatform-settings-test = { module = "com.russhwolf:multiplatform-settings-test", version.ref = "multiplatformSettings" }
multiplatform-settings-no-arg = { module = "com.russhwolf:multiplatform-settings-no-arg", version.ref = "multiplatformSettings" }
multiplatform-settings-coroutines = { module = "com.russhwolf:multiplatform-settings-coroutines", version.ref = "multiplatformSettings" }
multiplatform-settings-observable = { module = "com.russhwolf:multiplatform-settings-make-observable", version.ref = "multiplatformSettings" }

androidx-navigation-compose = { module = "org.jetbrains.androidx.navigation:navigation-compose", version.ref = "androidx-navigation" }


#test
kotlin-test = { module = "org.jetbrains.kotlin:kotlin-test", version.ref = "kotlin" }
kotlin-testJunit = { module = "org.jetbrains.kotlin:kotlin-test-junit", version.ref = "kotlin" }
kotlin-test-annotations = { module = "org.jetbrains.kotlin:kotlin-test-annotations-common", version.ref = "kotlin" }
kotlinx-coroutines-test = { module = "org.jetbrains.kotlinx:kotlinx-coroutines-test", version.ref = "kotlinx-coroutines" }
turbine = { module = "app.cash.turbine:turbine", version.ref = "turbine" }
mockk = { module = "io.mockk:mockk", version.ref = "mockk" }

core-ktx = { group = "androidx.test", name = "core-ktx", version.ref = "coreKtx" }
robolectric = { module = "org.robolectric:robolectric", version.ref = "robolectric" }
junit = { module = "junit:junit", version.ref = "junit" }
androidx-testExt-junit = { module = "androidx.test.ext:junit", version.ref = "androidx-testExt" }
androidx-espresso-core = { module = "androidx.test.espresso:espresso-core", version.ref = "androidx-espresso" }

#build
android-gradlePlugin = { module = "com.android.tools.build:gradle", version.ref = "agp" }
kotlin-gradlePlugin = { module = "org.jetbrains.kotlin:kotlin-gradle-plugin", version.ref = "kotlin" }
ksp-gradlePlugin = { group = "com.google.devtools.ksp", name = "com.google.devtools.ksp.gradle.plugin", version.ref = "ksp" }
compose-gradlePlugin = { module = "org.jetbrains.compose:org.jetbrains.compose.gradle.plugin", version.ref = "composeMultiplatform" }


[bundles]
coil3 = ["coil", "coil-compose-core", "coil-compose", "coil-network-ktor"]
multiplatform-settings = [
    "multiplatform-settings",
    "multiplatform-settings-no-arg",
    "multiplatform-settings-coroutines",
    "multiplatform-settings-observable"
]
testing = [
    "kotlin-test",
    "kotlin-test-annotations",
    "kotlinx-coroutines-test",
    "turbine",
    "koin-test"
]
ktorfit = [
    "ktor-fit",
    "ktor-fit-converter-response",
    "ktor-fit-converter-call",
    "ktor-fit-converter-flow",
    "ktor-serialization-kotlinx-json",
    "ktor-client-content-negotiation",
    "ktor-client-serialization",
    "ktor-client-auth",
    "ktor-client-logging",
    "ktor-client-cio"
]

[plugins]
androidApplication = { id = "com.android.application", version.ref = "agp" }
androidLibrary = { id = "com.android.library", version.ref = "agp" }
composeHotReload = { id = "org.jetbrains.compose.hot-reload", version.ref = "composeHotReload" }
composeMultiplatform = { id = "org.jetbrains.compose", version.ref = "composeMultiplatform" }
composeCompiler = { id = "org.jetbrains.kotlin.plugin.compose", version.ref = "kotlin" }
kotlinMultiplatform = { id = "org.jetbrains.kotlin.multiplatform", version.ref = "kotlin" }
ksp = { id = "com.google.devtools.ksp", version.ref = "ksp" }
kotlin-serialization = { id = "org.jetbrains.kotlin.plugin.serialization", version.ref = "kotlin" }
sqlDelight = { id = "app.cash.sqldelight", version.ref = "sqldelight" }
ktor-fit = { id = "de.jensklingenberg.ktorfit", version.ref = "ktor-fit" }


local-kotlin-multiplatform = { id = "com.plugins.kotlinMultiplatformPlugin", version = "unspecified" }
local-compose-multiplatform = { id = "com.plugins.composeMultiplatform", version = "unspecified" }
local-koin = { id = "com.plugins.koin-annotation", version = "unspecified" }
local-sqlDelight = { id = "com.plugins.sqldelight", version = "unspecified" }



================================================
FILE: gradle/wrapper/gradle-wrapper.properties
================================================
distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
distributionUrl=https\://services.gradle.org/distributions/gradle-8.14.3-bin.zip
networkTimeout=10000
validateDistributionUrl=true
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists



================================================
FILE: iosApp/Configuration/Config.xcconfig
================================================
TEAM_ID=

PRODUCT_NAME=HomePasss
PRODUCT_BUNDLE_IDENTIFIER=com.yet.home.HomePasss$(TEAM_ID)

CURRENT_PROJECT_VERSION=1
MARKETING_VERSION=1.0


================================================
FILE: iosApp/iosApp/ContentView.swift
================================================
import UIKit
import SwiftUI
import ComposeApp

struct ComposeView: UIViewControllerRepresentable {
    func makeUIViewController(context: Context) -> UIViewController {
        MainViewControllerKt.MainViewController()
    }

    func updateUIViewController(_ uiViewController: UIViewController, context: Context) {}
}

struct ContentView: View {
    var body: some View {
        ComposeView()
            .ignoresSafeArea()
    }
}






================================================
FILE: iosApp/iosApp/Info.plist
================================================
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>CADisableMinimumFrameDurationOnPhone</key>
    <true/>
    <key>NSAppTransportSecurity</key>
    <dict>
        <key>NSAllowsArbitraryLoads</key>
        <true/>
    </dict>
</dict>
</plist>



================================================
FILE: iosApp/iosApp/iOSApp.swift
================================================
import SwiftUI

@main
struct iOSApp: App {
    var body: some Scene {
        WindowGroup {
            ContentView()
        }
    }
}


================================================
FILE: iosApp/iosApp/Assets.xcassets/Contents.json
================================================
{
  "info" : {
    "author" : "xcode",
    "version" : 1
  }
}



================================================
FILE: iosApp/iosApp/Assets.xcassets/AccentColor.colorset/Contents.json
================================================
{
  "colors" : [
    {
      "idiom" : "universal"
    }
  ],
  "info" : {
    "author" : "xcode",
    "version" : 1
  }
}



================================================
FILE: iosApp/iosApp/Assets.xcassets/AppIcon.appiconset/Contents.json
================================================
{
  "images" : [
    {
      "filename" : "app-icon-1024.png",
      "idiom" : "universal",
      "platform" : "ios",
      "size" : "1024x1024"
    },
    {
      "appearances" : [
        {
          "appearance" : "luminosity",
          "value" : "dark"
        }
      ],
      "idiom" : "universal",
      "platform" : "ios",
      "size" : "1024x1024"
    },
    {
      "appearances" : [
        {
          "appearance" : "luminosity",
          "value" : "tinted"
        }
      ],
      "idiom" : "universal",
      "platform" : "ios",
      "size" : "1024x1024"
    }
  ],
  "info" : {
    "author" : "xcode",
    "version" : 1
  }
}



================================================
FILE: iosApp/iosApp/Preview Content/Preview Assets.xcassets/Contents.json
================================================
{
  "info" : {
    "author" : "xcode",
    "version" : 1
  }
}


